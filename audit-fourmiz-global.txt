
==== AUDIT: C:\Users\MILLET IMMOBILIER\OneDrive\Bureau\project\app\auth\client-register.tsx ====
   1: import React, { useState, useEffect } from 'react';
   2: import {
   3:   View,
   4:   Text,
   5:   StyleSheet,
   6:   ScrollView,
   7:   TouchableOpacity,
   8:   TextInput,
   9:   Alert,
  10:   Platform,
  11:   FlatList,
  12: } from 'react-native';
  13: import { SafeAreaView } from 'react-native-safe-area-context';
  14: import { router } from 'expo-router';
  15: import { ArrowLeft, User, Mail, Phone, MapPin, Chrome as Home, Eye, EyeOff, Shield, Search, CircleCheck as CheckCircle, Building, Gift } from 'lucide-react-native';
  16: 
  17: interface AddressSuggestion {
  18:   id: string;
  19:   label: string;
  20:   address: string;
  21:   city: string;
  22:   postalCode: string;
  23:   coordinates?: {
  24:     lat: number;
  25:     lng: number;
  26:   };
  27: }
  28: 
  29: interface FormData {
  30:   firstName: string;
  31:   lastName: string;
  32:   email: string;
  33:   phone: string;
  34:   password: string;
  35:   confirmPassword: string;
  36:   address: string;
  37:   city: string;
  38:   postalCode: string;
  39:   building: string;
  40:   floor: string;
  41:   intercom: string;
  42:   additionalInfo: string;
  43:   referralCode: string;
  44:   acceptsTerms: boolean;
  45:   acceptsDataProcessing: boolean;
  46:   wantsNewsletter: boolean;
  47: }
  48: 
  49: // Mock API pour la recherche d'adresses (remplacer par une vraie API comme l'API Adresse du gouvernement français)
  50: const searchAddresses = async (query: string): Promise<AddressSuggestion[]> => {
  51:   if (query.length < 3) return [];
  52:   
  53:   // Simulation d'un appel API
  54:   await new Promise(resolve => setTimeout(resolve, 300));
  55:   
  56:   // Mock data - en production, utiliser l'API Adresse du gouvernement français
  57:   const mockAddresses: AddressSuggestion[] = [
  58:     {
  59:       id: '1',
  60:       label: '15 rue de la Paix, 75001 Paris',
  61:       address: '15 rue de la Paix',
  62:       city: 'Paris',
  63:       postalCode: '75001',
  64:       coordinates: { lat: 48.8566, lng: 2.3522 }
  65:     },
  66:     {
  67:       id: '2',
  68:       label: '42 avenue des Champs-Élysées, 75008 Paris',
  69:       address: '42 avenue des Champs-Élysées',
  70:       city: 'Paris',
  71:       postalCode: '75008',
  72:       coordinates: { lat: 48.8698, lng: 2.3076 }
  73:     },
  74:     {
  75:       id: '3',
  76:       label: '123 boulevard Saint-Germain, 75006 Paris',
  77:       address: '123 boulevard Saint-Germain',
  78:       city: 'Paris',
  79:       postalCode: '75006',
  80:       coordinates: { lat: 48.8534, lng: 2.3488 }
  81:     },
  82:     {
  83:       id: '4',
  84:       label: '89 rue de Rivoli, 75001 Paris',
  85:       address: '89 rue de Rivoli',
  86:       city: 'Paris',
  87:       postalCode: '75001',
  88:       coordinates: { lat: 48.8606, lng: 2.3376 }
  89:     },
  90:     {
  91:       id: '5',
  92:       label: '25 place Vendôme, 75001 Paris',
  93:       address: '25 place Vendôme',
  94:       city: 'Paris',
  95:       postalCode: '75001',
  96:       coordinates: { lat: 48.8677, lng: 2.3281 }
  97:     }
  98:   ].filter(addr => 
  99:     addr.label.toLowerCase().includes(query.toLowerCase())
 100:   );
 101:   
 102:   return mockAddresses;
 103: };
 104: 
 105: export default function ClientRegisterScreen() {
 106:   const [currentStep, setCurrentStep] = useState(1);
 107:   const [showPassword, setShowPassword] = useState(false);
 108:   const [showConfirmPassword, setShowConfirmPassword] = useState(false);
 109:   const [isLoading, setIsLoading] = useState(false);
 110:   const [addressQuery, setAddressQuery] = useState('');
 111:   const [addressSuggestions, setAddressSuggestions] = useState<AddressSuggestion[]>([]);
 112:   const [showSuggestions, setShowSuggestions] = useState(false);
 113:   const [isSearchingAddress, setIsSearchingAddress] = useState(false);
 114: 
 115:   const [formData, setFormData] = useState<FormData>({
 116:     firstName: '',
 117:     lastName: '',
 118:     email: '',
 119:     phone: '',
 120:     password: '',
 121:     confirmPassword: '',
 122:     address: '',
 123:     city: '',
 124:     postalCode: '',
 125:     building: '',
 126:     floor: '',
 127:     intercom: '',
 128:     additionalInfo: '',
 129:     referralCode: '',
 130:     acceptsTerms: false,
 131:     acceptsDataProcessing: false,
 132:     wantsNewsletter: false,
 133:   });
 134: 
 135:   const [errors, setErrors] = useState<Record<string, string>>({});
 136: 
 137:   // Recherche d'adresses avec debounce
 138:   useEffect(() => {
 139:     const timeoutId = setTimeout(async () => {
 140:       if (addressQuery.length >= 3) {
 141:         setIsSearchingAddress(true);
 142:         try {
 143:           const suggestions = await searchAddresses(addressQuery);
 144:           setAddressSuggestions(suggestions);
 145:           setShowSuggestions(true);
 146:         } catch (error) {
 147:           console.error('Erreur lors de la recherche d\'adresse:', error);
 148:         } finally {
 149:           setIsSearchingAddress(false);
 150:         }
 151:       } else {
 152:         setAddressSuggestions([]);
 153:         setShowSuggestions(false);
 154:       }
 155:     }, 300);
 156: 
 157:     return () => clearTimeout(timeoutId);
 158:   }, [addressQuery]);
 159: 
 160:   const updateFormData = (field: keyof FormData, value: any) => {
 161:     setFormData(prev => ({ ...prev, [field]: value }));
 162:     // Clear error when user starts typing
 163:     if (errors[field]) {
 164:       setErrors(prev => ({ ...prev, [field]: '' }));
 165:     }
 166:   };
 167: 
 168:   const handleAddressSelect = (suggestion: AddressSuggestion) => {
 169:     setAddressQuery(suggestion.label);
 170:     updateFormData('address', suggestion.address);
 171:     updateFormData('city', suggestion.city);
 172:     updateFormData('postalCode', suggestion.postalCode);
 173:     setShowSuggestions(false);
 174:   };
 175: 
 176:   const validateStep = (step: number): boolean => {
 177:     const newErrors: Record<string, string> = {};
 178: 
 179:     switch (step) {
 180:       case 1:
 181:         if (!formData.firstName.trim()) newErrors.firstName = 'Prénom requis';
 182:         if (!formData.lastName.trim()) newErrors.lastName = 'Nom requis';
 183:         if (!formData.email.trim()) {
 184:           newErrors.email = 'Email requis';
 185:         } else if (!/\S+@\S+\.\S+/.test(formData.email)) {
 186:           newErrors.email = 'Email invalide';
 187:         }
 188:         if (!formData.phone.trim()) {
 189:           newErrors.phone = 'Téléphone requis';
 190:         } else if (!/^(\+33|0)[1-9](\d{8})$/.test(formData.phone.replace(/\s/g, ''))) {
 191:           newErrors.phone = 'Numéro de téléphone invalide';
 192:         }
 193:         break;
 194: 
 195:       case 2:
 196:         if (!formData.password) {
 197:           newErrors.password = 'Mot de passe requis';
 198:         } else if (formData.password.length < 8) {
 199:           newErrors.password = 'Minimum 8 caractères';
 200:         } else if (!/(?=.*[a-z])(?=.*[A-Z])(?=.*\d)/.test(formData.password)) {
 201:           newErrors.password = 'Le mot de passe doit contenir au moins une majuscule, une minuscule et un chiffre';
 202:         }
 203:         if (formData.password !== formData.confirmPassword) {
 204:           newErrors.confirmPassword = 'Les mots de passe ne correspondent pas';
 205:         }
 206:         break;
 207: 
 208:       case 3:
 209:         if (!formData.address.trim()) newErrors.address = 'Adresse requise';
 210:         if (!formData.city.trim()) newErrors.city = 'Ville requise';
 211:         if (!formData.postalCode.trim()) {
 212:           newErrors.postalCode = 'Code postal requis';
 213:         } else if (!/^\d{5}$/.test(formData.postalCode)) {
 214:           newErrors.postalCode = 'Code postal invalide';
 215:         }
 216:         break;
 217: 
 218:       case 4:
 219:         if (!formData.acceptsTerms) {
 220:           newErrors.acceptsTerms = 'Vous devez accepter les conditions';
 221:         }
 222:         if (!formData.acceptsDataProcessing) {
 223:           newErrors.acceptsDataProcessing = 'Vous devez accepter le traitement des données';
 224:         }
 225:         break;
 226:     }
 227: 
 228:     setErrors(newErrors);
 229:     return Object.keys(newErrors).length === 0;
 230:   };
 231: 
 232:   const nextStep = () => {
 233:     if (validateStep(currentStep)) {
 234:       setCurrentStep(prev => Math.min(prev + 1, 4));
 235:     }
 236:   };
 237: 
 238:   const prevStep = () => {
 239:     setCurrentStep(prev => Math.max(prev - 1, 1));
 240:   };
 241: 
 242:   const handleSubmit = async () => {
 243:     if (!validateStep(4)) return;
 244: 
 245:     setIsLoading(true);
 246:     try {
 247:       // Simulate API call
 248:       await new Promise(resolve => setTimeout(resolve, 2000));
 249:       
 250:       Alert.alert(
 251:         'Inscription réussie !',
 252:         `Bienvenue ${formData.firstName} ! Votre compte client a été créé avec succès. ${formData.referralCode ? 'Votre code de parrainage a été pris en compte.' : ''} Vous pouvez maintenant commander des services.`,
 253:         [
 254:           {
 255:             text: 'OK',
 256:             onPress: () => router.replace('/(tabs)'),
 257:           },
 258:         ]
 259:       );
 260:     } catch (error) {
 261:       Alert.alert('Erreur', 'Une erreur est survenue. Veuillez réessayer.');
 262:     } finally {
 263:       setIsLoading(false);
 264:     }
 265:   };
 266: 
 267:   const renderStepIndicator = () => (
 268:     <View style={styles.stepIndicator}>
 269:       {[1, 2, 3, 4].map((step) => (
 270:         <View key={step} style={styles.stepContainer}>
 271:           <View style={[
 272:             styles.stepCircle,
 273:             currentStep >= step && styles.stepCircleActive,
 274:             currentStep > step && styles.stepCircleCompleted
 275:           ]}>
 276:             {currentStep > step ? (
 277:               <CheckCircle size={16} color="#FFFFFF" />
 278:             ) : (
 279:               <Text style={[
 280:                 styles.stepNumber,
 281:                 currentStep >= step && styles.stepNumberActive
 282:               ]}>
 283:                 {step}
 284:               </Text>
 285:             )}
 286:           </View>
 287:           {step < 4 && (
 288:             <View style={[
 289:               styles.stepLine,
 290:               currentStep > step && styles.stepLineActive
 291:             ]} />
 292:           )}
 293:         </View>
 294:       ))}
 295:     </View>
 296:   );
 297: 
 298:   const renderStep1 = () => (
 299:     <View style={styles.stepContent}>
 300:       <Text style={styles.stepTitle}>Informations personnelles</Text>
 301:       <Text style={styles.stepDescription}>
 302:         Créez votre compte client pour accéder à tous nos services
 303:       </Text>
 304:       
 305:       <View style={styles.inputGroup}>
 306:         <Text style={styles.label}>Prénom *</Text>
 307:         <View style={styles.inputContainer}>
 308:           <User size={20} color="#666" style={styles.inputIcon} />
 309:           <TextInput
 310:             style={styles.input}
 311:             value={formData.firstName}
 312:             onChangeText={(text) => updateFormData('firstName', text)}
 313:             placeholder="Votre prénom"
 314:             placeholderTextColor="#999"
 315:             autoComplete="given-name"
 316:           />
 317:         </View>
 318:         {errors.firstName && <Text style={styles.errorText}>{errors.firstName}</Text>}
 319:       </View>
 320: 
 321:       <View style={styles.inputGroup}>
 322:         <Text style={styles.label}>Nom *</Text>
 323:         <View style={styles.inputContainer}>
 324:           <User size={20} color="#666" style={styles.inputIcon} />
 325:           <TextInput
 326:             style={styles.input}
 327:             value={formData.lastName}
 328:             onChangeText={(text) => updateFormData('lastName', text)}
 329:             placeholder="Votre nom"
 330:             placeholderTextColor="#999"
 331:             autoComplete="family-name"
 332:           />
 333:         </View>
 334:         {errors.lastName && <Text style={styles.errorText}>{errors.lastName}</Text>}
 335:       </View>
 336: 
 337:       <View style={styles.inputGroup}>
 338:         <Text style={styles.label}>Email *</Text>
 339:         <View style={styles.inputContainer}>
 340:           <Mail size={20} color="#666" style={styles.inputIcon} />
 341:           <TextInput
 342:             style={styles.input}
 343:             value={formData.email}
 344:             onChangeText={(text) => updateFormData('email', text)}
 345:             placeholder="votre@email.com"
 346:             placeholderTextColor="#999"
 347:             keyboardType="email-address"
 348:             autoCapitalize="none"
 349:             autoComplete="email"
 350:           />
 351:         </View>
 352:         {errors.email && <Text style={styles.errorText}>{errors.email}</Text>}
 353:       </View>
 354: 
 355:       <View style={styles.inputGroup}>
 356:         <Text style={styles.label}>Téléphone mobile *</Text>
 357:         <View style={styles.inputContainer}>
 358:           <Phone size={20} color="#666" style={styles.inputIcon} />
 359:           <TextInput
 360:             style={styles.input}
 361:             value={formData.phone}
 362:             onChangeText={(text) => updateFormData('phone', text)}
 363:             placeholder="06 12 34 56 78"
 364:             placeholderTextColor="#999"
 365:             keyboardType="phone-pad"
 366:             autoComplete="tel"
 367:           />
 368:         </View>
 369:         {errors.phone && <Text style={styles.errorText}>{errors.phone}</Text>}
 370:         <Text style={styles.helpText}>
 371:           Votre numéro sera utilisé pour les notifications de commande
 372:         </Text>
 373:       </View>
 374:     </View>
 375:   );
 376: 
 377:   const renderStep2 = () => (
 378:     <View style={styles.stepContent}>
 379:       <Text style={styles.stepTitle}>Sécurité du compte</Text>
 380:       <Text style={styles.stepDescription}>
 381:         Choisissez un mot de passe sécurisé pour protéger votre compte
 382:       </Text>
 383:       
 384:       <View style={styles.inputGroup}>
 385:         <Text style={styles.label}>Mot de passe *</Text>
 386:         <View style={styles.inputContainer}>
 387:           <Shield size={20} color="#666" style={styles.inputIcon} />
 388:           <TextInput
 389:             style={styles.input}
 390:             value={formData.password}
 391:             onChangeText={(text) => updateFormData('password', text)}
 392:             placeholder="Minimum 8 caractères"
 393:             placeholderTextColor="#999"
 394:             secureTextEntry={!showPassword}
 395:             autoComplete="new-password"
 396:           />
 397:           <TouchableOpacity
 398:             style={styles.eyeIcon}
 399:             onPress={() => setShowPassword(!showPassword)}
 400:           >
 401:             {showPassword ? (
 402:               <EyeOff size={20} color="#666" />
 403:             ) : (
 404:               <Eye size={20} color="#666" />
 405:             )}
 406:           </TouchableOpacity>
 407:         </View>
 408:         {errors.password && <Text style={styles.errorText}>{errors.password}</Text>}
 409:       </View>
 410: 
 411:       <View style={styles.inputGroup}>
 412:         <Text style={styles.label}>Confirmer le mot de passe *</Text>
 413:         <View style={styles.inputContainer}>
 414:           <Shield size={20} color="#666" style={styles.inputIcon} />
 415:           <TextInput
 416:             style={styles.input}
 417:             value={formData.confirmPassword}
 418:             onChangeText={(text) => updateFormData('confirmPassword', text)}
 419:             placeholder="Confirmez votre mot de passe"
 420:             placeholderTextColor="#999"
 421:             secureTextEntry={!showConfirmPassword}
 422:             autoComplete="new-password"
 423:           />
 424:           <TouchableOpacity
 425:             style={styles.eyeIcon}
 426:             onPress={() => setShowConfirmPassword(!showConfirmPassword)}
 427:           >
 428:             {showConfirmPassword ? (
 429:               <EyeOff size={20} color="#666" />
 430:             ) : (
 431:               <Eye size={20} color="#666" />
 432:             )}
 433:           </TouchableOpacity>
 434:         </View>
 435:         {errors.confirmPassword && <Text style={styles.errorText}>{errors.confirmPassword}</Text>}
 436:       </View>
 437: 
 438:       <View style={styles.passwordRequirements}>
 439:         <Text style={styles.requirementsTitle}>Votre mot de passe doit contenir :</Text>
 440:         <View style={styles.requirementsList}>
 441:           <View style={styles.requirement}>
 442:             <View style={[styles.requirementDot, formData.password.length >= 8 && styles.requirementDotValid]} />
 443:             <Text style={[styles.requirementText, formData.password.length >= 8 && styles.requirementTextValid]}>
 444:               Au moins 8 caractères
 445:             </Text>
 446:           </View>
 447:           <View style={styles.requirement}>
 448:             <View style={[styles.requirementDot, /[A-Z]/.test(formData.password) && styles.requirementDotValid]} />
 449:             <Text style={[styles.requirementText, /[A-Z]/.test(formData.password) && styles.requirementTextValid]}>
 450:               Une lettre majuscule
 451:             </Text>
 452:           </View>
 453:           <View style={styles.requirement}>
 454:             <View style={[styles.requirementDot, /[a-z]/.test(formData.password) && styles.requirementDotValid]} />
 455:             <Text style={[styles.requirementText, /[a-z]/.test(formData.password) && styles.requirementTextValid]}>
 456:               Une lettre minuscule
 457:             </Text>
 458:           </View>
 459:           <View style={styles.requirement}>
 460:             <View style={[styles.requirementDot, /\d/.test(formData.password) && styles.requirementDotValid]} />
 461:             <Text style={[styles.requirementText, /\d/.test(formData.password) && styles.requirementTextValid]}>
 462:               Un chiffre
 463:             </Text>
 464:           </View>
 465:         </View>
 466:       </View>
 467:     </View>
 468:   );
 469: 
 470:   const renderStep3 = () => (
 471:     <View style={styles.stepContent}>
 472:       <Text style={styles.stepTitle}>Adresse de livraison</Text>
 473:       <Text style={styles.stepDescription}>
 474:         Indiquez votre adresse principale pour la livraison de vos commandes
 475:       </Text>
 476:       
 477:       <View style={styles.inputGroup}>
 478:         <Text style={styles.label}>Rechercher votre adresse *</Text>
 479:         <View style={styles.addressSearchContainer}>
 480:           <View style={styles.inputContainer}>
 481:             <Search size={20} color="#666" style={styles.inputIcon} />
 482:             <TextInput
 483:               style={styles.input}
 484:               value={addressQuery}
 485:               onChangeText={setAddressQuery}
 486:               placeholder="Tapez votre adresse..."
 487:               placeholderTextColor="#999"
 488:               autoComplete="street-address"
 489:             />
 490:             {isSearchingAddress && (
 491:               <Text style={styles.searchingText}>...</Text>
 492:             )}
 493:           </View>
 494:           
 495:           {showSuggestions && addressSuggestions.length > 0 && (
 496:             <View style={styles.suggestionsContainer}>
 497:               <FlatList
 498:                 data={addressSuggestions}
 499:                 keyExtractor={(item) => item.id}
 500:                 renderItem={({ item }) => (
 501:                   <TouchableOpacity
 502:                     style={styles.suggestionItem}
 503:                     onPress={() => handleAddressSelect(item)}
 504:                   >
 505:                     <MapPin size={16} color="#666" />
 506:                     <Text style={styles.suggestionText}>{item.label}</Text>
 507:                   </TouchableOpacity>
 508:                 )}
 509:                 style={styles.suggestionsList}
 510:                 keyboardShouldPersistTaps="handled"
 511:               />
 512:             </View>
 513:           )}
 514:         </View>
 515:         {errors.address && <Text style={styles.errorText}>{errors.address}</Text>}
 516:       </View>
 517: 
 518:       <View style={styles.row}>
 519:         <View style={[styles.inputGroup, styles.flex2]}>
 520:           <Text style={styles.label}>Ville *</Text>
 521:           <View style={styles.inputContainer}>
 522:             <TextInput
 523:               style={styles.input}
 524:               value={formData.city}
 525:               onChangeText={(text) => updateFormData('city', text)}
 526:               placeholder="Paris"
 527:               placeholderTextColor="#999"
 528:               autoComplete="address-level2"
 529:             />
 530:           </View>
 531:           {errors.city && <Text style={styles.errorText}>{errors.city}</Text>}
 532:         </View>
 533: 
 534:         <View style={[styles.inputGroup, styles.flex1, styles.marginLeft]}>
 535:           <Text style={styles.label}>Code postal *</Text>
 536:           <View style={styles.inputContainer}>
 537:             <TextInput
 538:               style={styles.input}
 539:               value={formData.postalCode}
 540:               onChangeText={(text) => updateFormData('postalCode', text)}
 541:               placeholder="75001"
 542:               placeholderTextColor="#999"
 543:               keyboardType="numeric"
 544:               maxLength={5}
 545:               autoComplete="postal-code"
 546:             />
 547:           </View>
 548:           {errors.postalCode && <Text style={styles.errorText}>{errors.postalCode}</Text>}
 549:         </View>
 550:       </View>
 551: 
 552:       <View style={styles.addressDetailsSection}>
 553:         <Text style={styles.sectionTitle}>Détails de l'adresse</Text>
 554:         
 555:         <View style={styles.row}>
 556:           <View style={[styles.inputGroup, styles.flex1]}>
 557:             <Text style={styles.label}>Bâtiment</Text>
 558:             <View style={styles.inputContainer}>
 559:               <Building size={20} color="#666" style={styles.inputIcon} />
 560:               <TextInput
 561:                 style={styles.input}
 562:                 value={formData.building}
 563:                 onChangeText={(text) => updateFormData('building', text)}
 564:                 placeholder="A, B, C..."
 565:                 placeholderTextColor="#999"
 566:               />
 567:             </View>
 568:           </View>
 569: 
 570:           <View style={[styles.inputGroup, styles.flex1, styles.marginLeft]}>
 571:             <Text style={styles.label}>Étage</Text>
 572:             <View style={styles.inputContainer}>
 573:               <Home size={20} color="#666" style={styles.inputIcon} />
 574:               <TextInput
 575:                 style={styles.input}
 576:                 value={formData.floor}
 577:                 onChangeText={(text) => updateFormData('floor', text)}
 578:                 placeholder="1er, 2ème..."
 579:                 placeholderTextColor="#999"
 580:               />
 581:             </View>
 582:           </View>
 583:         </View>
 584: 
 585:         <View style={styles.inputGroup}>
 586:           <Text style={styles.label}>Code interphone</Text>
 587:           <View style={styles.inputContainer}>
 588:             <TextInput
 589:               style={styles.input}
 590:               value={formData.intercom}
 591:               onChangeText={(text) => updateFormData('intercom', text)}
 592:               placeholder="Code d'accès à l'immeuble"
 593:               placeholderTextColor="#999"
 594:             />
 595:           </View>
 596:         </View>
 597: 
 598:         <View style={styles.inputGroup}>
 599:           <Text style={styles.label}>Informations complémentaires</Text>
 600:           <View style={styles.inputContainer}>
 601:             <TextInput
 602:               style={[styles.input, styles.textArea]}
 603:               value={formData.additionalInfo}
 604:               onChangeText={(text) => updateFormData('additionalInfo', text)}
 605:               placeholder="Porte à gauche, sonnette rouge, digicode..."
 606:               placeholderTextColor="#999"
 607:               multiline
 608:               numberOfLines={3}
 609:             />
 610:           </View>
 611:           <Text style={styles.helpText}>
 612:             Ces informations aideront les Fourmiz à vous trouver plus facilement
 613:           </Text>
 614:         </View>
 615:       </View>
 616:     </View>
 617:   );
 618: 
 619:   const renderStep4 = () => (
 620:     <View style={styles.stepContent}>
 621:       <Text style={styles.stepTitle}>Finalisation</Text>
 622:       <Text style={styles.stepDescription}>
 623:         Dernières étapes pour créer votre compte
 624:       </Text>
 625: 
 626:       {/* Code de parrainage */}
 627:       <View style={styles.referralSection}>
 628:         <Text style={styles.sectionTitle}>Code de parrainage (optionnel)</Text>
 629:         <View style={styles.inputGroup}>
 630:           <Text style={styles.label}>Code de parrainage</Text>
 631:           <View style={styles.inputContainer}>
 632:             <Gift size={20} color="#FF4444" style={styles.inputIcon} />
 633:             <TextInput
 634:               style={styles.input}
 635:               value={formData.referralCode}
 636:               onChangeText={(text) => updateFormData('referralCode', text.toUpperCase())}
 637:               placeholder="CODE2024"
 638:               placeholderTextColor="#999"
 639:               autoCapitalize="characters"
 640:             />
 641:           </View>
 642:           <Text style={styles.helpText}>
 643:             Si un ami vous a recommandé Fourmiz, saisissez son code de parrainage
 644:           </Text>
 645:         </View>
 646:       </View>
 647:       
 648:       <View style={styles.termsSection}>
 649:         <View style={styles.checkboxContainer}>
 650:           <TouchableOpacity
 651:             style={[styles.checkbox, formData.acceptsTerms && styles.checkboxChecked]}
 652:             onPress={() => updateFormData('acceptsTerms', !formData.acceptsTerms)}
 653:           >
 654:             {formData.acceptsTerms && <CheckCircle size={16} color="#FFFFFF" />}
 655:           </TouchableOpacity>
 656:           <Text style={styles.checkboxText}>
 657:             J'accepte les{' '}
 658:             <Text style={styles.link}>conditions générales d'utilisation</Text>
 659:             {' '}et la{' '}
 660:             <Text style={styles.link}>politique de confidentialité</Text> *
 661:           </Text>
 662:         </View>
 663:         {errors.acceptsTerms && <Text style={styles.errorText}>{errors.acceptsTerms}</Text>}
 664: 
 665:         <View style={styles.checkboxContainer}>
 666:           <TouchableOpacity
 667:             style={[styles.checkbox, formData.acceptsDataProcessing && styles.checkboxChecked]}
 668:             onPress={() => updateFormData('acceptsDataProcessing', !formData.acceptsDataProcessing)}
 669:           >
 670:             {formData.acceptsDataProcessing && <CheckCircle size={16} color="#FFFFFF" />}
 671:           </TouchableOpacity>
 672:           <Text style={styles.checkboxText}>
 673:             J'accepte le traitement de mes données personnelles pour la fourniture des services Fourmiz *
 674:           </Text>
 675:         </View>
 676:         {errors.acceptsDataProcessing && <Text style={styles.errorText}>{errors.acceptsDataProcessing}</Text>}
 677: 
 678:         <View style={styles.checkboxContainer}>
 679:           <TouchableOpacity
 680:             style={[styles.checkbox, formData.wantsNewsletter && styles.checkboxChecked]}
 681:             onPress={() => updateFormData('wantsNewsletter', !formData.wantsNewsletter)}
 682:           >
 683:             {formData.wantsNewsletter && <CheckCircle size={16} color="#FFFFFF" />}
 684:           </TouchableOpacity>
 685:           <Text style={styles.checkboxText}>
 686:             Je souhaite recevoir les actualités et offres Fourmiz par email
 687:           </Text>
 688:         </View>
 689:       </View>
 690: 
 691:       <View style={styles.summarySection}>
 692:         <Text style={styles.sectionTitle}>Récapitulatif</Text>
 693:         <View style={styles.summaryCard}>
 694:           <View style={styles.summaryRow}>
 695:             <Text style={styles.summaryLabel}>Nom complet :</Text>
 696:             <Text style={styles.summaryValue}>
 697:               {formData.firstName} {formData.lastName}
 698:             </Text>
 699:           </View>
 700:           <View style={styles.summaryRow}>
 701:             <Text style={styles.summaryLabel}>Email :</Text>
 702:             <Text style={styles.summaryValue}>{formData.email}</Text>
 703:           </View>
 704:           <View style={styles.summaryRow}>
 705:             <Text style={styles.summaryLabel}>Téléphone :</Text>
 706:             <Text style={styles.summaryValue}>{formData.phone}</Text>
 707:           </View>
 708:           <View style={styles.summaryRow}>
 709:             <Text style={styles.summaryLabel}>Adresse :</Text>
 710:             <Text style={styles.summaryValue}>
 711:               {formData.address}, {formData.postalCode} {formData.city}
 712:             </Text>
 713:           </View>
 714:           {(formData.building || formData.floor || formData.intercom) && (
 715:             <View style={styles.summaryRow}>
 716:               <Text style={styles.summaryLabel}>Détails :</Text>
 717:               <Text style={styles.summaryValue}>
 718:                 {[formData.building, formData.floor, formData.intercom].filter(Boolean).join(', ')}
 719:               </Text>
 720:             </View>
 721:           )}
 722:           {formData.referralCode && (
 723:             <View style={styles.summaryRow}>
 724:               <Text style={styles.summaryLabel}>Code parrainage :</Text>
 725:               <Text style={[styles.summaryValue, styles.referralCodeValue]}>{formData.referralCode}</Text>
 726:             </View>
 727:           )}
 728:         </View>
 729:       </View>
 730:     </View>
 731:   );
 732: 
 733:   return (
 734:     <SafeAreaView style={styles.container}>
 735:       {/* Header */}
 736:       <View style={styles.header}>
 737:         <TouchableOpacity
 738:           style={styles.backButton}
 739:           onPress={() => currentStep > 1 ? prevStep() : router.back()}
 740:         >
 741:           <ArrowLeft size={24} color="#333" />
 742:         </TouchableOpacity>
 743:         <Text style={styles.headerTitle}>Inscription Client</Text>
 744:         <View style={styles.placeholder} />
 745:       </View>
 746: 
 747:       {/* Step Indicator */}
 748:       {renderStepIndicator()}
 749: 
 750:       {/* Content */}
 751:       <ScrollView style={styles.content} showsVerticalScrollIndicator={false}>
 752:         {currentStep === 1 && renderStep1()}
 753:         {currentStep === 2 && renderStep2()}
 754:         {currentStep === 3 && renderStep3()}
 755:         {currentStep === 4 && renderStep4()}
 756:       </ScrollView>
 757: 
 758:       {/* Footer */}
 759:       <View style={styles.footer}>
 760:         {currentStep < 4 ? (
 761:           <TouchableOpacity style={styles.nextButton} onPress={nextStep}>
 762:             <Text style={styles.nextButtonText}>Continuer</Text>
 763:           </TouchableOpacity>
 764:         ) : (
 765:           <TouchableOpacity
 766:             style={[styles.submitButton, isLoading && styles.submitButtonDisabled]}
 767:             onPress={handleSubmit}
 768:             disabled={isLoading}
 769:           >
 770:             <Text style={styles.submitButtonText}>
 771:               {isLoading ? 'Création du compte...' : 'Créer mon compte'}
 772:             </Text>
 773:           </TouchableOpacity>
 774:         )}
 775:       </View>
 776:     </SafeAreaView>
 777:   );
 778: }
 779: 
 780: const styles = StyleSheet.create({
 781:   container: {
 782:     flex: 1,
 783:     backgroundColor: '#F8F9FA',
 784:   },
 785:   header: {
 786:     flexDirection: 'row',
 787:     alignItems: 'center',
 788:     justifyContent: 'space-between',
 789:     paddingHorizontal: 20,
 790:     paddingVertical: 16,
 791:     backgroundColor: '#FFFFFF',
 792:     borderBottomWidth: 1,
 793:     borderBottomColor: '#E5E5E5',
 794:   },
 795:   backButton: {
 796:     padding: 8,
 797:   },
 798:   headerTitle: {
 799:     fontSize: 18,
 800:     fontFamily: 'Inter-SemiBold',
 801:     color: '#333',
 802:   },
 803:   placeholder: {
 804:     width: 40,
 805:   },
 806:   stepIndicator: {
 807:     flexDirection: 'row',
 808:     alignItems: 'center',
 809:     justifyContent: 'center',
 810:     paddingVertical: 20,
 811:     backgroundColor: '#FFFFFF',
 812:   },
 813:   stepContainer: {
 814:     flexDirection: 'row',
 815:     alignItems: 'center',
 816:   },
 817:   stepCircle: {
 818:     width: 32,
 819:     height: 32,
 820:     borderRadius: 16,
 821:     backgroundColor: '#E5E5E5',
 822:     justifyContent: 'center',
 823:     alignItems: 'center',
 824:   },
 825:   stepCircleActive: {
 826:     backgroundColor: '#FF4444',
 827:   },
 828:   stepCircleCompleted: {
 829:     backgroundColor: '#4CAF50',
 830:   },
 831:   stepNumber: {
 832:     fontSize: 14,
 833:     fontFamily: 'Inter-SemiBold',
 834:     color: '#999',
 835:   },
 836:   stepNumberActive: {
 837:     color: '#FFFFFF',
 838:   },
 839:   stepLine: {
 840:     width: 40,
 841:     height: 2,
 842:     backgroundColor: '#E5E5E5',
 843:     marginHorizontal: 8,
 844:   },
 845:   stepLineActive: {
 846:     backgroundColor: '#4CAF50',
 847:   },
 848:   content: {
 849:     flex: 1,
 850:   },
 851:   stepContent: {
 852:     padding: 20,
 853:   },
 854:   stepTitle: {
 855:     fontSize: 24,
 856:     fontFamily: 'Inter-Bold',
 857:     color: '#333',
 858:     marginBottom: 8,
 859:     textAlign: 'center',
 860:   },
 861:   stepDescription: {
 862:     fontSize: 16,
 863:     fontFamily: 'Inter-Regular',
 864:     color: '#666',
 865:     textAlign: 'center',
 866:     marginBottom: 24,
 867:     lineHeight: 22,
 868:   },
 869:   inputGroup: {
 870:     marginBottom: 20,
 871:   },
 872:   label: {
 873:     fontSize: 14,
 874:     fontFamily: 'Inter-Medium',
 875:     color: '#333',
 876:     marginBottom: 8,
 877:   },
 878:   inputContainer: {
 879:     flexDirection: 'row',
 880:     alignItems: 'center',
 881:     backgroundColor: '#FFFFFF',
 882:     borderRadius: 12,
 883:     borderWidth: 1,
 884:     borderColor: '#E5E5E5',
 885:     paddingHorizontal: 16,
 886:     paddingVertical: 12,
 887:   },
 888:   inputIcon: {
 889:     marginRight: 12,
 890:   },
 891:   input: {
 892:     flex: 1,
 893:     fontSize: 16,
 894:     fontFamily: 'Inter-Regular',
 895:     color: '#333',
 896:   },
 897:   textArea: {
 898:     minHeight: 80,
 899:     textAlignVertical: 'top',
 900:   },
 901:   eyeIcon: {
 902:     padding: 4,
 903:   },
 904:   errorText: {
 905:     fontSize: 12,
 906:     fontFamily: 'Inter-Regular',
 907:     color: '#F44336',
 908:     marginTop: 4,
 909:   },
 910:   helpText: {
 911:     fontSize: 12,
 912:     fontFamily: 'Inter-Regular',
 913:     color: '#999',
 914:     marginTop: 4,
 915:     lineHeight: 16,
 916:   },
 917:   row: {
 918:     flexDirection: 'row',
 919:     alignItems: 'flex-start',
 920:   },
 921:   flex1: {
 922:     flex: 1,
 923:   },
 924:   flex2: {
 925:     flex: 2,
 926:   },
 927:   marginLeft: {
 928:     marginLeft: 12,
 929:   },
 930:   passwordRequirements: {
 931:     backgroundColor: '#F8F9FA',
 932:     borderRadius: 12,
 933:     padding: 16,
 934:     marginTop: 16,
 935:   },
 936:   requirementsTitle: {
 937:     fontSize: 14,
 938:     fontFamily: 'Inter-SemiBold',
 939:     color: '#333',
 940:     marginBottom: 12,
 941:   },
 942:   requirementsList: {
 943:     gap: 8,
 944:   },
 945:   requirement: {
 946:     flexDirection: 'row',
 947:     alignItems: 'center',
 948:   },
 949:   requirementDot: {
 950:     width: 8,
 951:     height: 8,
 952:     borderRadius: 4,
 953:     backgroundColor: '#E5E5E5',
 954:     marginRight: 8,
 955:   },
 956:   requirementDotValid: {
 957:     backgroundColor: '#4CAF50',
 958:   },
 959:   requirementText: {
 960:     fontSize: 12,
 961:     fontFamily: 'Inter-Regular',
 962:     color: '#666',
 963:   },
 964:   requirementTextValid: {
 965:     color: '#4CAF50',
 966:   },
 967:   addressSearchContainer: {
 968:     position: 'relative',
 969:   },
 970:   searchingText: {
 971:     fontSize: 16,
 972:     color: '#FF4444',
 973:     marginRight: 8,
 974:   },
 975:   suggestionsContainer: {
 976:     position: 'absolute',
 977:     top: '100%',
 978:     left: 0,
 979:     right: 0,
 980:     zIndex: 1000,
 981:     backgroundColor: '#FFFFFF',
 982:     borderRadius: 12,
 983:     borderWidth: 1,
 984:     borderColor: '#E5E5E5',
 985:     marginTop: 4,
 986:     maxHeight: 200,
 987:     shadowColor: '#000',
 988:     shadowOffset: { width: 0, height: 4 },
 989:     shadowOpacity: 0.1,
 990:     shadowRadius: 8,
 991:     elevation: 5,
 992:   },
 993:   suggestionsList: {
 994:     maxHeight: 200,
 995:   },
 996:   suggestionItem: {
 997:     flexDirection: 'row',
 998:     alignItems: 'center',
 999:     paddingHorizontal: 16,
1000:     paddingVertical: 12,
1001:     borderBottomWidth: 1,
1002:     borderBottomColor: '#F0F0F0',
1003:   },
1004:   suggestionText: {
1005:     fontSize: 14,
1006:     fontFamily: 'Inter-Regular',
1007:     color: '#333',
1008:     marginLeft: 12,
1009:     flex: 1,
1010:   },
1011:   sectionTitle: {
1012:     fontSize: 18,
1013:     fontFamily: 'Inter-SemiBold',
1014:     color: '#333',
1015:     marginBottom: 16,
1016:   },
1017:   addressDetailsSection: {
1018:     marginTop: 24,
1019:   },
1020:   referralSection: {
1021:     backgroundColor: '#FFF8E1',
1022:     borderRadius: 12,
1023:     padding: 16,
1024:     marginBottom: 24,
1025:     borderLeftWidth: 4,
1026:     borderLeftColor: '#FF4444',
1027:   },
1028:   termsSection: {
1029:     marginBottom: 24,
1030:   },
1031:   checkboxContainer: {
1032:     flexDirection: 'row',
1033:     alignItems: 'flex-start',
1034:     marginBottom: 16,
1035:   },
1036:   checkbox: {
1037:     width: 20,
1038:     height: 20,
1039:     borderRadius: 4,
1040:     borderWidth: 2,
1041:     borderColor: '#E5E5E5',
1042:     marginRight: 12,
1043:     marginTop: 2,
1044:     justifyContent: 'center',
1045:     alignItems: 'center',
1046:   },
1047:   checkboxChecked: {
1048:     backgroundColor: '#FF4444',
1049:     borderColor: '#FF4444',
1050:   },
1051:   checkboxText: {
1052:     flex: 1,
1053:     fontSize: 14,
1054:     fontFamily: 'Inter-Regular',
1055:     color: '#333',
1056:     lineHeight: 20,
1057:   },
1058:   link: {
1059:     color: '#FF4444',
1060:     textDecorationLine: 'underline',
1061:   },
1062:   summarySection: {
1063:     marginBottom: 24,
1064:   },
1065:   summaryCard: {
1066:     backgroundColor: '#FFFFFF',
1067:     borderRadius: 12,
1068:     padding: 16,
1069:     shadowColor: '#000',
1070:     shadowOffset: { width: 0, height: 2 },
1071:     shadowOpacity: 0.1,
1072:     shadowRadius: 4,
1073:     elevation: 3,
1074:   },
1075:   summaryRow: {
1076:     flexDirection: 'row',
1077:     justifyContent: 'space-between',
1078:     alignItems: 'flex-start',
1079:     marginBottom: 12,
1080:   },
1081:   summaryLabel: {
1082:     fontSize: 14,
1083:     fontFamily: 'Inter-Medium',
1084:     color: '#666',
1085:     flex: 1,
1086:   },
1087:   summaryValue: {
1088:     fontSize: 14,
1089:     fontFamily: 'Inter-Regular',
1090:     color: '#333',
1091:     flex: 2,
1092:     textAlign: 'right',
1093:   },
1094:   referralCodeValue: {
1095:     color: '#FF4444',
1096:     fontFamily: 'Inter-Bold',
1097:   },
1098:   footer: {
1099:     padding: 20,
1100:     backgroundColor: '#FFFFFF',
1101:     borderTopWidth: 1,
1102:     borderTopColor: '#E5E5E5',
1103:   },
1104:   nextButton: {
1105:     backgroundColor: '#FF4444',
1106:     borderRadius: 12,
1107:     paddingVertical: 16,
1108:     alignItems: 'center',
1109:   },
1110:   nextButtonText: {
1111:     fontSize: 16,
1112:     fontFamily: 'Inter-SemiBold',
1113:     color: '#FFFFFF',
1114:   },
1115:   submitButton: {
1116:     backgroundColor: '#4CAF50',
1117:     borderRadius: 12,
1118:     paddingVertical: 16,
1119:     alignItems: 'center',
1120:   },
1121:   submitButtonDisabled: {
1122:     backgroundColor: '#999',
1123:   },
1124:   submitButtonText: {
1125:     fontSize: 16,
1126:     fontFamily: 'Inter-SemiBold',
1127:     color: '#FFFFFF',
1128:   },
1129: });
1130: 

==== AUDIT: C:\Users\MILLET IMMOBILIER\OneDrive\Bureau\project\app\auth\complete-profile.tsx ====
   1: import React, { useState } from 'react';
   2: import {
   3:   View,
   4:   Text,
   5:   TextInput,
   6:   TouchableOpacity,
   7:   StyleSheet,
   8:   Alert,
   9:   ActivityIndicator,
  10:   ScrollView,
  11:   Platform,
  12: } from 'react-native';
  13: import { SafeAreaView } from 'react-native-safe-area-context';
  14: import * as ImagePicker from 'expo-image-picker';
  15: import { supabase } from '../../lib/supabase';
  16: import { router } from 'expo-router';
  17: 
  18: export default function CompleteProfileScreen() {
  19:   const [role, setRole] = useState<'client' | 'fourmiz' | null>(null);
  20:   const [firstname, setFirstname] = useState('');
  21:   const [lastname, setLastname] = useState('');
  22:   const [phone, setPhone] = useState('');
  23:   const [address, setAddress] = useState('');
  24:   const [idDocumentUri, setIdDocumentUri] = useState<string | null>(null);
  25:   const [uploading, setUploading] = useState(false);
  26: 
  27:   // Valide la saisie
  28:   const validate = () => {
  29:     if (!role) {
  30:       Alert.alert('Erreur', 'Veuillez choisir un rôle');
  31:       return false;
  32:     }
  33:     if (!firstname.trim() || !lastname.trim()) {
  34:       Alert.alert('Erreur', 'Veuillez saisir votre nom et prénom');
  35:       return false;
  36:     }
  37:     if (!phone.trim()) {
  38:       Alert.alert('Erreur', 'Veuillez saisir votre numéro de téléphone');
  39:       return false;
  40:     }
  41:     if (!address.trim()) {
  42:       Alert.alert('Erreur', 'Veuillez saisir votre adresse postale');
  43:       return false;
  44:     }
  45:     if (role === 'fourmiz' && !idDocumentUri) {
  46:       Alert.alert('Erreur', 'Veuillez télécharger une pièce d\'identité');
  47:       return false;
  48:     }
  49:     return true;
  50:   };
  51: 
  52:   // Ouvre la galerie ou appareil photo pour sélectionner la pièce d’identité
  53:   const pickIdDocument = async () => {
  54:     let permissionResult = await ImagePicker.requestMediaLibraryPermissionsAsync();
  55:     if (!permissionResult.granted) {
  56:       Alert.alert('Permission refusée', 'Permission d\'accès à la galerie refusée');
  57:       return;
  58:     }
  59: 
  60:     let pickerResult = await ImagePicker.launchImageLibraryAsync({
  61:       mediaTypes: ImagePicker.MediaTypeOptions.Images,
  62:       quality: 0.8,
  63:       allowsEditing: true,
  64:     });
  65: 
  66:     if (!pickerResult.cancelled) {
  67:       setIdDocumentUri(pickerResult.uri);
  68:     }
  69:   };
  70: 
  71:   // Upload image dans Supabase Storage
  72:   const uploadIdDocument = async (userId: string) => {
  73:     if (!idDocumentUri) return null;
  74: 
  75:     setUploading(true);
  76:     try {
  77:       const response = await fetch(idDocumentUri);
  78:       const blob = await response.blob();
  79:       const filename = `id-documents/${userId}-${Date.now()}.jpg`;
  80: 
  81:       const { error: uploadError } = await supabase.storage
  82:         .from('user-documents')
  83:         .upload(filename, blob, {
  84:           cacheControl: '3600',
  85:           upsert: true,
  86:           contentType: 'image/jpeg',
  87:         });
  88: 
  89:       if (uploadError) {
  90:         Alert.alert('Erreur', 'Échec de l\'upload de la pièce d\'identité');
  91:         return null;
  92:       }
  93:       setUploading(false);
  94:       return filename;
  95:     } catch (error) {
  96:       Alert.alert('Erreur', 'Erreur lors de l\'upload');
  97:       setUploading(false);
  98:       return null;
  99:     }
 100:   };
 101: 
 102:   const handleSubmit = async () => {
 103:     if (!validate()) return;
 104:     setUploading(true);
 105:     const { data: { user } } = await supabase.auth.getUser();
 106:     if (!user) {
 107:       Alert.alert('Erreur', 'Utilisateur non connecté');
 108:       setUploading(false);
 109:       return;
 110:     }
 111: 
 112:     try {
 113:       let idDocumentPath = null;
 114:       if (role === 'fourmiz' && idDocumentUri) {
 115:         idDocumentPath = await uploadIdDocument(user.id);
 116:         if (!idDocumentPath) {
 117:           setUploading(false);
 118:           return; // erreur upload
 119:         }
 120:       }
 121: 
 122:       // Mise à jour ou insertion du profil
 123:       const { error } = await supabase
 124:         .from('profiles')
 125:         .upsert({
 126:           id: user.id,
 127:           firstname: firstname.trim(),
 128:           lastname: lastname.trim(),
 129:           phone: phone.trim(),
 130:           address: address.trim(),
 131:           role,
 132:           id_document_path: idDocumentPath,
 133:           profile_completed: true,
 134:           updated_at: new Date(),
 135:         });
 136: 
 137:       if (error) {
 138:         Alert.alert('Erreur', 'Impossible de sauvegarder votre profil');
 139:         setUploading(false);
 140:         return;
 141:       }
 142: 
 143:       Alert.alert('Profil enregistré', 'Votre profil a bien été mis à jour');
 144:       router.replace('/(tabs)'); // retour à l'accueil
 145:     } catch (err) {
 146:       Alert.alert('Erreur', 'Erreur inattendue');
 147:       setUploading(false);
 148:     }
 149:   };
 150: 
 151:   return (
 152:     <SafeAreaView style={styles.container}>
 153:       <ScrollView contentContainerStyle={styles.content}>
 154:         <Text style={styles.title}>Complétez votre profil</Text>
 155: 
 156:         <Text style={styles.label}>Je suis :</Text>
 157:         <View style={styles.roleSelector}>
 158:           <TouchableOpacity
 159:             style={[styles.roleButton, role === 'client' && styles.roleButtonActive]}
 160:             onPress={() => setRole('client')}
 161:           >
 162:             <Text style={role === 'client' ? styles.roleTextActive : styles.roleText}>Client</Text>
 163:           </TouchableOpacity>
 164:           <TouchableOpacity
 165:             style={[styles.roleButton, role === 'fourmiz' && styles.roleButtonActive]}
 166:             onPress={() => setRole('fourmiz')}
 167:           >
 168:             <Text style={role === 'fourmiz' ? styles.roleTextActive : styles.roleText}>Fourmiz</Text>
 169:           </TouchableOpacity>
 170:         </View>
 171: 
 172:         <Text style={styles.label}>Prénom</Text>
 173:         <TextInput
 174:           style={styles.input}
 175:           value={firstname}
 176:           onChangeText={setFirstname}
 177:           placeholder="Votre prénom"
 178:           autoCapitalize="words"
 179:         />
 180: 
 181:         <Text style={styles.label}>Nom</Text>
 182:         <TextInput
 183:           style={styles.input}
 184:           value={lastname}
 185:           onChangeText={setLastname}
 186:           placeholder="Votre nom"
 187:           autoCapitalize="words"
 188:         />
 189: 
 190:         <Text style={styles.label}>Téléphone</Text>
 191:         <TextInput
 192:           style={styles.input}
 193:           value={phone}
 194:           onChangeText={setPhone}
 195:           placeholder="Votre numéro de téléphone"
 196:           keyboardType="phone-pad"
 197:         />
 198: 
 199:         <Text style={styles.label}>Adresse postale</Text>
 200:         <TextInput
 201:           style={styles.input}
 202:           value={address}
 203:           onChangeText={setAddress}
 204:           placeholder="Votre adresse complète"
 205:           multiline
 206:         />
 207: 
 208:         {role === 'fourmiz' && (
 209:           <>
 210:             <Text style={styles.label}>Pièce d’identité (Passeport ou CNI)</Text>
 211:             <TouchableOpacity style={styles.uploadButton} onPress={pickIdDocument}>
 212:               <Text style={styles.uploadButtonText}>
 213:                 {idDocumentUri ? 'Changer la pièce d’identité' : 'Télécharger la pièce d’identité'}
 214:               </Text>
 215:             </TouchableOpacity>
 216:             {idDocumentUri && (
 217:               <Text style={{ marginTop: 8, fontStyle: 'italic', color: '#555' }}>
 218:                 Pièce sélectionnée
 219:               </Text>
 220:             )}
 221:           </>
 222:         )}
 223: 
 224:         <TouchableOpacity
 225:           style={[styles.submitButton, uploading && { opacity: 0.7 }]}
 226:           onPress={handleSubmit}
 227:           disabled={uploading}
 228:         >
 229:           {uploading ? (
 230:             <ActivityIndicator color="#fff" />
 231:           ) : (
 232:             <Text style={styles.submitButtonText}>Valider mon profil</Text>
 233:           )}
 234:         </TouchableOpacity>
 235:       </ScrollView>
 236:     </SafeAreaView>
 237:   );
 238: }
 239: 
 240: const styles = StyleSheet.create({
 241:   container: { flex: 1, backgroundColor: '#fff' },
 242:   content: { padding: 24 },
 243:   title: {
 244:     fontSize: 22,
 245:     fontWeight: '700',
 246:     marginBottom: 24,
 247:     textAlign: 'center',
 248:   },
 249:   label: {
 250:     fontSize: 16,
 251:     fontWeight: '600',
 252:     marginTop: 16,
 253:   },
 254:   roleSelector: {
 255:     flexDirection: 'row',
 256:     justifyContent: 'center',
 257:     marginTop: 8,
 258:   },
 259:   roleButton: {
 260:     paddingVertical: 12,
 261:     paddingHorizontal: 40,
 262:     borderWidth: 1,
 263:     borderColor: '#FF4444',
 264:     borderRadius: 30,
 265:     marginHorizontal: 8,
 266:   },
 267:   roleButtonActive: {
 268:     backgroundColor: '#FF4444',
 269:   },
 270:   roleText: {
 271:     fontSize: 16,
 272:     color: '#FF4444',
 273:   },
 274:   roleTextActive: {
 275:     fontSize: 16,
 276:     color: '#fff',
 277:     fontWeight: '700',
 278:   },
 279:   input: {
 280:     borderWidth: 1,
 281:     borderColor: '#ddd',
 282:     borderRadius: 10,
 283:     paddingHorizontal: 16,
 284:     paddingVertical: Platform.OS === 'ios' ? 14 : 10,
 285:     fontSize: 16,
 286:     marginTop: 8,
 287:     backgroundColor: '#fafafa',
 288:   },
 289:   uploadButton: {
 290:     marginTop: 12,
 291:     backgroundColor: '#FF4444',
 292:     paddingVertical: 14,
 293:     borderRadius: 10,
 294:     alignItems: 'center',
 295:   },
 296:   uploadButtonText: {
 297:     color: '#fff',
 298:     fontWeight: '700',
 299:     fontSize: 16,
 300:   },
 301:   submitButton: {
 302:     marginTop: 32,
 303:     backgroundColor: '#FF4444',
 304:     paddingVertical: 16,
 305:     borderRadius: 10,
 306:     alignItems: 'center',
 307:   },
 308:   submitButtonText: {
 309:     fontSize: 18,
 310:     color: '#fff',
 311:     fontWeight: '700',
 312:   },
 313: });
 314: 

==== AUDIT: C:\Users\MILLET IMMOBILIER\OneDrive\Bureau\project\app\auth\forgotPassword.tsx ====
   1: // app/auth/forgotPassword.tsx
   2: import React, { useState } from 'react';
   3: import {
   4:   View,
   5:   Text,
   6:   TextInput,
   7:   Button,
   8:   StyleSheet,
   9:   Alert,
  10: } from 'react-native';
  11: import { SafeAreaView } from 'react-native-safe-area-context';
  12: import { supabase } from '../../lib/supabase';
  13: import { router } from 'expo-router';
  14: 
  15: export default function ForgotPasswordScreen() {
  16:   const [email, setEmail] = useState('');
  17:   const [isLoading, setIsLoading] = useState(false);
  18: 
  19:   const handlePasswordReset = async () => {
  20:     if (!email || !/\S+@\S+\.\S+/.test(email)) {
  21:       Alert.alert('Erreur', 'Veuillez entrer un email valide.');
  22:       return;
  23:     }
  24:     setIsLoading(true);
  25:     const { error } = await supabase.auth.resetPasswordForEmail(email);
  26:     setIsLoading(false);
  27: 
  28:     if (error) {
  29:       Alert.alert('Erreur', error.message);
  30:     } else {
  31:       Alert.alert('📧 Email envoyé', 'Un lien de réinitialisation vous a été envoyé.');
  32:       router.replace('/auth/login');
  33:     }
  34:   };
  35: 
  36:   return (
  37:     <SafeAreaView style={styles.container}>
  38:       <Text style={styles.title}>Mot de passe oublié</Text>
  39:       <TextInput
  40:         placeholder="Votre adresse email"
  41:         value={email}
  42:         onChangeText={setEmail}
  43:         autoCapitalize="none"
  44:         keyboardType="email-address"
  45:         style={styles.input}
  46:       />
  47:       <Button
  48:         title={isLoading ? 'Envoi en cours...' : 'Réinitialiser le mot de passe'}
  49:         onPress={handlePasswordReset}
  50:         disabled={isLoading}
  51:       />
  52:     </SafeAreaView>
  53:   );
  54: }
  55: 
  56: const styles = StyleSheet.create({
  57:   container: {
  58:     flex: 1,
  59:     padding: 20,
  60:     justifyContent: 'center',
  61:     backgroundColor: '#fff',
  62:   },
  63:   title: {
  64:     fontSize: 22,
  65:     fontWeight: 'bold',
  66:     textAlign: 'center',
  67:     marginBottom: 24,
  68:   },
  69:   input: {
  70:     borderWidth: 1,
  71:     borderColor: '#ccc',
  72:     borderRadius: 8,
  73:     padding: 12,
  74:     marginBottom: 16,
  75:   },
  76: });
  77: 

==== AUDIT: C:\Users\MILLET IMMOBILIER\OneDrive\Bureau\project\app\auth\fourmiz-register.tsx ====
   1: import React, { useState } from 'react';
   2: import {
   3:   View,
   4:   Text,
   5:   StyleSheet,
   6:   ScrollView,
   7:   TouchableOpacity,
   8:   TextInput,
   9:   Alert,
  10:   Switch,
  11:   Platform,
  12:   FlatList,
  13: } from 'react-native';
  14: import { SafeAreaView } from 'react-native-safe-area-context';
  15: import { router } from 'expo-router';
  16: import { User, Mail, Phone, MapPin, Calendar, Clock, Shield, Camera, CircleCheck as CheckCircle, ArrowLeft, Eye, EyeOff, CreditCard, FileText, Gift, Search, Building, Chrome as Home } from 'lucide-react-native';
  17: 
  18: interface AddressSuggestion {
  19:   id: string;
  20:   label: string;
  21:   address: string;
  22:   city: string;
  23:   postalCode: string;
  24:   coordinates?: {
  25:     lat: number;
  26:     lng: number;
  27:   };
  28: }
  29: 
  30: interface FormData {
  31:   firstName: string;
  32:   lastName: string;
  33:   email: string;
  34:   phone: string;
  35:   password: string;
  36:   confirmPassword: string;
  37:   address: string;
  38:   city: string;
  39:   postalCode: string;
  40:   building: string;
  41:   floor: string;
  42:   intercom: string;
  43:   additionalInfo: string;
  44:   dateOfBirth: string;
  45:   iban: string;
  46:   workingDays: string[];
  47:   workingHours: {
  48:     start: string;
  49:     end: string;
  50:   };
  51:   radius: number;
  52:   hasVehicle: boolean;
  53:   vehicleType: string;
  54:   hasDriverLicense: boolean;
  55:   referralCode: string;
  56:   acceptsTerms: boolean;
  57:   acceptsDataProcessing: boolean;
  58:   wantsNewsletter: boolean;
  59: }
  60: 
  61: const DAYS_OF_WEEK = [
  62:   { id: 'monday', label: 'Lundi' },
  63:   { id: 'tuesday', label: 'Mardi' },
  64:   { id: 'wednesday', label: 'Mercredi' },
  65:   { id: 'thursday', label: 'Jeudi' },
  66:   { id: 'friday', label: 'Vendredi' },
  67:   { id: 'saturday', label: 'Samedi' },
  68:   { id: 'sunday', label: 'Dimanche' },
  69: ];
  70: 
  71: const VEHICLE_TYPES = [
  72:   'Aucun',
  73:   'Vélo',
  74:   'Scooter',
  75:   'Moto',
  76:   'Voiture',
  77:   'Utilitaire'
  78: ];
  79: 
  80: // Mock API pour la recherche d'adresses
  81: const searchAddresses = async (query: string): Promise<AddressSuggestion[]> => {
  82:   if (query.length < 3) return [];
  83:   
  84:   await new Promise(resolve => setTimeout(resolve, 300));
  85:   
  86:   const mockAddresses: AddressSuggestion[] = [
  87:     {
  88:       id: '1',
  89:       label: '15 rue de la Paix, 75001 Paris',
  90:       address: '15 rue de la Paix',
  91:       city: 'Paris',
  92:       postalCode: '75001',
  93:       coordinates: { lat: 48.8566, lng: 2.3522 }
  94:     },
  95:     {
  96:       id: '2',
  97:       label: '42 avenue des Champs-Élysées, 75008 Paris',
  98:       address: '42 avenue des Champs-Élysées',
  99:       city: 'Paris',
 100:       postalCode: '75008',
 101:       coordinates: { lat: 48.8698, lng: 2.3076 }
 102:     },
 103:     {
 104:       id: '3',
 105:       label: '123 boulevard Saint-Germain, 75006 Paris',
 106:       address: '123 boulevard Saint-Germain',
 107:       city: 'Paris',
 108:       postalCode: '75006',
 109:       coordinates: { lat: 48.8534, lng: 2.3488 }
 110:     }
 111:   ].filter(addr => 
 112:     addr.label.toLowerCase().includes(query.toLowerCase())
 113:   );
 114:   
 115:   return mockAddresses;
 116: };
 117: 
 118: export default function FourmizRegisterScreen() {
 119:   const [currentStep, setCurrentStep] = useState(1);
 120:   const [showPassword, setShowPassword] = useState(false);
 121:   const [showConfirmPassword, setShowConfirmPassword] = useState(false);
 122:   const [isLoading, setIsLoading] = useState(false);
 123:   const [addressQuery, setAddressQuery] = useState('');
 124:   const [addressSuggestions, setAddressSuggestions] = useState<AddressSuggestion[]>([]);
 125:   const [showSuggestions, setShowSuggestions] = useState(false);
 126:   const [isSearchingAddress, setIsSearchingAddress] = useState(false);
 127: 
 128:   const [formData, setFormData] = useState<FormData>({
 129:     firstName: '',
 130:     lastName: '',
 131:     email: '',
 132:     phone: '',
 133:     password: '',
 134:     confirmPassword: '',
 135:     address: '',
 136:     city: '',
 137:     postalCode: '',
 138:     building: '',
 139:     floor: '',
 140:     intercom: '',
 141:     additionalInfo: '',
 142:     dateOfBirth: '',
 143:     iban: '',
 144:     workingDays: [],
 145:     workingHours: {
 146:       start: '09:00',
 147:       end: '18:00',
 148:     },
 149:     radius: 10,
 150:     hasVehicle: false,
 151:     vehicleType: 'Aucun',
 152:     hasDriverLicense: false,
 153:     referralCode: '',
 154:     acceptsTerms: false,
 155:     acceptsDataProcessing: false,
 156:     wantsNewsletter: false,
 157:   });
 158: 
 159:   const [errors, setErrors] = useState<Record<string, string>>({});
 160: 
 161:   // Recherche d'adresses avec debounce
 162:   React.useEffect(() => {
 163:     const timeoutId = setTimeout(async () => {
 164:       if (addressQuery.length >= 3) {
 165:         setIsSearchingAddress(true);
 166:         try {
 167:           const suggestions = await searchAddresses(addressQuery);
 168:           setAddressSuggestions(suggestions);
 169:           setShowSuggestions(true);
 170:         } catch (error) {
 171:           console.error('Erreur lors de la recherche d\'adresse:', error);
 172:         } finally {
 173:           setIsSearchingAddress(false);
 174:         }
 175:       } else {
 176:         setAddressSuggestions([]);
 177:         setShowSuggestions(false);
 178:       }
 179:     }, 300);
 180: 
 181:     return () => clearTimeout(timeoutId);
 182:   }, [addressQuery]);
 183: 
 184:   const updateFormData = (field: keyof FormData, value: any) => {
 185:     setFormData(prev => ({ ...prev, [field]: value }));
 186:     // Clear error when user starts typing
 187:     if (errors[field]) {
 188:       setErrors(prev => ({ ...prev, [field]: '' }));
 189:     }
 190:   };
 191: 
 192:   const handleAddressSelect = (suggestion: AddressSuggestion) => {
 193:     setAddressQuery(suggestion.label);
 194:     updateFormData('address', suggestion.address);
 195:     updateFormData('city', suggestion.city);
 196:     updateFormData('postalCode', suggestion.postalCode);
 197:     setShowSuggestions(false);
 198:   };
 199: 
 200:   const validateStep = (step: number): boolean => {
 201:     const newErrors: Record<string, string> = {};
 202: 
 203:     switch (step) {
 204:       case 1:
 205:         if (!formData.firstName.trim()) newErrors.firstName = 'Prénom requis';
 206:         if (!formData.lastName.trim()) newErrors.lastName = 'Nom requis';
 207:         if (!formData.email.trim()) {
 208:           newErrors.email = 'Email requis';
 209:         } else if (!/\S+@\S+\.\S+/.test(formData.email)) {
 210:           newErrors.email = 'Email invalide';
 211:         }
 212:         if (!formData.phone.trim()) {
 213:           newErrors.phone = 'Téléphone requis';
 214:         } else if (!/^(\+33|0)[1-9](\d{8})$/.test(formData.phone.replace(/\s/g, ''))) {
 215:           newErrors.phone = 'Numéro de téléphone invalide';
 216:         }
 217:         if (!formData.password) {
 218:           newErrors.password = 'Mot de passe requis';
 219:         } else if (formData.password.length < 8) {
 220:           newErrors.password = 'Minimum 8 caractères';
 221:         } else if (!/(?=.*[a-z])(?=.*[A-Z])(?=.*\d)/.test(formData.password)) {
 222:           newErrors.password = 'Le mot de passe doit contenir au moins une majuscule, une minuscule et un chiffre';
 223:         }
 224:         if (formData.password !== formData.confirmPassword) {
 225:           newErrors.confirmPassword = 'Les mots de passe ne correspondent pas';
 226:         }
 227:         break;
 228: 
 229:       case 2:
 230:         if (!formData.address.trim()) newErrors.address = 'Adresse requise';
 231:         if (!formData.city.trim()) newErrors.city = 'Ville requise';
 232:         if (!formData.postalCode.trim()) {
 233:           newErrors.postalCode = 'Code postal requis';
 234:         } else if (!/^\d{5}$/.test(formData.postalCode)) {
 235:           newErrors.postalCode = 'Code postal invalide';
 236:         }
 237:         if (!formData.dateOfBirth) newErrors.dateOfBirth = 'Date de naissance requise';
 238:         break;
 239: 
 240:       case 3:
 241:         if (!formData.iban.trim()) {
 242:           newErrors.iban = 'IBAN requis';
 243:         } else if (!/^FR\d{2}\s?\d{4}\s?\d{4}\s?\d{4}\s?\d{4}\s?\d{4}\s?\d{2}$/.test(formData.iban.replace(/\s/g, ''))) {
 244:           newErrors.iban = 'IBAN français invalide';
 245:         }
 246:         if (formData.workingDays.length === 0) {
 247:           newErrors.workingDays = 'Sélectionnez au moins un jour';
 248:         }
 249:         break;
 250: 
 251:       case 4:
 252:         if (!formData.acceptsTerms) {
 253:           newErrors.acceptsTerms = 'Vous devez accepter les conditions';
 254:         }
 255:         if (!formData.acceptsDataProcessing) {
 256:           newErrors.acceptsDataProcessing = 'Vous devez accepter le traitement des données';
 257:         }
 258:         break;
 259:     }
 260: 
 261:     setErrors(newErrors);
 262:     return Object.keys(newErrors).length === 0;
 263:   };
 264: 
 265:   const nextStep = () => {
 266:     if (validateStep(currentStep)) {
 267:       setCurrentStep(prev => Math.min(prev + 1, 4));
 268:     }
 269:   };
 270: 
 271:   const prevStep = () => {
 272:     setCurrentStep(prev => Math.max(prev - 1, 1));
 273:   };
 274: 
 275:   const handleSubmit = async () => {
 276:     if (!validateStep(4)) return;
 277: 
 278:     setIsLoading(true);
 279:     try {
 280:       // Simulate API call
 281:       await new Promise(resolve => setTimeout(resolve, 2000));
 282:       
 283:       Alert.alert(
 284:         'Inscription réussie !',
 285:         `Félicitations ${formData.firstName} ! Votre demande d'inscription Fourmiz a été envoyée. ${formData.referralCode ? 'Votre code de parrainage a été pris en compte.' : ''} Vous recevrez un email de confirmation sous 24h pour finaliser votre compte.`,
 286:         [
 287:           {
 288:             text: 'OK',
 289:             onPress: () => router.replace('/(tabs)'),
 290:           },
 291:         ]
 292:       );
 293:     } catch (error) {
 294:       Alert.alert('Erreur', 'Une erreur est survenue. Veuillez réessayer.');
 295:     } finally {
 296:       setIsLoading(false);
 297:     }
 298:   };
 299: 
 300:   const toggleWorkingDay = (dayId: string) => {
 301:     const newDays = formData.workingDays.includes(dayId)
 302:       ? formData.workingDays.filter(d => d !== dayId)
 303:       : [...formData.workingDays, dayId];
 304:     updateFormData('workingDays', newDays);
 305:   };
 306: 
 307:   const renderStepIndicator = () => (
 308:     <View style={styles.stepIndicator}>
 309:       {[1, 2, 3, 4].map((step) => (
 310:         <View key={step} style={styles.stepContainer}>
 311:           <View style={[
 312:             styles.stepCircle,
 313:             currentStep >= step && styles.stepCircleActive,
 314:             currentStep > step && styles.stepCircleCompleted
 315:           ]}>
 316:             {currentStep > step ? (
 317:               <CheckCircle size={16} color="#FFFFFF" />
 318:             ) : (
 319:               <Text style={[
 320:                 styles.stepNumber,
 321:                 currentStep >= step && styles.stepNumberActive
 322:               ]}>
 323:                 {step}
 324:               </Text>
 325:             )}
 326:           </View>
 327:           {step < 4 && (
 328:             <View style={[
 329:               styles.stepLine,
 330:               currentStep > step && styles.stepLineActive
 331:             ]} />
 332:           )}
 333:         </View>
 334:       ))}
 335:     </View>
 336:   );
 337: 
 338:   const renderStep1 = () => (
 339:     <View style={styles.stepContent}>
 340:       <Text style={styles.stepTitle}>Informations personnelles</Text>
 341:       <Text style={styles.stepDescription}>
 342:         Rejoignez la communauté Fourmiz et commencez à gagner de l'argent
 343:       </Text>
 344:       
 345:       <View style={styles.inputGroup}>
 346:         <Text style={styles.label}>Prénom *</Text>
 347:         <View style={styles.inputContainer}>
 348:           <User size={20} color="#666" style={styles.inputIcon} />
 349:           <TextInput
 350:             style={styles.input}
 351:             value={formData.firstName}
 352:             onChangeText={(text) => updateFormData('firstName', text)}
 353:             placeholder="Votre prénom"
 354:             placeholderTextColor="#999"
 355:             autoComplete="given-name"
 356:           />
 357:         </View>
 358:         {errors.firstName && <Text style={styles.errorText}>{errors.firstName}</Text>}
 359:       </View>
 360: 
 361:       <View style={styles.inputGroup}>
 362:         <Text style={styles.label}>Nom *</Text>
 363:         <View style={styles.inputContainer}>
 364:           <User size={20} color="#666" style={styles.inputIcon} />
 365:           <TextInput
 366:             style={styles.input}
 367:             value={formData.lastName}
 368:             onChangeText={(text) => updateFormData('lastName', text)}
 369:             placeholder="Votre nom"
 370:             placeholderTextColor="#999"
 371:             autoComplete="family-name"
 372:           />
 373:         </View>
 374:         {errors.lastName && <Text style={styles.errorText}>{errors.lastName}</Text>}
 375:       </View>
 376: 
 377:       <View style={styles.inputGroup}>
 378:         <Text style={styles.label}>Email *</Text>
 379:         <View style={styles.inputContainer}>
 380:           <Mail size={20} color="#666" style={styles.inputIcon} />
 381:           <TextInput
 382:             style={styles.input}
 383:             value={formData.email}
 384:             onChangeText={(text) => updateFormData('email', text)}
 385:             placeholder="votre@email.com"
 386:             placeholderTextColor="#999"
 387:             keyboardType="email-address"
 388:             autoCapitalize="none"
 389:             autoComplete="email"
 390:           />
 391:         </View>
 392:         {errors.email && <Text style={styles.errorText}>{errors.email}</Text>}
 393:       </View>
 394: 
 395:       <View style={styles.inputGroup}>
 396:         <Text style={styles.label}>Téléphone *</Text>
 397:         <View style={styles.inputContainer}>
 398:           <Phone size={20} color="#666" style={styles.inputIcon} />
 399:           <TextInput
 400:             style={styles.input}
 401:             value={formData.phone}
 402:             onChangeText={(text) => updateFormData('phone', text)}
 403:             placeholder="06 12 34 56 78"
 404:             placeholderTextColor="#999"
 405:             keyboardType="phone-pad"
 406:             autoComplete="tel"
 407:           />
 408:         </View>
 409:         {errors.phone && <Text style={styles.errorText}>{errors.phone}</Text>}
 410:       </View>
 411: 
 412:       <View style={styles.inputGroup}>
 413:         <Text style={styles.label}>Mot de passe *</Text>
 414:         <View style={styles.inputContainer}>
 415:           <Shield size={20} color="#666" style={styles.inputIcon} />
 416:           <TextInput
 417:             style={styles.input}
 418:             value={formData.password}
 419:             onChangeText={(text) => updateFormData('password', text)}
 420:             placeholder="Minimum 8 caractères"
 421:             placeholderTextColor="#999"
 422:             secureTextEntry={!showPassword}
 423:             autoComplete="new-password"
 424:           />
 425:           <TouchableOpacity
 426:             style={styles.eyeIcon}
 427:             onPress={() => setShowPassword(!showPassword)}
 428:           >
 429:             {showPassword ? (
 430:               <EyeOff size={20} color="#666" />
 431:             ) : (
 432:               <Eye size={20} color="#666" />
 433:             )}
 434:           </TouchableOpacity>
 435:         </View>
 436:         {errors.password && <Text style={styles.errorText}>{errors.password}</Text>}
 437:       </View>
 438: 
 439:       <View style={styles.inputGroup}>
 440:         <Text style={styles.label}>Confirmer le mot de passe *</Text>
 441:         <View style={styles.inputContainer}>
 442:           <Shield size={20} color="#666" style={styles.inputIcon} />
 443:           <TextInput
 444:             style={styles.input}
 445:             value={formData.confirmPassword}
 446:             onChangeText={(text) => updateFormData('confirmPassword', text)}
 447:             placeholder="Confirmez votre mot de passe"
 448:             placeholderTextColor="#999"
 449:             secureTextEntry={!showConfirmPassword}
 450:             autoComplete="new-password"
 451:           />
 452:           <TouchableOpacity
 453:             style={styles.eyeIcon}
 454:             onPress={() => setShowConfirmPassword(!showConfirmPassword)}
 455:           >
 456:             {showConfirmPassword ? (
 457:               <EyeOff size={20} color="#666" />
 458:             ) : (
 459:               <Eye size={20} color="#666" />
 460:             )}
 461:           </TouchableOpacity>
 462:         </View>
 463:         {errors.confirmPassword && <Text style={styles.errorText}>{errors.confirmPassword}</Text>}
 464:       </View>
 465: 
 466:       <View style={styles.passwordRequirements}>
 467:         <Text style={styles.requirementsTitle}>Votre mot de passe doit contenir :</Text>
 468:         <View style={styles.requirementsList}>
 469:           <View style={styles.requirement}>
 470:             <View style={[styles.requirementDot, formData.password.length >= 8 && styles.requirementDotValid]} />
 471:             <Text style={[styles.requirementText, formData.password.length >= 8 && styles.requirementTextValid]}>
 472:               Au moins 8 caractères
 473:             </Text>
 474:           </View>
 475:           <View style={styles.requirement}>
 476:             <View style={[styles.requirementDot, /[A-Z]/.test(formData.password) && styles.requirementDotValid]} />
 477:             <Text style={[styles.requirementText, /[A-Z]/.test(formData.password) && styles.requirementTextValid]}>
 478:               Une lettre majuscule
 479:             </Text>
 480:           </View>
 481:           <View style={styles.requirement}>
 482:             <View style={[styles.requirementDot, /[a-z]/.test(formData.password) && styles.requirementDotValid]} />
 483:             <Text style={[styles.requirementText, /[a-z]/.test(formData.password) && styles.requirementTextValid]}>
 484:               Une lettre minuscule
 485:             </Text>
 486:           </View>
 487:           <View style={styles.requirement}>
 488:             <View style={[styles.requirementDot, /\d/.test(formData.password) && styles.requirementDotValid]} />
 489:             <Text style={[styles.requirementText, /\d/.test(formData.password) && styles.requirementTextValid]}>
 490:               Un chiffre
 491:             </Text>
 492:           </View>
 493:         </View>
 494:       </View>
 495:     </View>
 496:   );
 497: 
 498:   const renderStep2 = () => (
 499:     <View style={styles.stepContent}>
 500:       <Text style={styles.stepTitle}>Adresse et informations</Text>
 501:       <Text style={styles.stepDescription}>
 502:         Indiquez votre adresse et vos informations personnelles
 503:       </Text>
 504:       
 505:       <View style={styles.inputGroup}>
 506:         <Text style={styles.label}>Rechercher votre adresse *</Text>
 507:         <View style={styles.addressSearchContainer}>
 508:           <View style={styles.inputContainer}>
 509:             <Search size={20} color="#666" style={styles.inputIcon} />
 510:             <TextInput
 511:               style={styles.input}
 512:               value={addressQuery}
 513:               onChangeText={setAddressQuery}
 514:               placeholder="Tapez votre adresse..."
 515:               placeholderTextColor="#999"
 516:               autoComplete="street-address"
 517:             />
 518:             {isSearchingAddress && (
 519:               <Text style={styles.searchingText}>...</Text>
 520:             )}
 521:           </View>
 522:           
 523:           {showSuggestions && addressSuggestions.length > 0 && (
 524:             <View style={styles.suggestionsContainer}>
 525:               <FlatList
 526:                 data={addressSuggestions}
 527:                 keyExtractor={(item) => item.id}
 528:                 renderItem={({ item }) => (
 529:                   <TouchableOpacity
 530:                     style={styles.suggestionItem}
 531:                     onPress={() => handleAddressSelect(item)}
 532:                   >
 533:                     <MapPin size={16} color="#666" />
 534:                     <Text style={styles.suggestionText}>{item.label}</Text>
 535:                   </TouchableOpacity>
 536:                 )}
 537:                 style={styles.suggestionsList}
 538:                 keyboardShouldPersistTaps="handled"
 539:               />
 540:             </View>
 541:           )}
 542:         </View>
 543:         {errors.address && <Text style={styles.errorText}>{errors.address}</Text>}
 544:       </View>
 545: 
 546:       <View style={styles.row}>
 547:         <View style={[styles.inputGroup, styles.flex2]}>
 548:           <Text style={styles.label}>Ville *</Text>
 549:           <View style={styles.inputContainer}>
 550:             <TextInput
 551:               style={styles.input}
 552:               value={formData.city}
 553:               onChangeText={(text) => updateFormData('city', text)}
 554:               placeholder="Paris"
 555:               placeholderTextColor="#999"
 556:               autoComplete="address-level2"
 557:             />
 558:           </View>
 559:           {errors.city && <Text style={styles.errorText}>{errors.city}</Text>}
 560:         </View>
 561: 
 562:         <View style={[styles.inputGroup, styles.flex1, styles.marginLeft]}>
 563:           <Text style={styles.label}>Code postal *</Text>
 564:           <View style={styles.inputContainer}>
 565:             <TextInput
 566:               style={styles.input}
 567:               value={formData.postalCode}
 568:               onChangeText={(text) => updateFormData('postalCode', text)}
 569:               placeholder="75001"
 570:               placeholderTextColor="#999"
 571:               keyboardType="numeric"
 572:               maxLength={5}
 573:               autoComplete="postal-code"
 574:             />
 575:           </View>
 576:           {errors.postalCode && <Text style={styles.errorText}>{errors.postalCode}</Text>}
 577:         </View>
 578:       </View>
 579: 
 580:       <View style={styles.row}>
 581:         <View style={[styles.inputGroup, styles.flex1]}>
 582:           <Text style={styles.label}>Bâtiment</Text>
 583:           <View style={styles.inputContainer}>
 584:             <Building size={20} color="#666" style={styles.inputIcon} />
 585:             <TextInput
 586:               style={styles.input}
 587:               value={formData.building}
 588:               onChangeText={(text) => updateFormData('building', text)}
 589:               placeholder="A, B, C..."
 590:               placeholderTextColor="#999"
 591:             />
 592:           </View>
 593:         </View>
 594: 
 595:         <View style={[styles.inputGroup, styles.flex1, styles.marginLeft]}>
 596:           <Text style={styles.label}>Étage</Text>
 597:           <View style={styles.inputContainer}>
 598:             <Home size={20} color="#666" style={styles.inputIcon} />
 599:             <TextInput
 600:               style={styles.input}
 601:               value={formData.floor}
 602:               onChangeText={(text) => updateFormData('floor', text)}
 603:               placeholder="1er, 2ème..."
 604:               placeholderTextColor="#999"
 605:             />
 606:           </View>
 607:         </View>
 608:       </View>
 609: 
 610:       <View style={styles.inputGroup}>
 611:         <Text style={styles.label}>Date de naissance *</Text>
 612:         <View style={styles.inputContainer}>
 613:           <Calendar size={20} color="#666" style={styles.inputIcon} />
 614:           <TextInput
 615:             style={styles.input}
 616:             value={formData.dateOfBirth}
 617:             onChangeText={(text) => updateFormData('dateOfBirth', text)}
 618:             placeholder="JJ/MM/AAAA"
 619:             placeholderTextColor="#999"
 620:             keyboardType="numeric"
 621:           />
 622:         </View>
 623:         {errors.dateOfBirth && <Text style={styles.errorText}>{errors.dateOfBirth}</Text>}
 624:         <Text style={styles.helpText}>
 625:           Vous devez être majeur(e) pour devenir Fourmiz
 626:         </Text>
 627:       </View>
 628: 
 629:       <View style={styles.vehicleSection}>
 630:         <Text style={styles.sectionTitle}>Transport</Text>
 631:         
 632:         <View style={styles.switchContainer}>
 633:           <Text style={styles.switchLabel}>J'ai un véhicule</Text>
 634:           <Switch
 635:             value={formData.hasVehicle}
 636:             onValueChange={(value) => {
 637:               updateFormData('hasVehicle', value);
 638:               if (!value) {
 639:                 updateFormData('vehicleType', 'Aucun');
 640:                 updateFormData('hasDriverLicense', false);
 641:               }
 642:             }}
 643:             trackColor={{ false: '#E0E0E0', true: '#FF444440' }}
 644:             thumbColor={formData.hasVehicle ? '#FF4444' : '#999'}
 645:           />
 646:         </View>
 647: 
 648:         {formData.hasVehicle && (
 649:           <>
 650:             <View style={styles.inputGroup}>
 651:               <Text style={styles.label}>Type de véhicule</Text>
 652:               <View style={styles.vehicleTypes}>
 653:                 {VEHICLE_TYPES.slice(1).map((type) => (
 654:                   <TouchableOpacity
 655:                     key={type}
 656:                     style={[
 657:                       styles.vehicleTypeButton,
 658:                       formData.vehicleType === type && styles.vehicleTypeButtonActive
 659:                     ]}
 660:                     onPress={() => updateFormData('vehicleType', type)}
 661:                   >
 662:                     <Text style={[
 663:                       styles.vehicleTypeText,
 664:                       formData.vehicleType === type && styles.vehicleTypeTextActive
 665:                     ]}>
 666:                       {type}
 667:                     </Text>
 668:                   </TouchableOpacity>
 669:                 ))}
 670:               </View>
 671:             </View>
 672: 
 673:             <View style={styles.switchContainer}>
 674:               <Text style={styles.switchLabel}>J'ai le permis de conduire</Text>
 675:               <Switch
 676:                 value={formData.hasDriverLicense}
 677:                 onValueChange={(value) => updateFormData('hasDriverLicense', value)}
 678:                 trackColor={{ false: '#E0E0E0', true: '#FF444440' }}
 679:                 thumbColor={formData.hasDriverLicense ? '#FF4444' : '#999'}
 680:               />
 681:             </View>
 682:           </>
 683:         )}
 684:       </View>
 685:     </View>
 686:   );
 687: 
 688:   const renderStep3 = () => (
 689:     <View style={styles.stepContent}>
 690:       <Text style={styles.stepTitle}>Paiement et disponibilités</Text>
 691:       <Text style={styles.stepDescription}>
 692:         Configurez vos informations de paiement et vos créneaux de travail
 693:       </Text>
 694:       
 695:       <View style={styles.inputGroup}>
 696:         <Text style={styles.label}>IBAN (pour recevoir vos paiements) *</Text>
 697:         <View style={styles.inputContainer}>
 698:           <CreditCard size={20} color="#666" style={styles.inputIcon} />
 699:           <TextInput
 700:             style={styles.input}
 701:             value={formData.iban}
 702:             onChangeText={(text) => updateFormData('iban', text.toUpperCase())}
 703:             placeholder="FR76 1234 1234 1234 1234 1234 12"
 704:             placeholderTextColor="#999"
 705:             autoCapitalize="characters"
 706:           />
 707:         </View>
 708:         {errors.iban && <Text style={styles.errorText}>{errors.iban}</Text>}
 709:         <Text style={styles.helpText}>
 710:           Votre IBAN sera utilisé pour recevoir vos paiements de manière sécurisée
 711:         </Text>
 712:       </View>
 713: 
 714:       <View style={styles.availabilitySection}>
 715:         <Text style={styles.sectionTitle}>Disponibilités</Text>
 716:         
 717:         <View style={styles.inputGroup}>
 718:           <Text style={styles.label}>Jours de travail *</Text>
 719:           <View style={styles.daysContainer}>
 720:             {DAYS_OF_WEEK.map((day) => (
 721:               <TouchableOpacity
 722:                 key={day.id}
 723:                 style={[
 724:                   styles.dayButton,
 725:                   formData.workingDays.includes(day.id) && styles.dayButtonActive
 726:                 ]}
 727:                 onPress={() => toggleWorkingDay(day.id)}
 728:               >
 729:                 <Text style={[
 730:                   styles.dayButtonText,
 731:                   formData.workingDays.includes(day.id) && styles.dayButtonTextActive
 732:                 ]}>
 733:                   {day.label.slice(0, 3)}
 734:                 </Text>
 735:               </TouchableOpacity>
 736:             ))}
 737:           </View>
 738:           {errors.workingDays && <Text style={styles.errorText}>{errors.workingDays}</Text>}
 739:         </View>
 740: 
 741:         <View style={styles.row}>
 742:           <View style={[styles.inputGroup, styles.flex1]}>
 743:             <Text style={styles.label}>Heure de début</Text>
 744:             <View style={styles.inputContainer}>
 745:               <Clock size={20} color="#666" style={styles.inputIcon} />
 746:               <TextInput
 747:                 style={styles.input}
 748:                 value={formData.workingHours.start}
 749:                 onChangeText={(text) => updateFormData('workingHours', { ...formData.workingHours, start: text })}
 750:                 placeholder="09:00"
 751:                 placeholderTextColor="#999"
 752:               />
 753:             </View>
 754:           </View>
 755: 
 756:           <View style={[styles.inputGroup, styles.flex1, styles.marginLeft]}>
 757:             <Text style={styles.label}>Heure de fin</Text>
 758:             <View style={styles.inputContainer}>
 759:               <Clock size={20} color="#666" style={styles.inputIcon} />
 760:               <TextInput
 761:                 style={styles.input}
 762:                 value={formData.workingHours.end}
 763:                 onChangeText={(text) => updateFormData('workingHours', { ...formData.workingHours, end: text })}
 764:                 placeholder="18:00"
 765:                 placeholderTextColor="#999"
 766:               />
 767:             </View>
 768:           </View>
 769:         </View>
 770: 
 771:         <View style={styles.inputGroup}>
 772:           <Text style={styles.label}>Rayon d'action: {formData.radius} km</Text>
 773:           <View style={styles.sliderContainer}>
 774:             <Text style={styles.sliderLabel}>5 km</Text>
 775:             <View style={styles.sliderTrack}>
 776:               <View style={[styles.sliderFill, { width: `${(formData.radius - 5) / 45 * 100}%` }]} />
 777:               <TouchableOpacity
 778:                 style={[styles.sliderThumb, { left: `${(formData.radius - 5) / 45 * 100}%` }]}
 779:                 onPress={() => {
 780:                   // Simple slider simulation - in real app, use a proper slider component
 781:                   const newRadius = formData.radius >= 25 ? 5 : formData.radius + 5;
 782:                   updateFormData('radius', newRadius);
 783:                 }}
 784:               />
 785:             </View>
 786:             <Text style={styles.sliderLabel}>50 km</Text>
 787:           </View>
 788:           <Text style={styles.helpText}>
 789:             Définissez la distance maximale que vous êtes prêt(e) à parcourir pour une mission
 790:           </Text>
 791:         </View>
 792:       </View>
 793:     </View>
 794:   );
 795: 
 796:   const renderStep4 = () => (
 797:     <View style={styles.stepContent}>
 798:       <Text style={styles.stepTitle}>Finalisation</Text>
 799:       <Text style={styles.stepDescription}>
 800:         Dernières étapes pour rejoindre la communauté Fourmiz
 801:       </Text>
 802: 
 803:       {/* Code de parrainage */}
 804:       <View style={styles.referralSection}>
 805:         <Text style={styles.sectionTitle}>Code de parrainage (optionnel)</Text>
 806:         <View style={styles.inputGroup}>
 807:           <Text style={styles.label}>Code de parrainage</Text>
 808:           <View style={styles.inputContainer}>
 809:             <Gift size={20} color="#FF4444" style={styles.inputIcon} />
 810:             <TextInput
 811:               style={styles.input}
 812:               value={formData.referralCode}
 813:               onChangeText={(text) => updateFormData('referralCode', text.toUpperCase())}
 814:               placeholder="CODE2024"
 815:               placeholderTextColor="#999"
 816:               autoCapitalize="characters"
 817:             />
 818:           </View>
 819:           <Text style={styles.helpText}>
 820:             Si un ami Fourmiz vous a recommandé, saisissez son code de parrainage pour qu'il reçoive sa commission
 821:           </Text>
 822:         </View>
 823:       </View>
 824:       
 825:       <View style={styles.termsSection}>
 826:         <View style={styles.checkboxContainer}>
 827:           <TouchableOpacity
 828:             style={[styles.checkbox, formData.acceptsTerms && styles.checkboxChecked]}
 829:             onPress={() => updateFormData('acceptsTerms', !formData.acceptsTerms)}
 830:           >
 831:             {formData.acceptsTerms && <CheckCircle size={16} color="#FFFFFF" />}
 832:           </TouchableOpacity>
 833:           <Text style={styles.checkboxText}>
 834:             J'accepte les{' '}
 835:             <Text style={styles.link}>conditions générales d'utilisation</Text>
 836:             {' '}et la{' '}
 837:             <Text style={styles.link}>charte Fourmiz</Text> *
 838:           </Text>
 839:         </View>
 840:         {errors.acceptsTerms && <Text style={styles.errorText}>{errors.acceptsTerms}</Text>}
 841: 
 842:         <View style={styles.checkboxContainer}>
 843:           <TouchableOpacity
 844:             style={[styles.checkbox, formData.acceptsDataProcessing && styles.checkboxChecked]}
 845:             onPress={() => updateFormData('acceptsDataProcessing', !formData.acceptsDataProcessing)}
 846:           >
 847:             {formData.acceptsDataProcessing && <CheckCircle size={16} color="#FFFFFF" />}
 848:           </TouchableOpacity>
 849:           <Text style={styles.checkboxText}>
 850:             J'accepte le traitement de mes données personnelles conformément à la{' '}
 851:             <Text style={styles.link}>politique de confidentialité</Text> *
 852:           </Text>
 853:         </View>
 854:         {errors.acceptsDataProcessing && <Text style={styles.errorText}>{errors.acceptsDataProcessing}</Text>}
 855: 
 856:         <View style={styles.checkboxContainer}>
 857:           <TouchableOpacity
 858:             style={[styles.checkbox, formData.wantsNewsletter && styles.checkboxChecked]}
 859:             onPress={() => updateFormData('wantsNewsletter', !formData.wantsNewsletter)}
 860:           >
 861:             {formData.wantsNewsletter && <CheckCircle size={16} color="#FFFFFF" />}
 862:           </TouchableOpacity>
 863:           <Text style={styles.checkboxText}>
 864:             Je souhaite recevoir les actualités et offres Fourmiz par email
 865:           </Text>
 866:         </View>
 867:       </View>
 868: 
 869:       <View style={styles.verificationInfo}>
 870:         <View style={styles.infoCard}>
 871:           <Camera size={24} color="#FF4444" />
 872:           <View style={styles.infoContent}>
 873:             <Text style={styles.infoTitle}>Vérification d'identité</Text>
 874:             <Text style={styles.infoText}>
 875:               Après validation de votre inscription, vous devrez fournir une pièce d'identité 
 876:               pour activer votre compte Fourmiz.
 877:             </Text>
 878:           </View>
 879:         </View>
 880: 
 881:         <View style={styles.infoCard}>
 882:           <FileText size={24} color="#4CAF50" />
 883:           <View style={styles.infoContent}>
 884:             <Text style={styles.infoTitle}>Statut auto-entrepreneur</Text>
 885:             <Text style={styles.infoText}>
 886:               En tant que Fourmiz, vous exercez en tant qu'auto-entrepreneur. 
 887:               Nous vous accompagnons dans vos démarches.
 888:             </Text>
 889:           </View>
 890:         </View>
 891:       </View>
 892:     </View>
 893:   );
 894: 
 895:   return (
 896:     <SafeAreaView style={styles.container}>
 897:       {/* Header */}
 898:       <View style={styles.header}>
 899:         <TouchableOpacity
 900:           style={styles.backButton}
 901:           onPress={() => currentStep > 1 ? prevStep() : router.back()}
 902:         >
 903:           <ArrowLeft size={24} color="#333" />
 904:         </TouchableOpacity>
 905:         <Text style={styles.headerTitle}>Devenir Fourmiz</Text>
 906:         <View style={styles.placeholder} />
 907:       </View>
 908: 
 909:       {/* Step Indicator */}
 910:       {renderStepIndicator()}
 911: 
 912:       {/* Content */}
 913:       <ScrollView style={styles.content} showsVerticalScrollIndicator={false}>
 914:         {currentStep === 1 && renderStep1()}
 915:         {currentStep === 2 && renderStep2()}
 916:         {currentStep === 3 && renderStep3()}
 917:         {currentStep === 4 && renderStep4()}
 918:       </ScrollView>
 919: 
 920:       {/* Footer */}
 921:       <View style={styles.footer}>
 922:         {currentStep < 4 ? (
 923:           <TouchableOpacity style={styles.nextButton} onPress={nextStep}>
 924:             <Text style={styles.nextButtonText}>Continuer</Text>
 925:           </TouchableOpacity>
 926:         ) : (
 927:           <TouchableOpacity
 928:             style={[styles.submitButton, isLoading && styles.submitButtonDisabled]}
 929:             onPress={handleSubmit}
 930:             disabled={isLoading}
 931:           >
 932:             <Text style={styles.submitButtonText}>
 933:               {isLoading ? 'Inscription en cours...' : 'Finaliser l\'inscription'}
 934:             </Text>
 935:           </TouchableOpacity>
 936:         )}
 937:       </View>
 938:     </SafeAreaView>
 939:   );
 940: }
 941: 
 942: const styles = StyleSheet.create({
 943:   container: {
 944:     flex: 1,
 945:     backgroundColor: '#F8F9FA',
 946:   },
 947:   header: {
 948:     flexDirection: 'row',
 949:     alignItems: 'center',
 950:     justifyContent: 'space-between',
 951:     paddingHorizontal: 20,
 952:     paddingVertical: 16,
 953:     backgroundColor: '#FFFFFF',
 954:     borderBottomWidth: 1,
 955:     borderBottomColor: '#E5E5E5',
 956:   },
 957:   backButton: {
 958:     padding: 8,
 959:   },
 960:   headerTitle: {
 961:     fontSize: 18,
 962:     fontFamily: 'Inter-SemiBold',
 963:     color: '#333',
 964:   },
 965:   placeholder: {
 966:     width: 40,
 967:   },
 968:   stepIndicator: {
 969:     flexDirection: 'row',
 970:     alignItems: 'center',
 971:     justifyContent: 'center',
 972:     paddingVertical: 20,
 973:     backgroundColor: '#FFFFFF',
 974:   },
 975:   stepContainer: {
 976:     flexDirection: 'row',
 977:     alignItems: 'center',
 978:   },
 979:   stepCircle: {
 980:     width: 32,
 981:     height: 32,
 982:     borderRadius: 16,
 983:     backgroundColor: '#E5E5E5',
 984:     justifyContent: 'center',
 985:     alignItems: 'center',
 986:   },
 987:   stepCircleActive: {
 988:     backgroundColor: '#FF4444',
 989:   },
 990:   stepCircleCompleted: {
 991:     backgroundColor: '#4CAF50',
 992:   },
 993:   stepNumber: {
 994:     fontSize: 14,
 995:     fontFamily: 'Inter-SemiBold',
 996:     color: '#999',
 997:   },
 998:   stepNumberActive: {
 999:     color: '#FFFFFF',
1000:   },
1001:   stepLine: {
1002:     width: 40,
1003:     height: 2,
1004:     backgroundColor: '#E5E5E5',
1005:     marginHorizontal: 8,
1006:   },
1007:   stepLineActive: {
1008:     backgroundColor: '#4CAF50',
1009:   },
1010:   content: {
1011:     flex: 1,
1012:   },
1013:   stepContent: {
1014:     padding: 20,
1015:   },
1016:   stepTitle: {
1017:     fontSize: 24,
1018:     fontFamily: 'Inter-Bold',
1019:     color: '#333',
1020:     marginBottom: 8,
1021:     textAlign: 'center',
1022:   },
1023:   stepDescription: {
1024:     fontSize: 16,
1025:     fontFamily: 'Inter-Regular',
1026:     color: '#666',
1027:     textAlign: 'center',
1028:     marginBottom: 24,
1029:     lineHeight: 22,
1030:   },
1031:   inputGroup: {
1032:     marginBottom: 20,
1033:   },
1034:   label: {
1035:     fontSize: 14,
1036:     fontFamily: 'Inter-Medium',
1037:     color: '#333',
1038:     marginBottom: 8,
1039:   },
1040:   inputContainer: {
1041:     flexDirection: 'row',
1042:     alignItems: 'center',
1043:     backgroundColor: '#FFFFFF',
1044:     borderRadius: 12,
1045:     borderWidth: 1,
1046:     borderColor: '#E5E5E5',
1047:     paddingHorizontal: 16,
1048:     paddingVertical: 12,
1049:   },
1050:   inputIcon: {
1051:     marginRight: 12,
1052:   },
1053:   input: {
1054:     flex: 1,
1055:     fontSize: 16,
1056:     fontFamily: 'Inter-Regular',
1057:     color: '#333',
1058:   },
1059:   eyeIcon: {
1060:     padding: 4,
1061:   },
1062:   errorText: {
1063:     fontSize: 12,
1064:     fontFamily: 'Inter-Regular',
1065:     color: '#F44336',
1066:     marginTop: 4,
1067:   },
1068:   helpText: {
1069:     fontSize: 12,
1070:     fontFamily: 'Inter-Regular',
1071:     color: '#999',
1072:     marginTop: 4,
1073:     lineHeight: 16,
1074:   },
1075:   row: {
1076:     flexDirection: 'row',
1077:     alignItems: 'flex-start',
1078:   },
1079:   flex1: {
1080:     flex: 1,
1081:   },
1082:   flex2: {
1083:     flex: 2,
1084:   },
1085:   marginLeft: {
1086:     marginLeft: 12,
1087:   },
1088:   passwordRequirements: {
1089:     backgroundColor: '#F8F9FA',
1090:     borderRadius: 12,
1091:     padding: 16,
1092:     marginTop: 16,
1093:   },
1094:   requirementsTitle: {
1095:     fontSize: 14,
1096:     fontFamily: 'Inter-SemiBold',
1097:     color: '#333',
1098:     marginBottom: 12,
1099:   },
1100:   requirementsList: {
1101:     gap: 8,
1102:   },
1103:   requirement: {
1104:     flexDirection: 'row',
1105:     alignItems: 'center',
1106:   },
1107:   requirementDot: {
1108:     width: 8,
1109:     height: 8,
1110:     borderRadius: 4,
1111:     backgroundColor: '#E5E5E5',
1112:     marginRight: 8,
1113:   },
1114:   requirementDotValid: {
1115:     backgroundColor: '#4CAF50',
1116:   },
1117:   requirementText: {
1118:     fontSize: 12,
1119:     fontFamily: 'Inter-Regular',
1120:     color: '#666',
1121:   },
1122:   requirementTextValid: {
1123:     color: '#4CAF50',
1124:   },
1125:   addressSearchContainer: {
1126:     position: 'relative',
1127:   },
1128:   searchingText: {
1129:     fontSize: 16,
1130:     color: '#FF4444',
1131:     marginRight: 8,
1132:   },
1133:   suggestionsContainer: {
1134:     position: 'absolute',
1135:     top: '100%',
1136:     left: 0,
1137:     right: 0,
1138:     zIndex: 1000,
1139:     backgroundColor: '#FFFFFF',
1140:     borderRadius: 12,
1141:     borderWidth: 1,
1142:     borderColor: '#E5E5E5',
1143:     marginTop: 4,
1144:     maxHeight: 200,
1145:     shadowColor: '#000',
1146:     shadowOffset: { width: 0, height: 4 },
1147:     shadowOpacity: 0.1,
1148:     shadowRadius: 8,
1149:     elevation: 5,
1150:   },
1151:   suggestionsList: {
1152:     maxHeight: 200,
1153:   },
1154:   suggestionItem: {
1155:     flexDirection: 'row',
1156:     alignItems: 'center',
1157:     paddingHorizontal: 16,
1158:     paddingVertical: 12,
1159:     borderBottomWidth: 1,
1160:     borderBottomColor: '#F0F0F0',
1161:   },
1162:   suggestionText: {
1163:     fontSize: 14,
1164:     fontFamily: 'Inter-Regular',
1165:     color: '#333',
1166:     marginLeft: 12,
1167:     flex: 1,
1168:   },
1169:   sectionTitle: {
1170:     fontSize: 18,
1171:     fontFamily: 'Inter-SemiBold',
1172:     color: '#333',
1173:     marginBottom: 16,
1174:   },
1175:   vehicleSection: {
1176:     marginTop: 24,
1177:   },
1178:   switchContainer: {
1179:     flexDirection: 'row',
1180:     justifyContent: 'space-between',
1181:     alignItems: 'center',
1182:     backgroundColor: '#FFFFFF',
1183:     borderRadius: 12,
1184:     paddingHorizontal: 16,
1185:     paddingVertical: 16,
1186:     marginBottom: 16,
1187:   },
1188:   switchLabel: {
1189:     fontSize: 16,
1190:     fontFamily: 'Inter-Medium',
1191:     color: '#333',
1192:   },
1193:   vehicleTypes: {
1194:     flexDirection: 'row',
1195:     flexWrap: 'wrap',
1196:     gap: 8,
1197:   },
1198:   vehicleTypeButton: {
1199:     backgroundColor: '#FFFFFF',
1200:     borderRadius: 20,
1201:     paddingHorizontal: 16,
1202:     paddingVertical: 8,
1203:     borderWidth: 1,
1204:     borderColor: '#E5E5E5',
1205:   },
1206:   vehicleTypeButtonActive: {
1207:     backgroundColor: '#FF4444',
1208:     borderColor: '#FF4444',
1209:   },
1210:   vehicleTypeText: {
1211:     fontSize: 14,
1212:     fontFamily: 'Inter-Medium',
1213:     color: '#666',
1214:   },
1215:   vehicleTypeTextActive: {
1216:     color: '#FFFFFF',
1217:   },
1218:   availabilitySection: {
1219:     marginTop: 24,
1220:   },
1221:   daysContainer: {
1222:     flexDirection: 'row',
1223:     flexWrap: 'wrap',
1224:     gap: 8,
1225:   },
1226:   dayButton: {
1227:     backgroundColor: '#FFFFFF',
1228:     borderRadius: 20,
1229:     paddingHorizontal: 12,
1230:     paddingVertical: 8,
1231:     borderWidth: 1,
1232:     borderColor: '#E5E5E5',
1233:     minWidth: 45,
1234:     alignItems: 'center',
1235:   },
1236:   dayButtonActive: {
1237:     backgroundColor: '#FF4444',
1238:     borderColor: '#FF4444',
1239:   },
1240:   dayButtonText: {
1241:     fontSize: 12,
1242:     fontFamily: 'Inter-Medium',
1243:     color: '#666',
1244:   },
1245:   dayButtonTextActive: {
1246:     color: '#FFFFFF',
1247:   },
1248:   sliderContainer: {
1249:     flexDirection: 'row',
1250:     alignItems: 'center',
1251:     gap: 12,
1252:   },
1253:   sliderLabel: {
1254:     fontSize: 12,
1255:     fontFamily: 'Inter-Regular',
1256:     color: '#666',
1257:   },
1258:   sliderTrack: {
1259:     flex: 1,
1260:     height: 4,
1261:     backgroundColor: '#E5E5E5',
1262:     borderRadius: 2,
1263:     position: 'relative',
1264:   },
1265:   sliderFill: {
1266:     height: '100%',
1267:     backgroundColor: '#FF4444',
1268:     borderRadius: 2,
1269:   },
1270:   sliderThumb: {
1271:     position: 'absolute',
1272:     top: -6,
1273:     width: 16,
1274:     height: 16,
1275:     backgroundColor: '#FF4444',
1276:     borderRadius: 8,
1277:     marginLeft: -8,
1278:   },
1279:   referralSection: {
1280:     backgroundColor: '#FFF8E1',
1281:     borderRadius: 12,
1282:     padding: 16,
1283:     marginBottom: 24,
1284:     borderLeftWidth: 4,
1285:     borderLeftColor: '#FF4444',
1286:   },
1287:   termsSection: {
1288:     marginBottom: 24,
1289:   },
1290:   checkboxContainer: {
1291:     flexDirection: 'row',
1292:     alignItems: 'flex-start',
1293:     marginBottom: 16,
1294:   },
1295:   checkbox: {
1296:     width: 20,
1297:     height: 20,
1298:     borderRadius: 4,
1299:     borderWidth: 2,
1300:     borderColor: '#E5E5E5',
1301:     marginRight: 12,
1302:     marginTop: 2,
1303:     justifyContent: 'center',
1304:     alignItems: 'center',
1305:   },
1306:   checkboxChecked: {
1307:     backgroundColor: '#FF4444',
1308:     borderColor: '#FF4444',
1309:   },
1310:   checkboxText: {
1311:     flex: 1,
1312:     fontSize: 14,
1313:     fontFamily: 'Inter-Regular',
1314:     color: '#333',
1315:     lineHeight: 20,
1316:   },
1317:   link: {
1318:     color: '#FF4444',
1319:     textDecorationLine: 'underline',
1320:   },
1321:   verificationInfo: {
1322:     gap: 16,
1323:   },
1324:   infoCard: {
1325:     flexDirection: 'row',
1326:     backgroundColor: '#FFFFFF',
1327:     borderRadius: 12,
1328:     padding: 16,
1329:     alignItems: 'flex-start',
1330:   },
1331:   infoContent: {
1332:     flex: 1,
1333:     marginLeft: 12,
1334:   },
1335:   infoTitle: {
1336:     fontSize: 16,
1337:     fontFamily: 'Inter-SemiBold',
1338:     color: '#333',
1339:     marginBottom: 4,
1340:   },
1341:   infoText: {
1342:     fontSize: 14,
1343:     fontFamily: 'Inter-Regular',
1344:     color: '#666',
1345:     lineHeight: 20,
1346:   },
1347:   footer: {
1348:     padding: 20,
1349:     backgroundColor: '#FFFFFF',
1350:     borderTopWidth: 1,
1351:     borderTopColor: '#E5E5E5',
1352:   },
1353:   nextButton: {
1354:     backgroundColor: '#FF4444',
1355:     borderRadius: 12,
1356:     paddingVertical: 16,
1357:     alignItems: 'center',
1358:   },
1359:   nextButtonText: {
1360:     fontSize: 16,
1361:     fontFamily: 'Inter-SemiBold',
1362:     color: '#FFFFFF',
1363:   },
1364:   submitButton: {
1365:     backgroundColor: '#4CAF50',
1366:     borderRadius: 12,
1367:     paddingVertical: 16,
1368:     alignItems: 'center',
1369:   },
1370:   submitButtonDisabled: {
1371:     backgroundColor: '#999',
1372:   },
1373:   submitButtonText: {
1374:     fontSize: 16,
1375:     fontFamily: 'Inter-SemiBold',
1376:     color: '#FFFFFF',
1377:   },
1378: });
1379: 

==== AUDIT: C:\Users\MILLET IMMOBILIER\OneDrive\Bureau\project\app\auth\login.tsx ====
   1: import React, { useState } from 'react';
   2: import {
   3:   View,
   4:   Text,
   5:   TextInput,
   6:   TouchableOpacity,
   7:   StyleSheet,
   8:   ActivityIndicator,
   9:   Alert,
  10: } from 'react-native';
  11: import { supabase } from '../../lib/supabase';
  12: import { router } from 'expo-router';
  13: import { SafeAreaView } from 'react-native-safe-area-context';
  14: import AsyncStorage from '@react-native-async-storage/async-storage';
  15: 
  16: export default function LoginScreen() {
  17:   const [email, setEmail] = useState('');
  18:   const [password, setPassword] = useState('');
  19:   const [loading, setLoading] = useState(false);
  20: 
  21:   console.log('LoginScreen rendered');
  22: 
  23:   const handleLogin = async () => {
  24:     setLoading(true);
  25:     console.log('Attempting login with email:', email);
  26:     const { error, data } = await supabase.auth.signInWithPassword({ email, password });
  27:     if (error) {
  28:       console.error('Login error:', error);
  29:       Alert.alert('Erreur', error.message);
  30:       setLoading(false);
  31:       return;
  32:     }
  33: 
  34:     const { data: { user } } = await supabase.auth.getUser();
  35:     console.log('User fetched:', user.id);
  36:     const { data: profile, error: profileError } = await supabase
  37:       .from('profiles')
  38:       .select('role')
  39:       .eq('id', user.id)
  40:       .single();
  41: 
  42:     if (profileError) {
  43:       console.error('Profile error:', profileError);
  44:     }
  45: 
  46:     if (profile?.role === 'client' || profile?.role === 'fourmiz') {
  47:       await AsyncStorage.setItem('savedRole', profile.role);
  48:       console.log('Saved role:', profile.role);
  49:     }
  50: 
  51:     router.replace('/');
  52:     setLoading(false);
  53:   };
  54: 
  55:   return (
  56:     <SafeAreaView style={styles.container}>
  57:       <Text style={styles.title}>Bienvenue sur Fourmiz</Text>
  58:       <TextInput
  59:         style={styles.input}
  60:         placeholder="Email"
  61:         value={email}
  62:         onChangeText={setEmail}
  63:         keyboardType="email-address"
  64:         autoCapitalize="none"
  65:       />
  66:       <TextInput
  67:         style={styles.input}
  68:         placeholder="Mot de passe"
  69:         value={password}
  70:         onChangeText={setPassword}
  71:         secureTextEntry
  72:       />
  73:       <TouchableOpacity style={styles.button} onPress={handleLogin} disabled={loading}>
  74:         {loading ? (
  75:           <ActivityIndicator color="#fff" />
  76:         ) : (
  77:           <Text style={styles.buttonText}>Se connecter</Text>
  78:         )}
  79:       </TouchableOpacity>
  80:       <TouchableOpacity onPress={() => router.push('/auth/register')} style={styles.link}>
  81:         <Text style={styles.linkText}>Pas encore inscrit ?</Text>
  82:       </TouchableOpacity>
  83:       <TouchableOpacity
  84:         onPress={async () => {
  85:           await AsyncStorage.multiRemove(['isLoggedIn', 'userSession', 'savedRole']);
  86:           Alert.alert('Session efface', 'Veuillez vous reconnecter.');
  87:         }}
  88:         style={styles.link}
  89:       >
  90:         <Text style={styles.linkText}>Effacer la session</Text>
  91:       </TouchableOpacity>
  92:     </SafeAreaView>
  93:   );
  94: }
  95: 
  96: const styles = StyleSheet.create({
  97:   container: {
  98:     flex: 1,
  99:     justifyContent: 'center',
 100:     paddingHorizontal: 20,
 101:     backgroundColor: '#fff',
 102:   },
 103:   title: {
 104:     fontSize: 24,
 105:     textAlign: 'center',
 106:     marginBottom: 20,
 107:     fontWeight: 'bold',
 108:     color: '#FF3C38',
 109:   },
 110:   input: {
 111:     borderWidth: 1,
 112:     borderColor: '#ddd',
 113:     padding: 12,
 114:     borderRadius: 10,
 115:     marginBottom: 12,
 116:     backgroundColor: '#fafafa',
 117:   },
 118:   button: {
 119:     backgroundColor: '#FF3C38',
 120:     padding: 14,
 121:     borderRadius: 10,
 122:     alignItems: 'center',
 123:     marginTop: 10,
 124:   },
 125:   buttonText: {
 126:     color: '#fff',
 127:     fontWeight: 'bold',
 128:   },
 129:   link: {
 130:     marginTop: 20,
 131:     alignItems: 'center',
 132:   },
 133:   linkText: {
 134:     color: '#555',
 135:     textDecorationLine: 'underline',
 136:   },
 137: });

==== AUDIT: C:\Users\MILLET IMMOBILIER\OneDrive\Bureau\project\app\auth\recovery.tsx ====
   1: import { useEffect, useState } from 'react';
   2: import { supabase } from '../../lib/supabase';
   3: import { router, useLocalSearchParams } from 'expo-router';
   4: import { ActivityIndicator, View, Text, StyleSheet } from 'react-native';
   5: import { SafeAreaView } from 'react-native-safe-area-context';
   6: 
   7: export default function RecoveryRedirectScreen() {
   8:   const { type, access_token } = useLocalSearchParams();
   9:   const [status, setStatus] = useState<'loading' | 'success' | 'error'>('loading');
  10: 
  11:   useEffect(() => {
  12:     const handleRecovery = async () => {
  13:       if (type === 'recovery' && access_token) {
  14:         const { data, error } = await supabase.auth.setSession({
  15:           access_token: access_token as string,
  16:           refresh_token: '', // refresh_token peut être vide pour recovery
  17:         });
  18: 
  19:         if (error) {
  20:           console.error('Erreur de session recovery :', error.message);
  21:           setStatus('error');
  22:         } else {
  23:           setStatus('success');
  24:           router.replace('/auth/updatePassword');
  25:         }
  26:       } else {
  27:         setStatus('error');
  28:       }
  29:     };
  30:     handleRecovery();
  31:   }, [type, access_token]);
  32: 
  33:   return (
  34:     <SafeAreaView style={styles.container}>
  35:       {status === 'loading' && <ActivityIndicator size="large" color="#FF4444" />}
  36:       {status === 'error' && <Text style={styles.text}>Erreur lors de la récupération de session.</Text>}
  37:       {status === 'success' && <Text style={styles.text}>Redirection...</Text>}
  38:     </SafeAreaView>
  39:   );
  40: }
  41: 
  42: const styles = StyleSheet.create({
  43:   container: {
  44:     flex: 1,
  45:     justifyContent: 'center',
  46:     alignItems: 'center',
  47:     padding: 20,
  48:   },
  49:   text: {
  50:     fontSize: 16,
  51:     textAlign: 'center',
  52:   },
  53: });

==== AUDIT: C:\Users\MILLET IMMOBILIER\OneDrive\Bureau\project\app\auth\register.tsx ====
   1: import React, { useState } from 'react';
   2: import {
   3:   View,
   4:   Text,
   5:   StyleSheet,
   6:   TouchableOpacity,
   7:   TextInput,
   8:   Alert,
   9:   KeyboardAvoidingView,
  10:   Platform,
  11:   ActivityIndicator,
  12:   ScrollView,
  13: } from 'react-native';
  14: import { SafeAreaView } from 'react-native-safe-area-context';
  15: import { Eye, EyeOff } from 'lucide-react-native';
  16: import { supabase } from '../../lib/supabase';
  17: import { router } from 'expo-router';
  18: import Animated, {
  19:   useSharedValue,
  20:   useAnimatedStyle,
  21:   withRepeat,
  22:   withTiming,
  23: } from 'react-native-reanimated';
  24: 
  25: export default function RegisterScreen() {
  26:   const [showPassword, setShowPassword] = useState(false);
  27:   const [isLoading, setIsLoading] = useState(false);
  28:   const [formData, setFormData] = useState({ email: '', password: '', confirmPassword: '' });
  29:   const [errors, setErrors] = useState({});
  30: 
  31:   // Animation logo
  32:   const rotation = useSharedValue(0);
  33:   React.useEffect(() => {
  34:     rotation.value = withRepeat(withTiming(360, { duration: 3000 }), -1);
  35:   }, []);
  36:   const animatedStyle = useAnimatedStyle(() => ({
  37:     transform: [{ rotate: `${rotation.value}deg` }],
  38:   }));
  39: 
  40:   const updateFormData = (field, value) => {
  41:     setFormData(prev => ({ ...prev, [field]: value }));
  42:     if (errors[field]) setErrors(prev => ({ ...prev, [field]: '' }));
  43:   };
  44: 
  45:   const validateForm = () => {
  46:     const newErrors = {};
  47:     if (!formData.email.trim()) {
  48:       newErrors.email = 'Email requis';
  49:     } else if (!/\S+@\S+\.\S+/.test(formData.email)) {
  50:       newErrors.email = 'Email invalide';
  51:     }
  52:     if (!formData.password) {
  53:       newErrors.password = 'Mot de passe requis';
  54:     } else if (formData.password.length < 8) {
  55:       newErrors.password = 'Le mot de passe doit contenir au moins 8 caractères';
  56:     }
  57:     if (formData.password !== formData.confirmPassword) {
  58:       newErrors.confirmPassword = 'Les mots de passe ne correspondent pas';
  59:     }
  60:     setErrors(newErrors);
  61:     return Object.keys(newErrors).length === 0;
  62:   };
  63: 
  64:   const handleRegister = async () => {
  65:     if (!validateForm()) return;
  66:     setIsLoading(true);
  67:     try {
  68:       const { data, error } = await supabase.auth.signUp({
  69:         email: formData.email,
  70:         password: formData.password,
  71:       });
  72: 
  73:       if (error) {
  74:         Alert.alert('Erreur', error.message);
  75:         setIsLoading(false);
  76:         return;
  77:       }
  78: 
  79:       Alert.alert(
  80:         'Inscription réussie',
  81:         'Un email de confirmation vous a été envoyé. Veuillez valider votre adresse email pour accéder à l’application.',
  82:         [
  83:           { text: 'OK', onPress: () => router.push('/auth/login') },
  84:         ]
  85:       );
  86:     } catch (err) {
  87:       console.error(err);
  88:       Alert.alert('Erreur', 'Une erreur est survenue');
  89:     } finally {
  90:       setIsLoading(false);
  91:     }
  92:   };
  93: 
  94:   return (
  95:     <SafeAreaView style={styles.container}>
  96:       <KeyboardAvoidingView
  97:         style={styles.inner}
  98:         behavior={Platform.OS === 'ios' ? 'padding' : undefined}
  99:       >
 100:         <ScrollView contentContainerStyle={{ flexGrow: 1, justifyContent: 'center' }}>
 101:           <View style={styles.logoContainer}>
 102:             <Animated.Image
 103:               source={require('../../assets/ant-logo.png')}
 104:               style={[styles.logo, animatedStyle]}
 105:               resizeMode="contain"
 106:             />
 107:             <Text style={styles.title}>Créer un compte</Text>
 108:           </View>
 109: 
 110:           <View style={styles.form}>
 111:             <TextInput
 112:               placeholder="Adresse e-mail"
 113:               style={styles.input}
 114:               keyboardType="email-address"
 115:               autoCapitalize="none"
 116:               value={formData.email}
 117:               onChangeText={text => updateFormData('email', text)}
 118:               placeholderTextColor="#999"
 119:             />
 120:             {errors.email && <Text style={styles.error}>{errors.email}</Text>}
 121: 
 122:             <View style={styles.inputWrapper}>
 123:               <TextInput
 124:                 placeholder="Mot de passe (min 8 caractères)"
 125:                 style={styles.inputInner}
 126:                 secureTextEntry={!showPassword}
 127:                 value={formData.password}
 128:                 onChangeText={text => updateFormData('password', text)}
 129:                 placeholderTextColor="#999"
 130:               />
 131:               <TouchableOpacity onPress={() => setShowPassword(!showPassword)}>
 132:                 {showPassword ? <EyeOff size={22} /> : <Eye size={22} />}
 133:               </TouchableOpacity>
 134:             </View>
 135:             {errors.password && <Text style={styles.error}>{errors.password}</Text>}
 136: 
 137:             <View style={styles.inputWrapper}>
 138:               <TextInput
 139:                 placeholder="Confirmer le mot de passe"
 140:                 style={styles.inputInner}
 141:                 secureTextEntry={!showPassword}
 142:                 value={formData.confirmPassword}
 143:                 onChangeText={text => updateFormData('confirmPassword', text)}
 144:                 placeholderTextColor="#999"
 145:               />
 146:               <TouchableOpacity onPress={() => setShowPassword(!showPassword)}>
 147:                 {showPassword ? <EyeOff size={22} /> : <Eye size={22} />}
 148:               </TouchableOpacity>
 149:             </View>
 150:             {errors.confirmPassword && <Text style={styles.error}>{errors.confirmPassword}</Text>}
 151: 
 152:             <TouchableOpacity
 153:               style={styles.button}
 154:               onPress={handleRegister}
 155:               disabled={isLoading}
 156:             >
 157:               {isLoading ? (
 158:                 <ActivityIndicator color="#fff" />
 159:               ) : (
 160:                 <Text style={styles.buttonText}>S'inscrire</Text>
 161:               )}
 162:             </TouchableOpacity>
 163: 
 164:             <View style={styles.loginRedirect}>
 165:               <Text style={{ fontSize: 14 }}>
 166:                 Déjà un compte ?{' '}
 167:                 <Text
 168:                   style={styles.loginRedirectLink}
 169:                   onPress={() => router.push('/auth/login')}
 170:                 >
 171:                   Se connecter
 172:                 </Text>
 173:               </Text>
 174:             </View>
 175:           </View>
 176:         </ScrollView>
 177:       </KeyboardAvoidingView>
 178:     </SafeAreaView>
 179:   );
 180: }
 181: 
 182: const styles = StyleSheet.create({
 183:   container: { flex: 1, backgroundColor: '#fff' },
 184:   inner: { flex: 1, paddingHorizontal: 24 },
 185:   logoContainer: { alignItems: 'center', marginBottom: 40 },
 186:   logo: { width: 120, height: 120 },
 187:   title: { fontSize: 24, fontWeight: '600', color: '#000', marginTop: 8 },
 188:   form: { width: '100%' },
 189:   input: {
 190:     height: 48,
 191:     borderWidth: 1,
 192:     borderColor: '#ddd',
 193:     borderRadius: 8,
 194:     paddingHorizontal: 12,
 195:     marginBottom: 12,
 196:     fontSize: 16,
 197:     backgroundColor: '#f9f9f9',
 198:   },
 199:   inputWrapper: {
 200:     flexDirection: 'row',
 201:     alignItems: 'center',
 202:     borderWidth: 1,
 203:     borderColor: '#ddd',
 204:     borderRadius: 8,
 205:     paddingHorizontal: 12,
 206:     backgroundColor: '#f9f9f9',
 207:     marginBottom: 12,
 208:     height: 48,
 209:   },
 210:   inputInner: { flex: 1, fontSize: 16 },
 211:   error: { color: 'red', fontSize: 13, marginBottom: 8 },
 212:   button: {
 213:     backgroundColor: '#FF3C38',
 214:     paddingVertical: 14,
 215:     borderRadius: 8,
 216:     alignItems: 'center',
 217:     marginTop: 16,
 218:   },
 219:   buttonText: { color: '#fff', fontSize: 16, fontWeight: '600' },
 220:   loginRedirect: { marginTop: 30, alignItems: 'center' },
 221:   loginRedirectLink: {
 222:     color: '#FF3C38',
 223:     fontWeight: '600',
 224:     textDecorationLine: 'underline',
 225:   },
 226: });
 227: 

==== AUDIT: C:\Users\MILLET IMMOBILIER\OneDrive\Bureau\project\app\auth\signup.tsx ====
   1: import React, { useState } from 'react';
   2: import {
   3:   View,
   4:   Text,
   5:   TextInput,
   6:   Button,
   7:   StyleSheet,
   8:   Alert,
   9:   TouchableOpacity,
  10: } from 'react-native';
  11: import { SafeAreaView } from 'react-native-safe-area-context';
  12: import { supabase } from '../../lib/supabase';
  13: import { router } from 'expo-router';
  14: 
  15: export default function SignupScreen() {
  16:   const [firstname, setFirstname] = useState('');
  17:   const [email, setEmail] = useState('');
  18:   const [password, setPassword] = useState('');
  19:   const [role, setRole] = useState<'client' | 'fourmiz'>('client');
  20:   const [isLoading, setIsLoading] = useState(false);
  21: 
  22:   const handleSignup = async () => {
  23:     if (!firstname || !email || !password) {
  24:       Alert.alert('Champs requis', 'Merci de remplir tous les champs.');
  25:       return;
  26:     }
  27: 
  28:     setIsLoading(true);
  29: 
  30:     const { data: { user }, error: signUpError } = await supabase.auth.signUp({ email, password });
  31: 
  32:     if (signUpError || !user) {
  33:       Alert.alert('Erreur', signUpError?.message || 'Erreur à l’inscription.');
  34:       setIsLoading(false);
  35:       return;
  36:     }
  37: 
  38:     const { error: profileError } = await supabase.from('profiles').insert({
  39:       id: user.id,
  40:       firstname,
  41:       role,
  42:     });
  43: 
  44:     if (profileError) {
  45:       Alert.alert('Erreur profil', profileError.message);
  46:     } else {
  47:       Alert.alert('Bienvenue !', 'Votre compte a bien été créé.');
  48:       router.replace('/(tabs)?mode=' + role); // redirige vers le tableau de bord
  49:     }
  50: 
  51:     setIsLoading(false);
  52:   };
  53: 
  54:   return (
  55:     <SafeAreaView style={styles.container}>
  56:       <Text style={styles.title}>Créer un compte</Text>
  57: 
  58:       <TextInput
  59:         placeholder="Prénom"
  60:         value={firstname}
  61:         onChangeText={setFirstname}
  62:         style={styles.input}
  63:       />
  64: 
  65:       <TextInput
  66:         placeholder="Email"
  67:         value={email}
  68:         onChangeText={setEmail}
  69:         autoCapitalize="none"
  70:         keyboardType="email-address"
  71:         style={styles.input}
  72:       />
  73: 
  74:       <TextInput
  75:         placeholder="Mot de passe"
  76:         value={password}
  77:         onChangeText={setPassword}
  78:         secureTextEntry
  79:         style={styles.input}
  80:       />
  81: 
  82:       <Text style={styles.roleLabel}>Choisissez votre rôle :</Text>
  83:       <View style={styles.roleSelector}>
  84:         <TouchableOpacity
  85:           style={[styles.roleButton, role === 'client' && styles.activeRole]}
  86:           onPress={() => setRole('client')}
  87:         >
  88:           <Text style={styles.roleText}>Client</Text>
  89:         </TouchableOpacity>
  90:         <TouchableOpacity
  91:           style={[styles.roleButton, role === 'fourmiz' && styles.activeRole]}
  92:           onPress={() => setRole('fourmiz')}
  93:         >
  94:           <Text style={styles.roleText}>Fourmiz</Text>
  95:         </TouchableOpacity>
  96:       </View>
  97: 
  98:       <Button
  99:         title={isLoading ? 'Création en cours...' : 'Créer mon compte'}
 100:         onPress={handleSignup}
 101:         disabled={isLoading}
 102:       />
 103:     </SafeAreaView>
 104:   );
 105: }
 106: 
 107: const styles = StyleSheet.create({
 108:   container: {
 109:     flex: 1,
 110:     padding: 20,
 111:     justifyContent: 'center',
 112:     backgroundColor: '#fff',
 113:   },
 114:   title: {
 115:     fontSize: 24,
 116:     fontWeight: 'bold',
 117:     textAlign: 'center',
 118:     marginBottom: 24,
 119:   },
 120:   input: {
 121:     borderWidth: 1,
 122:     borderColor: '#ccc',
 123:     borderRadius: 8,
 124:     padding: 12,
 125:     marginBottom: 12,
 126:   },
 127:   roleLabel: {
 128:     fontSize: 16,
 129:     marginBottom: 8,
 130:   },
 131:   roleSelector: {
 132:     flexDirection: 'row',
 133:     justifyContent: 'space-between',
 134:     marginBottom: 20,
 135:   },
 136:   roleButton: {
 137:     flex: 1,
 138:     padding: 12,
 139:     borderRadius: 8,
 140:     borderWidth: 1,
 141:     borderColor: '#ccc',
 142:     marginHorizontal: 5,
 143:     alignItems: 'center',
 144:   },
 145:   activeRole: {
 146:     backgroundColor: '#FF4444',
 147:     borderColor: '#FF4444',
 148:   },
 149:   roleText: {
 150:     color: '#fff',
 151:     fontWeight: '600',
 152:   },
 153: });
 154: 

==== AUDIT: C:\Users\MILLET IMMOBILIER\OneDrive\Bureau\project\app\auth\updatePassword.tsx ====
   1: import React, { useState } from 'react';
   2: import {
   3:   View,
   4:   Text,
   5:   TextInput,
   6:   Button,
   7:   StyleSheet,
   8:   Alert,
   9: } from 'react-native';
  10: import { SafeAreaView } from 'react-native-safe-area-context';
  11: import { supabase } from '../../lib/supabase';
  12: import { router } from 'expo-router';
  13: 
  14: export default function UpdatePasswordScreen() {
  15:   const [password, setPassword] = useState('');
  16:   const [loading, setLoading] = useState(false);
  17: 
  18:   const handleUpdatePassword = async () => {
  19:     if (!password || password.length < 6) {
  20:       Alert.alert('Mot de passe trop court', 'Veuillez entrer un mot de passe d’au moins 6 caractères.');
  21:       return;
  22:     }
  23: 
  24:     setLoading(true);
  25:     const { error } = await supabase.auth.updateUser({ password });
  26:     setLoading(false);
  27: 
  28:     if (error) {
  29:       Alert.alert('Erreur', error.message);
  30:     } else {
  31:       Alert.alert('Succès', 'Mot de passe mis à jour. Vous pouvez maintenant vous reconnecter.');
  32:       router.replace('/auth/login');
  33:     }
  34:   };
  35: 
  36:   return (
  37:     <SafeAreaView style={styles.container}>
  38:       <Text style={styles.title}>Nouveau mot de passe</Text>
  39:       <TextInput
  40:         secureTextEntry
  41:         placeholder="Nouveau mot de passe"
  42:         value={password}
  43:         onChangeText={setPassword}
  44:         style={styles.input}
  45:       />
  46:       <Button
  47:         title={loading ? 'Mise à jour...' : 'Mettre à jour'}
  48:         onPress={handleUpdatePassword}
  49:         disabled={loading}
  50:       />
  51:     </SafeAreaView>
  52:   );
  53: }
  54: 
  55: const styles = StyleSheet.create({
  56:   container: {
  57:     flex: 1,
  58:     padding: 20,
  59:     justifyContent: 'center',
  60:     backgroundColor: '#fff',
  61:   },
  62:   title: {
  63:     fontSize: 22,
  64:     fontWeight: 'bold',
  65:     textAlign: 'center',
  66:     marginBottom: 24,
  67:   },
  68:   input: {
  69:     borderWidth: 1,
  70:     borderColor: '#ccc',
  71:     borderRadius: 8,
  72:     padding: 12,
  73:     marginBottom: 16,
  74:   },
  75: });
  76: 

==== AUDIT: C:\Users\MILLET IMMOBILIER\OneDrive\Bureau\project\app\auth\_layout.tsx ====
   1: import { Stack } from 'expo-router';
   2: 
   3: export default function AuthLayout() {
   4:   return (
   5:     <Stack screenOptions={{ headerShown: false }}>
   6:       <Stack.Screen name="login" />
   7:       <Stack.Screen name="client-register" />
   8:       <Stack.Screen name="fourmiz-register" />
   9:     </Stack>
  10:   );
  11: }
  12: 

==== AUDIT: C:\Users\MILLET IMMOBILIER\OneDrive\Bureau\project\app\(tabs)\services\index.tsx ====
   1: import React, { useEffect, useState } from 'react';
   2: import { View, Text, FlatList, TouchableOpacity, StyleSheet } from 'react-native';
   3: import { SafeAreaView } from 'react-native-safe-area-context';
   4: import { router } from 'expo-router';
   5: import { supabase } from '../../../lib/supabase';
   6: 
   7: export default function ServicesScreen() {
   8:   const [services, setServices] = useState<any[]>([]);
   9:   const [isLoading, setIsLoading] = useState(true);
  10: 
  11:   useEffect(() => {
  12:     const fetchServices = async () => {
  13:       try {
  14:         const { data, error } = await supabase
  15:           .from('services')
  16:           .select('*');
  17:         if (error) throw error;
  18:         setServices(data || []);
  19:       } catch (err) {
  20:         console.error('Erreur lors du chargement des services:', err);
  21:       } finally {
  22:         setIsLoading(false);
  23:       }
  24:     };
  25: 
  26:     fetchServices();
  27:   }, []);
  28: 
  29:   const renderService = ({ item }: { item: any }) => (
  30:     <TouchableOpacity
  31:       style={styles.serviceItem}
  32:       onPress={() => router.push(`/(tabs)/services/${item.id}`)}
  33:     >
  34:       <Text style={styles.serviceTitle}>{item.title}</Text>
  35:       <Text style={styles.serviceDescription}>{item.description}</Text>
  36:     </TouchableOpacity>
  37:   );
  38: 
  39:   if (isLoading) {
  40:     return (
  41:       <SafeAreaView style={styles.centered}>
  42:         <Text>Chargement...</Text>
  43:       </SafeAreaView>
  44:     );
  45:   }
  46: 
  47:   return (
  48:     <SafeAreaView style={styles.container}>
  49:       <FlatList
  50:         data={services}
  51:         keyExtractor={(item) => item.id.toString()}
  52:         renderItem={renderService}
  53:         contentContainerStyle={styles.list}
  54:       />
  55:     </SafeAreaView>
  56:   );
  57: }
  58: 
  59: const styles = StyleSheet.create({
  60:   container: { flex: 1, backgroundColor: '#fff' },
  61:   centered: { flex: 1, justifyContent: 'center', alignItems: 'center' },
  62:   list: { padding: 16 },
  63:   serviceItem: {
  64:     padding: 16,
  65:     marginBottom: 8,
  66:     backgroundColor: '#f9f9f9',
  67:     borderRadius: 8,
  68:   },
  69:   serviceTitle: { fontSize: 18, fontWeight: 'bold' },
  70:   serviceDescription: { fontSize: 14, color: '#666' },
  71: });

==== AUDIT: C:\Users\MILLET IMMOBILIER\OneDrive\Bureau\project\app\(tabs)\services\[id].tsx ====

 Impossible de lire : C:\Users\MILLET IMMOBILIER\OneDrive\Bureau\project\app\(tabs)\services\[id].tsx

==== AUDIT: C:\Users\MILLET IMMOBILIER\OneDrive\Bureau\project\app\(tabs)\services\_layout.tsx ====
   1: import { Stack } from 'expo-router';
   2: 
   3: export default function ServicesLayout() {
   4:   return (
   5:     <Stack screenOptions={{ headerShown: true }}>
   6:       <Stack.Screen name="index" options={{ title: 'Services' }} />
   7:       <Stack.Screen name="[id]" options={{ title: 'Dtails du service' }} />
   8:     </Stack>
   9:   );
  10: }

==== AUDIT: C:\Users\MILLET IMMOBILIER\OneDrive\Bureau\project\app\(tabs)\index.tsx ====
   1: import React, { useEffect, useState } from 'react';
   2: import { View, Text, TouchableOpacity, StyleSheet, ActivityIndicator } from 'react-native';
   3: import { SafeAreaView } from 'react-native-safe-area-context';
   4: import { router } from 'expo-router';
   5: import { supabase } from '../../lib/supabase';
   6: import AsyncStorage from '@react-native-async-storage/async-storage';
   7: 
   8: export default function HomeScreen() {
   9:   const [userRole, setUserRole] = useState<'client' | 'fourmiz' | null>(null);
  10:   const [loading, setLoading] = useState(true);
  11:   const [selectedRole, setSelectedRole] = useState<'client' | 'fourmiz'>('client');
  12: 
  13:   useEffect(() => {
  14:     console.log('HomeScreen useEffect started');
  15:     async function loadUserRole() {
  16:       const { data: { user }, error } = await supabase.auth.getUser();
  17:       if (error || !user) {
  18:         console.error('Auth error:', error);
  19:         router.replace('/auth/login');
  20:         return;
  21:       }
  22:       console.log('User fetched:', user.id);
  23:       const { data: profile, error: profileError } = await supabase
  24:         .from('profiles')
  25:         .select('role')
  26:         .eq('id', user.id)
  27:         .single();
  28: 
  29:       if (profileError) {
  30:         console.error('Profile error:', profileError);
  31:       }
  32: 
  33:       let role: 'client' | 'fourmiz' = 'client';
  34:       if (!profileError && (profile?.role === 'client' || profile?.role === 'fourmiz')) {
  35:         role = profile.role;
  36:       }
  37: 
  38:       setUserRole(role);
  39: 
  40:       const storedRole = await AsyncStorage.getItem('savedRole') as ('client' | 'fourmiz') | null;
  41:       if (storedRole === 'client' || storedRole === 'fourmiz') {
  42:         setSelectedRole(storedRole);
  43:       } else {
  44:         setSelectedRole(role);
  45:       }
  46: 
  47:       setLoading(false);
  48:       console.log('HomeScreen useEffect completed');
  49:     }
  50:     loadUserRole();
  51:   }, []);
  52: 
  53:   if (loading || userRole === null) {
  54:     return (
  55:       <SafeAreaView style={styles.container}>
  56:         <ActivityIndicator size="large" color="#FF4444" />
  57:       </SafeAreaView>
  58:     );
  59:   }
  60: 
  61:   const actionsClient = [
  62:     { label: 'Rechercher un Service', icon: ClipboardList, path: '/(tabs)/services' },
  63:     { label: 'Mes Commandes', icon: Briefcase, path: '/(tabs)/orders' },
  64:     { label: 'Messages', icon: MessageCircle, path: '/(tabs)/messages' },
  65:     { label: 'Mon Profil', icon: User, path: '/(tabs)/profile' },
  66:   ];
  67: 
  68:   const actionsFourmiz = [
  69:     { label: 'Services proposs', icon: ClipboardList, path: '/(tabs)/services' },
  70:     { label: 'Mes Services', icon: Briefcase, path: '/(tabs)/orders' },
  71:     { label: 'Messages', icon: MessageCircle, path: '/(tabs)/messages' },
  72:     { label: 'Mon Profil', icon: User, path: '/(tabs)/profile' },
  73:   ];
  74: 
  75:   const actions = selectedRole === 'fourmiz' ? actionsFourmiz : actionsClient;
  76: 
  77:   const handleStatusChange = async (role: 'client' | 'fourmiz') => {
  78:     setSelectedRole(role);
  79:     await AsyncStorage.setItem('savedRole', role);
  80:   };
  81: 
  82:   return (
  83:     <SafeAreaView style={styles.container}>
  84:       <View style={styles.header}>
  85:         <Text style={styles.title}>Fourmiz</Text>
  86:         <Text style={styles.subtitle}>Services  la carte</Text>
  87:       </View>
  88:       <View style={styles.switcher}>
  89:         <TouchableOpacity
  90:           style={styles.switcherButton}
  91:           onPress={() => handleStatusChange(selectedRole === 'client' ? 'fourmiz' : 'client')}
  92:         >
  93:           <Text style={styles.switcherText}>
  94:             {selectedRole === 'client' ? ' Client' : ' Fourmiz'}
  95:           </Text>
  96:         </TouchableOpacity>
  97:       </View>
  98:       <ScrollView contentContainerStyle={styles.actionsContainer}>
  99:         {actions.map((action, index) => (
 100:           <TouchableOpacity
 101:             key={index}
 102:             style={styles.actionButton}
 103:             onPress={() => router.push(action.path)}
 104:           >
 105:             <action.icon size={28} color="#FF4444" />
 106:             <Text style={styles.actionLabel}>{action.label}</Text>
 107:           </TouchableOpacity>
 108:         ))}
 109:         <TouchableOpacity
 110:           style={styles.actionButton}
 111:           onPress={() => router.push('/auth/login')}
 112:         >
 113:           <Text style={styles.actionLabel}>Connexion</Text>
 114:         </TouchableOpacity>
 115:       </ScrollView>
 116:     </SafeAreaView>
 117:   );
 118: }
 119: 
 120: const styles = StyleSheet.create({
 121:   container: { flex: 1, paddingTop: 40, backgroundColor: '#fff' },
 122:   header: { alignItems: 'center', marginBottom: 20 },
 123:   title: { fontSize: 28, fontWeight: 'bold', color: '#000' },
 124:   subtitle: { fontSize: 14, color: '#666' },
 125:   switcher: { alignItems: 'center', marginVertical: 20 },
 126:   switcherButton: {
 127:     backgroundColor: '#FF3C38',
 128:     padding: 10,
 129:     borderRadius: 10,
 130:   },
 131:   switcherText: { color: '#fff', fontWeight: '700', textAlign: 'center' },
 132:   actionsContainer: {
 133:     flexDirection: 'row',
 134:     flexWrap: 'wrap',
 135:     justifyContent: 'center',
 136:     paddingHorizontal: 20,
 137:     gap: 16,
 138:   },
 139:   actionButton: {
 140:     width: 100,
 141:     height: 100,
 142:     borderRadius: 20,
 143:     backgroundColor: '#FFF2F2',
 144:     justifyContent: 'center',
 145:     alignItems: 'center',
 146:     margin: 8,
 147:   },
 148:   actionLabel: { fontSize: 12, color: '#333', textAlign: 'center', marginTop: 6 },
 149: });

==== AUDIT: C:\Users\MILLET IMMOBILIER\OneDrive\Bureau\project\app\(tabs)\messages.tsx ====
   1: import { SafeAreaView, Text, StyleSheet } from 'react-native';
   2: 
   3: export default function MessagesScreen() {
   4:   return (
   5:     <SafeAreaView style={styles.container}>
   6:       <Text style={styles.text}>cran Messages</Text>
   7:     </SafeAreaView>
   8:   );
   9: }
  10: 
  11: const styles = StyleSheet.create({
  12:   container: { flex: 1, justifyContent: 'center', alignItems: 'center', backgroundColor: '#fff' },
  13:   text: { fontSize: 18, color: '#000' },
  14: });

==== AUDIT: C:\Users\MILLET IMMOBILIER\OneDrive\Bureau\project\app\(tabs)\orders.tsx ====
   1: import React, { useEffect, useState } from 'react';
   2: import { View, Text, StyleSheet, FlatList, TouchableOpacity } from 'react-native';
   3: import { SafeAreaView } from 'react-native-safe-area-context';
   4: import { supabase } from '@/lib/supabase';
   5: 
   6: export default function OrdersScreen() {
   7:   const [orders, setOrders] = useState<any[]>([]);
   8:   const [loading, setLoading] = useState(true);
   9: 
  10:   useEffect(() => {
  11:     const fetchOrders = async () => {
  12:       const { data, error } = await supabase
  13:         .from('orders')
  14:         .select('*')
  15:         .order('created_at', { ascending: false });
  16: 
  17:       if (!error) setOrders(data || []);
  18:       setLoading(false);
  19:     };
  20: 
  21:     fetchOrders();
  22:   }, []);
  23: 
  24:   if (loading) {
  25:     return (
  26:       <SafeAreaView style={styles.container}>
  27:         <Text>Chargement...</Text>
  28:       </SafeAreaView>
  29:     );
  30:   }
  31: 
  32:   return (
  33:     <SafeAreaView style={styles.container}>
  34:       <FlatList
  35:         data={orders}
  36:         keyExtractor={(item) => item.id.toString()}
  37:         renderItem={({ item }) => (
  38:           <View style={styles.orderItem}>
  39:             <Text style={styles.orderText}>Commande #{item.id}</Text>
  40:             <Text style={styles.dateText}>
  41:             <Text style={styles.dateText}>
  42:               {item.created_at ? `Passe le ${new Date(item.created_at).toLocaleDateString()}` : 'Date inconnue'}
  43:             </Text>
  44:         )}
  45:       />
  46:     </SafeAreaView>
  47:   );
  48: }
  49: 
  50: const styles = StyleSheet.create({
  51:   container: {
  52:     flex: 1,
  53:     padding: 16,
  54:   },
  55:   orderItem: {
  56:     marginBottom: 12,
  57:     padding: 12,
  58:     backgroundColor: '#f2f2f2',
  59:     borderRadius: 8,
  60:   },
  61:   orderText: {
  62:     fontWeight: 'bold',
  63:     fontSize: 16,
  64:   },
  65:   dateText: {
  66:     marginTop: 4,
  67:     fontSize: 12,
  68:     color: '#555',
  69:   },
  70: });

==== AUDIT: C:\Users\MILLET IMMOBILIER\OneDrive\Bureau\project\app\(tabs)\profile.tsx ====
   1: import { SafeAreaView, Text, StyleSheet } from 'react-native';
   2: 
   3: export default function ProfileScreen() {
   4:   return (
   5:     <SafeAreaView style={styles.container}>
   6:       <Text style={styles.text}>cran Profil</Text>
   7:     </SafeAreaView>
   8:   );
   9: }
  10: 
  11: const styles = StyleSheet.create({
  12:   container: { flex: 1, justifyContent: 'center', alignItems: 'center', backgroundColor: '#fff' },
  13:   text: { fontSize: 18, color: '#000' },
  14: });

==== AUDIT: C:\Users\MILLET IMMOBILIER\OneDrive\Bureau\project\app\(tabs)\reseau.tsx ====
   1: import React, { useEffect, useState } from 'react';
   2: import {
   3:   View,
   4:   Text,
   5:   FlatList,
   6:   StyleSheet,
   7:   TouchableOpacity,
   8:   ToastAndroid,
   9:   Platform,
  10:   Share,
  11:   Dimensions,
  12: } from 'react-native';
  13: import { SafeAreaView } from 'react-native-safe-area-context';
  14: // Import relatif corrigé (pas d'alias @)
  15: import { supabase } from '../../lib/supabase';
  16: import { User2, Send } from 'lucide-react-native';
  17: // Expo Clipboard import corrigé
  18: import * as Clipboard from 'expo-clipboard';
  19: import * as Animatable from 'react-native-animatable';
  20: import { LineChart } from 'react-native-chart-kit';
  21: 
  22: export default function ReseauScreen() {
  23:   const [filleuls, setFilleuls] = useState([]);
  24:   const [filteredRole, setFilteredRole] = useState(null);
  25:   const [referralCode, setReferralCode] = useState('');
  26:   const [selectedYear, setSelectedYear] = useState(new Date().getFullYear());
  27:   const [growthData, setGrowthData] = useState(Array(12).fill(0));
  28: 
  29:   useEffect(() => {
  30:     const fetchFilleuls = async () => {
  31:       const { data: { user } } = await supabase.auth.getUser();
  32:       if (!user) return;
  33: 
  34:       const { data, error } = await supabase
  35:         .from('referrals')
  36:         .select('*, referred_user:profiles(id, firstname, lastname, role)')
  37:         .eq('sponsor_id', user.id);
  38: 
  39:       if (!error && data) {
  40:         setFilleuls(data);
  41:         const filtered = data.filter(f => f.validated_at);
  42:         const yearData = Array(12).fill(0);
  43:         filtered.forEach(f => {
  44:           const date = new Date(f.validated_at);
  45:           if (date.getFullYear() === selectedYear) {
  46:             yearData[date.getMonth()]++;
  47:           }
  48:         });
  49:         setGrowthData(yearData);
  50:       }
  51:     };
  52: 
  53:     const fetchReferralCode = async () => {
  54:       const { data: { user } } = await supabase.auth.getUser();
  55:       if (!user) return;
  56: 
  57:       const { data: profile } = await supabase
  58:         .from('profiles')
  59:         .select('referral_code')
  60:         .eq('id', user.id)
  61:         .single();
  62: 
  63:       if (profile?.referral_code) setReferralCode(profile.referral_code);
  64:     };
  65: 
  66:     fetchFilleuls();
  67:     fetchReferralCode();
  68:   }, [selectedYear]);
  69: 
  70:   const filteredFilleuls = filteredRole
  71:     ? filleuls.filter((f) => f.referred_user?.role === filteredRole)
  72:     : filleuls;
  73: 
  74:   const count = filteredFilleuls.length;
  75: 
  76:   const handleInvite = async () => {
  77:     const url = `https://fourmiz.app/signup?ref=${referralCode}`;
  78:     try {
  79:       await Share.share({
  80:         message: `Rejoins-moi sur Fourmiz et profite d’un bonus de bienvenue ! 🐜\n\nLien d’inscription : ${url}`,
  81:       });
  82:     } catch (error) {
  83:       console.error('Erreur lors du partage :', error.message);
  84:     }
  85:   };
  86: 
  87:   const copyToClipboard = async () => {
  88:     await Clipboard.setStringAsync(referralCode);
  89:     if (Platform.OS === 'android') {
  90:       ToastAndroid.show('Code copié !', ToastAndroid.SHORT);
  91:     }
  92:   };
  93: 
  94:   // Affiche uniquement l'année en cours (pour l'instant)
  95:   const currentYear = new Date().getFullYear();
  96:   const years = [currentYear]; 
  97:   // Pour historique futur: const years = Array.from({ length: 5 }, (_, i) => currentYear - i);
  98: 
  99:   return (
 100:     <SafeAreaView style={styles.container}>
 101:       <Text style={styles.title}>Mon Réseau</Text>
 102:       <Text style={styles.subtitle}>Nombre de filleuls : {count}</Text>
 103: 
 104:       <View style={{ marginBottom: 16 }}>
 105:         <TouchableOpacity style={styles.inviteButton} onPress={handleInvite}>
 106:           <Send size={18} color="white" style={{ marginRight: 8 }} />
 107:           <Text style={styles.inviteButtonText}>Inviter un filleul</Text>
 108:         </TouchableOpacity>
 109: 
 110:         <TouchableOpacity onPress={copyToClipboard} style={styles.codeBox}>
 111:           <Text style={styles.codeLabel}>Mon code parrain :</Text>
 112:           <Text style={styles.codeValue}>{referralCode} (appuyer pour copier)</Text>
 113:         </TouchableOpacity>
 114:       </View>
 115: 
 116:       <View style={styles.filters}>
 117:         {['client', 'fourmiz'].map((role) => (
 118:           <TouchableOpacity
 119:             key={role}
 120:             style={[styles.filterButton, filteredRole === role && styles.filterButtonActive]}
 121:             onPress={() => setFilteredRole(filteredRole === role ? null : role)}
 122:           >
 123:             <Text style={filteredRole === role ? styles.filterTextActive : styles.filterText}>{role}</Text>
 124:           </TouchableOpacity>
 125:         ))}
 126:       </View>
 127: 
 128:       <View style={{ marginBottom: 16 }}>
 129:         <Text style={{ fontWeight: 'bold', marginBottom: 4 }}>Croissance du réseau ({selectedYear})</Text>
 130:         <View style={styles.yearSelector}>
 131:           {years.map((y) => (
 132:             <TouchableOpacity
 133:               key={y}
 134:               style={[styles.yearButton, selectedYear === y && styles.yearButtonActive]}
 135:               onPress={() => setSelectedYear(y)}
 136:             >
 137:               <Text style={selectedYear === y ? styles.filterTextActive : styles.filterText}>{y}</Text>
 138:             </TouchableOpacity>
 139:           ))}
 140:         </View>
 141:         <LineChart
 142:           data={{
 143:             labels: ['Jan', 'Fév', 'Mar', 'Avr', 'Mai', 'Juin', 'Juil', 'Août', 'Sep', 'Oct', 'Nov', 'Déc'],
 144:             datasets: [{ data: growthData }],
 145:           }}
 146:           width={Dimensions.get('window').width - 32}
 147:           height={220}
 148:           yAxisLabel=""
 149:           chartConfig={{
 150:             backgroundColor: '#fff',
 151:             backgroundGradientFrom: '#fff',
 152:             backgroundGradientTo: '#fff',
 153:             decimalPlaces: 0,
 154:             color: (opacity = 1) => `rgba(255, 102, 0, ${opacity})`,
 155:             labelColor: () => '#333',
 156:           }}
 157:           bezier
 158:           style={{ borderRadius: 12 }}
 159:         />
 160:       </View>
 161: 
 162:       <FlatList
 163:         data={filteredFilleuls}
 164:         keyExtractor={(item) => item.id.toString()}
 165:         renderItem={({ item }) => {
 166:           const profile = item.referred_user;
 167:           const validated = item.validated_at;
 168:           const isRecent = validated && new Date().getTime() - new Date(validated).getTime() < 86400000;
 169:           return (
 170:             <Animatable.View
 171:               animation={validated ? 'fadeInUp' : 'fadeIn'}
 172:               duration={600}
 173:               style={[styles.item, isRecent && { backgroundColor: '#d4edda' }]}
 174:             >
 175:               <User2 size={20} color="#444" style={{ marginRight: 8 }} />
 176:               <View>
 177:                 <Text>{profile?.firstname} {profile?.lastname}</Text>
 178:                 <Text style={styles.details}>🧑‍💼 {profile?.role}</Text>
 179:                 <Text style={styles.details}>📅 Inscrit le {new Date(item.created_at).toLocaleDateString()}</Text>
 180:                 {validated && (
 181:                   <Text style={styles.validated}>✅ Validé depuis le {new Date(validated).toLocaleDateString()}</Text>
 182:                 )}
 183:               </View>
 184:             </Animatable.View>
 185:           );
 186:         }}
 187:         ListEmptyComponent={<Text style={{ textAlign: 'center', marginTop: 20 }}>Aucun filleul pour ce filtre.</Text>}
 188:       />
 189:     </SafeAreaView>
 190:   );
 191: }
 192: 
 193: const styles = StyleSheet.create({
 194:   container: { flex: 1, padding: 16 },
 195:   title: { fontSize: 24, fontWeight: 'bold', marginBottom: 8 },
 196:   subtitle: { fontSize: 16, marginBottom: 12 },
 197:   inviteButton: {
 198:     flexDirection: 'row',
 199:     backgroundColor: '#FF6600',
 200:     padding: 12,
 201:     borderRadius: 10,
 202:     alignItems: 'center',
 203:     justifyContent: 'center',
 204:     marginBottom: 12,
 205:   },
 206:   inviteButtonText: {
 207:     color: 'white',
 208:     fontWeight: 'bold',
 209:     fontSize: 16,
 210:   },
 211:   codeBox: {
 212:     backgroundColor: '#f2f2f2',
 213:     padding: 10,
 214:     borderRadius: 8,
 215:   },
 216:   codeLabel: {
 217:     fontSize: 13,
 218:     color: '#888',
 219:     marginBottom: 4,
 220:   },
 221:   codeValue: {
 222:     fontSize: 16,
 223:     fontWeight: '600',
 224:     color: '#333',
 225:   },
 226:   item: {
 227:     flexDirection: 'row',
 228:     alignItems: 'center',
 229:     marginBottom: 16,
 230:     padding: 12,
 231:     backgroundColor: '#f1f1f1',
 232:     borderRadius: 10,
 233:   },
 234:   details: { fontSize: 13, color: '#555' },
 235:   validated: { fontSize: 13, color: 'green', marginTop: 4 },
 236:   filters: { flexDirection: 'row', gap: 12, marginBottom: 16 },
 237:   filterButton: {
 238:     paddingVertical: 6,
 239:     paddingHorizontal: 12,
 240:     backgroundColor: '#eee',
 241:     borderRadius: 20,
 242:   },
 243:   filterButtonActive: { backgroundColor: '#FF6600' },
 244:   filterText: { color: '#333' },
 245:   filterTextActive: { color: 'white', fontWeight: 'bold' },
 246:   yearSelector: { flexDirection: 'row', gap: 12, marginVertical: 8 },
 247:   yearButton: {
 248:     paddingVertical: 4,
 249:     paddingHorizontal: 10,
 250:     backgroundColor: '#eee',
 251:     borderRadius: 16,
 252:   },
 253:   yearButtonActive: {
 254:     backgroundColor: '#FF6600',
 255:   },
 256: });
 257: 

==== AUDIT: C:\Users\MILLET IMMOBILIER\OneDrive\Bureau\project\app\(tabs)\revenus.tsx ====
   1: import React, { useEffect, useState } from 'react';
   2: import {
   3:   View,
   4:   Text,
   5:   FlatList,
   6:   StyleSheet,
   7:   ScrollView,
   8:   Dimensions,
   9:   TouchableOpacity,
  10: } from 'react-native';
  11: import { SafeAreaView } from 'react-native-safe-area-context';
  12: import { supabase } from '../../lib/supabase';
  13: import { BarChart } from 'react-native-gifted-charts';
  14: import { Gift, Coins, Percent, Award } from 'lucide-react-native';
  15: 
  16: export default function RevenusScreen() {
  17:   const [gains, setGains] = useState([]);
  18:   const [total, setTotal] = useState(0);
  19:   const [monthlyData, setMonthlyData] = useState([]);
  20:   const [selectedYear, setSelectedYear] = useState(new Date().getFullYear());
  21:   const [selectedMonth, setSelectedMonth] = useState(null);
  22:   const [availableYears, setAvailableYears] = useState<number[]>([]);
  23: 
  24:   useEffect(() => {
  25:     const fetchGains = async () => {
  26:       const { data: { user } } = await supabase.auth.getUser();
  27:       const { data, error } = await supabase
  28:         .from('referral_gains')
  29:         .select('*')
  30:         .eq('sponsor_id', user.id);
  31: 
  32:       if (!error && data) {
  33:         setGains(data);
  34:         const sum = data.reduce((acc, item) => acc + (item.amount || 0), 0);
  35:         setTotal(sum);
  36:         extractYears(data);
  37:         generateMonthlyData(data, selectedYear);
  38:       }
  39:     };
  40: 
  41:     fetchGains();
  42:   }, []);
  43: 
  44:   useEffect(() => {
  45:     generateMonthlyData(gains, selectedYear);
  46:   }, [selectedYear]);
  47: 
  48:   const extractYears = (data) => {
  49:     const years = new Set();
  50:     data.forEach((item) => {
  51:       const year = new Date(item.created_at).getFullYear();
  52:       years.add(year);
  53:     });
  54:     setAvailableYears(Array.from(years).sort((a, b) => b - a));
  55:   };
  56: 
  57:   const generateMonthlyData = (data, year) => {
  58:     const grouped = {};
  59:     data
  60:       .filter((item) => new Date(item.created_at).getFullYear() === year)
  61:       .forEach((item) => {
  62:         const date = new Date(item.created_at);
  63:         const month = String(date.getMonth() + 1).padStart(2, '0');
  64:         if (!grouped[month]) grouped[month] = 0;
  65:         grouped[month] += item.amount || 0;
  66:       });
  67: 
  68:     const formatted = Array.from({ length: 12 }, (_, i) => {
  69:       const key = String(i + 1).padStart(2, '0');
  70:       return {
  71:         label: `${key}/${String(year).slice(2)}`,
  72:         value: parseFloat(grouped[key]?.toFixed(2) || '0'),
  73:       };
  74:     });
  75: 
  76:     setMonthlyData(formatted);
  77:   };
  78: 
  79:   const renderGainType = (type: string) => {
  80:     switch (type) {
  81:       case 'bonus':
  82:         return { label: 'Bonus de parrainage', icon: <Gift size={18} color="#34A853" />, color: '#E6F9EC' };
  83:       case 'commission':
  84:         return { label: 'Commission sur filleul', icon: <Percent size={18} color="#FBBC05" />, color: '#FFF9E6' };
  85:       case 'badge':
  86:         return { label: 'Récompense de badge', icon: <Award size={18} color="#4285F4" />, color: '#E6F0FF' };
  87:       case 'service':
  88:         return { label: 'Gain sur service', icon: <Coins size={18} color="#FF6D00" />, color: '#FFF3E6' };
  89:       default:
  90:         return { label: 'Autre', icon: <Coins size={18} color="#999" />, color: '#F0F0F0' };
  91:     }
  92:   };
  93: 
  94:   const filteredGains = gains.filter((item) => {
  95:     const date = new Date(item.created_at);
  96:     const yearMatch = date.getFullYear() === selectedYear;
  97:     const monthMatch = selectedMonth ? date.getMonth() + 1 === selectedMonth : true;
  98:     return yearMatch && monthMatch;
  99:   });
 100: 
 101:   return (
 102:     <SafeAreaView style={styles.container}>
 103:       <ScrollView>
 104:         <Text style={styles.title}>Mes Revenus</Text>
 105:         <Text style={styles.total}>Total : {total.toFixed(2)} €</Text>
 106: 
 107:         <View style={styles.filterRow}>
 108:           {availableYears.map((year) => (
 109:             <TouchableOpacity
 110:               key={year}
 111:               style={[styles.filterButton, selectedYear === year && styles.selectedButton]}
 112:               onPress={() => {
 113:                 setSelectedYear(year);
 114:                 setSelectedMonth(null);
 115:               }}
 116:             >
 117:               <Text style={selectedYear === year ? styles.selectedText : styles.filterText}>{year}</Text>
 118:             </TouchableOpacity>
 119:           ))}
 120:         </View>
 121: 
 122:         <View style={styles.filterRow}>
 123:           {Array.from({ length: 12 }, (_, i) => i + 1).map((month) => (
 124:             <TouchableOpacity
 125:               key={month}
 126:               style={[styles.filterButton, selectedMonth === month && styles.selectedButton]}
 127:               onPress={() => setSelectedMonth(month === selectedMonth ? null : month)}
 128:             >
 129:               <Text style={selectedMonth === month ? styles.selectedText : styles.filterText}>{String(month).padStart(2, '0')}</Text>
 130:             </TouchableOpacity>
 131:           ))}
 132:         </View>
 133: 
 134:         <Text style={styles.subtitle}>Évolution mensuelle ({selectedYear})</Text>
 135:         <BarChart
 136:           barWidth={28}
 137:           noOfSections={4}
 138:           barBorderRadius={6}
 139:           frontColor="#FF6600"
 140:           data={monthlyData}
 141:           yAxisTextStyle={{ color: '#555' }}
 142:           xAxisLabelTextStyle={{ color: '#555', fontSize: 10 }}
 143:           isAnimated
 144:           height={200}
 145:           width={Dimensions.get('window').width - 32}
 146:         />
 147: 
 148:         <Text style={styles.subtitle}>Détails des gains</Text>
 149:         <FlatList
 150:           data={filteredGains}
 151:           keyExtractor={(item) => item.id.toString()}
 152:           renderItem={({ item }) => {
 153:             const { label, icon, color } = renderGainType(item.type);
 154:             return (
 155:               <View style={[styles.item, { backgroundColor: color }]}>
 156:                 <View style={styles.icon}>{icon}</View>
 157:                 <View style={{ flex: 1 }}>
 158:                   <Text>{label} • {item.amount.toFixed(2)} €</Text>
 159:                   <Text style={styles.date}>{new Date(item.created_at).toLocaleDateString()}</Text>
 160:                 </View>
 161:               </View>
 162:             );
 163:           }}
 164:           ListEmptyComponent={<Text style={{ textAlign: 'center', marginTop: 20 }}>Aucun gain pour cette période.</Text>}
 165:         />
 166:       </ScrollView>
 167:     </SafeAreaView>
 168:   );
 169: }
 170: 
 171: const styles = StyleSheet.create({
 172:   container: { flex: 1, padding: 16 },
 173:   title: { fontSize: 24, fontWeight: 'bold', marginBottom: 8 },
 174:   total: { fontSize: 18, fontWeight: '600', marginBottom: 16 },
 175:   subtitle: { fontSize: 18, fontWeight: 'bold', marginTop: 24, marginBottom: 12 },
 176:   filterRow: { flexDirection: 'row', flexWrap: 'wrap', gap: 8, marginBottom: 12 },
 177:   filterButton: { paddingHorizontal: 12, paddingVertical: 6, backgroundColor: '#eee', borderRadius: 20 },
 178:   selectedButton: { backgroundColor: '#FF6600' },
 179:   filterText: { fontSize: 14, color: '#333' },
 180:   selectedText: { color: 'white', fontWeight: '600' },
 181:   item: { flexDirection: 'row', alignItems: 'center', marginBottom: 12, padding: 12, borderRadius: 10 },
 182:   icon: { marginRight: 12 },
 183:   date: { fontSize: 12, color: '#888', marginTop: 4 },
 184: });
 185: 

==== AUDIT: C:\Users\MILLET IMMOBILIER\OneDrive\Bureau\project\app\(tabs)\rewards.tsx ====
   1: import React, { useEffect, useState } from 'react';
   2: import { View, Text, StyleSheet, FlatList, ActivityIndicator } from 'react-native';
   3: import { SafeAreaView } from 'react-native-safe-area-context';
   4: // Chemin relatif corrigé pour éviter l'erreur d'alias
   5: import { supabase } from '../../lib/supabase';
   6: import { Award } from 'lucide-react-native';
   7: 
   8: export default function RewardsScreen() {
   9:   const [rewards, setRewards] = useState([]);
  10:   const [loading, setLoading] = useState(true);
  11: 
  12:   useEffect(() => {
  13:     const fetchRewards = async () => {
  14:       const { data: { user } } = await supabase.auth.getUser();
  15:       const { data, error } = await supabase
  16:         .from('rewards')
  17:         .select('*')
  18:         .eq('user_id', user.id)
  19:         .order('created_at', { ascending: false });
  20: 
  21:       if (!error) setRewards(data || []);
  22:       setLoading(false);
  23:     };
  24: 
  25:     fetchRewards();
  26:   }, []);
  27: 
  28:   if (loading) {
  29:     return (
  30:       <SafeAreaView style={styles.container}>
  31:         <ActivityIndicator size="large" color="#FF4444" />
  32:       </SafeAreaView>
  33:     );
  34:   }
  35: 
  36:   if (!rewards.length) {
  37:     return (
  38:       <SafeAreaView style={styles.container}>
  39:         <Text style={styles.emptyText}>Aucune récompense pour le moment.</Text>
  40:       </SafeAreaView>
  41:     );
  42:   }
  43: 
  44:   return (
  45:     <SafeAreaView style={styles.container}>
  46:       <Text style={styles.title}>🎁 Mes Récompenses</Text>
  47:       <FlatList
  48:         data={rewards}
  49:         keyExtractor={(item) => item.id.toString()}
  50:         renderItem={({ item }) => (
  51:           <View style={styles.rewardItem}>
  52:             <Award size={20} color="#FF4444" />
  53:             <View style={styles.rewardText}>
  54:               <Text style={styles.rewardTitle}>{item.title}</Text>
  55:               <Text style={styles.rewardDescription}>{item.description}</Text>
  56:             </View>
  57:           </View>
  58:         )}
  59:       />
  60:     </SafeAreaView>
  61:   );
  62: }
  63: 
  64: const styles = StyleSheet.create({
  65:   container: { flex: 1, backgroundColor: '#fff', padding: 16 },
  66:   title: { fontSize: 24, fontWeight: 'bold', marginBottom: 16 },
  67:   emptyText: { fontSize: 16, textAlign: 'center', marginTop: 50, color: '#999' },
  68:   rewardItem: {
  69:     flexDirection: 'row',
  70:     alignItems: 'center',
  71:     marginBottom: 14,
  72:     backgroundColor: '#f9f9f9',
  73:     padding: 12,
  74:     borderRadius: 8,
  75:   },
  76:   rewardText: {
  77:     marginLeft: 12,
  78:   },
  79:   rewardTitle: {
  80:     fontSize: 16,
  81:     fontWeight: '600',
  82:   },
  83:   rewardDescription: {
  84:     fontSize: 14,
  85:     color: '#555',
  86:   },
  87: });
  88: 

==== AUDIT: C:\Users\MILLET IMMOBILIER\OneDrive\Bureau\project\app\(tabs)\_layout.tsx ====
   1: import { Tabs } from 'expo-router';
   2: import { Chrome as Home, Search, MessageCircle, User, Briefcase } from 'lucide-react-native';
   3: import { View, Text, StyleSheet, Platform } from 'react-native';
   4: 
   5: function TabBarIcon({ icon: Icon, color, focused }: { icon: any; color: string; focused: boolean }) {
   6:   return (
   7:     <View style={[styles.tabIcon, focused && styles.tabIconFocused]}>
   8:       <Icon size={24} color={color} strokeWidth={focused ? 2.5 : 2} />
   9:     </View>
  10:   );
  11: }
  12: 
  13: export default function TabLayout() {
  14:   return (
  15:     <Tabs
  16:       screenOptions={{
  17:         headerShown: false,
  18:         tabBarStyle: styles.tabBar,
  19:         tabBarActiveTintColor: '#FF4444',
  20:         tabBarInactiveTintColor: '#666',
  21:         tabBarLabelStyle: styles.tabLabel,
  22:       }}
  23:     >
  24:       <Tabs.Screen
  25:         name="index"
  26:         options={{
  27:           title: 'Accueil',
  28:           tabBarIcon: ({ color, focused }) => (
  29:             <TabBarIcon icon={Home} color={color} focused={focused} />
  30:           ),
  31:         }}
  32:       />
  33:       <Tabs.Screen
  34:         name="services"
  35:         options={{
  36:           title: 'Services',
  37:           tabBarIcon: ({ color, focused }) => (
  38:             <TabBarIcon icon={Search} color={color} focused={focused} />
  39:           ),
  40:         }}
  41:       />
  42:       <Tabs.Screen
  43:         name="orders"
  44:         options={{
  45:           title: 'Commandes',
  46:           tabBarIcon: ({ color, focused }) => (
  47:             <TabBarIcon icon={Briefcase} color={color} focused={focused} />
  48:           ),
  49:         }}
  50:       />
  51:       <Tabs.Screen
  52:         name="messages"
  53:         options={{
  54:           title: 'Messages',
  55:           tabBarIcon: ({ color, focused }) => (
  56:             <TabBarIcon icon={MessageCircle} color={color} focused={focused} />
  57:           ),
  58:         }}
  59:       />
  60:       <Tabs.Screen
  61:         name="profile"
  62:         options={{
  63:           title: 'Profil',
  64:           tabBarIcon: ({ color, focused }) => (
  65:             <TabBarIcon icon={User} color={color} focused={focused} />
  66:           ),
  67:         }}
  68:       />
  69:     </Tabs>
  70:   );
  71: }
  72: 
  73: const styles = StyleSheet.create({
  74:   tabBar: {
  75:     backgroundColor: '#FFFFFF',
  76:     borderTopWidth: 1,
  77:     borderTopColor: '#E5E5E5',
  78:     height: 80,
  79:     paddingBottom: 20,
  80:     paddingTop: 10,
  81:   },
  82:   tabIcon: {
  83:     alignItems: 'center',
  84:     justifyContent: 'center',
  85:     width: 32,
  86:     height: 32,
  87:   },
  88:   tabIconFocused: {
  89:     backgroundColor: '#FF444410',
  90:     borderRadius: 16,
  91:   },
  92:   tabLabel: {
  93:     fontSize: 12,
  94:     fontFamily: 'Inter-Medium',
  95:     marginTop: 4,
  96:   },
  97: });

==== AUDIT: C:\Users\MILLET IMMOBILIER\OneDrive\Bureau\project\lib\notifications.ts ====
   1: // lib/notifications.ts
   2: import { supabase } from '@/lib/supabase';
   3: 
   4: export async function sendNotification({
   5:   userId,
   6:   title,
   7:   message,
   8: }: {
   9:   userId: string;
  10:   title: string;
  11:   message: string;
  12: }) {
  13:   const { error } = await supabase.from('notifications').insert({
  14:     user_id: userId,
  15:     title,
  16:     message,
  17:   });
  18: 
  19:   if (error) {
  20:     console.error('Erreur envoi notification:', error.message);
  21:   }
  22: }
  23: 
  24: export async function markNotificationAsRead(id: string) {
  25:   const { error } = await supabase
  26:     .from('notifications')
  27:     .update({ is_read: true })
  28:     .eq('id', id);
  29: 
  30:   if (error) {
  31:     console.error('Erreur mise à jour notification:', error.message);
  32:   }
  33: }
  34: 
  35: export async function getUnreadCount(userId: string): Promise<number> {
  36:   const { data, error, count } = await supabase
  37:     .from('notifications')
  38:     .select('*', { count: 'exact', head: true })
  39:     .eq('user_id', userId)
  40:     .eq('is_read', false);
  41: 
  42:   if (error) {
  43:     console.error('Erreur récupération notifications non lues:', error.message);
  44:     return 0;
  45:   }
  46: 
  47:   return count ?? 0;
  48: }

==== AUDIT: C:\Users\MILLET IMMOBILIER\OneDrive\Bureau\project\lib\supabase.ts ====
   1: import { createClient } from '@supabase/supabase-js';
   2: 
   3: const supabaseUrl = process.env.EXPO_PUBLIC_SUPABASE_URL; // Remplace par ton URL Supabase
   4: const supabaseKey = process.env.EXPO_PUBLIC_SUPABASE_ANON_KEY; // Remplace par ta cl anon Supabase
   5: 
   6: export const supabase = createClient(supabaseUrl, supabaseKey);

==== AUDIT: C:\Users\MILLET IMMOBILIER\OneDrive\Bureau\project\components\AnimatedAnt.tsx ====
   1: import React from 'react';
   2: import { View, StyleSheet, Image } from 'react-native';
   3: import LottieView from 'lottie-react-native';
   4: 
   5: export default function AnimatedAnt() {
   6:   return (
   7:     <View style={styles.container}>
   8:       {/* Image fixe de la fourmi */}
   9:       <Image
  10:         source={require('../assets/images/ant-logo.png')} // ✅ Chemin corrigé
  11:         style={styles.antImage}
  12:         resizeMode="contain"
  13:       />
  14: 
  15:       {/* Animation des pattes + antennes */}
  16:       <LottieView
  17:         source={require('../assets/lottie/walking-ant.json')} // ✅ Chemin correct
  18:         autoPlay
  19:         loop
  20:         style={styles.lottie}
  21:       />
  22:     </View>
  23:   );
  24: }
  25: 
  26: const styles = StyleSheet.create({
  27:   container: {
  28:     width: 140,
  29:     height: 140,
  30:     alignItems: 'center',
  31:     justifyContent: 'center',
  32:     position: 'relative',
  33:   },
  34:   antImage: {
  35:     width: 140,
  36:     height: 140,
  37:     position: 'absolute',
  38:     zIndex: 2,
  39:   },
  40:   lottie: {
  41:     width: 140,
  42:     height: 140,
  43:     position: 'absolute',
  44:     zIndex: 1,
  45:   },
  46: });
  47: 

==== AUDIT: C:\Users\MILLET IMMOBILIER\OneDrive\Bureau\project\components\BadgesBubble.tsx ====
   1: import { View, Text, StyleSheet } from 'react-native';
   2: 
   3: export default function BadgesBubble() {
   4:   return (
   5:     <View style={styles.container}>
   6:       <Text style={styles.text}>Badges</Text>
   7:     </View>
   8:   );
   9: }
  10: 
  11: const styles = StyleSheet.create({
  12:   container: { alignItems: 'center', padding: 10, backgroundColor: '#f0f0f0' },
  13:   text: { fontSize: 16, color: '#000' },
  14: });

==== AUDIT: C:\Users\MILLET IMMOBILIER\OneDrive\Bureau\project\components\ClientBadgesBubble.tsx ====
   1: import React from 'react';
   2: import { View, Text, StyleSheet, TouchableOpacity } from 'react-native';
   3: import { Award } from 'lucide-react-native';
   4: import { router } from 'expo-router';
   5: 
   6: export default function ClientBadgesBubble() {
   7:   const handlePress = () => {
   8:     router.push('/client-badges');
   9:   };
  10: 
  11:   return (
  12:     <TouchableOpacity style={styles.container} onPress={handlePress}>
  13:       <Award size={20} color="#FFD700" />
  14:       <View style={styles.content}>
  15:         <Text style={styles.title}>Mes Badges et Récompenses</Text>
  16:         <Text style={styles.description}>
  17:           Découvrez les badges que vous avez débloqués en tant que client. 
  18:           Gagnez des réductions sur vos prochaines commandes !{' '}
  19:           <Text style={styles.link}>Voir ma collection</Text>
  20:         </Text>
  21:       </View>
  22:     </TouchableOpacity>
  23:   );
  24: }
  25: 
  26: const styles = StyleSheet.create({
  27:   container: {
  28:     backgroundColor: '#FFF8E1',
  29:     borderRadius: 12,
  30:     padding: 16,
  31:     flexDirection: 'row',
  32:     alignItems: 'flex-start',
  33:     borderLeftWidth: 4,
  34:     borderLeftColor: '#FFD700',
  35:     shadowColor: '#000',
  36:     shadowOffset: { width: 0, height: 2 },
  37:     shadowOpacity: 0.1,
  38:     shadowRadius: 4,
  39:     elevation: 3,
  40:     marginBottom: 12,
  41:   },
  42:   content: {
  43:     flex: 1,
  44:     marginLeft: 12,
  45:   },
  46:   title: {
  47:     fontSize: 16,
  48:     fontFamily: 'Inter-Bold',
  49:     color: '#F57C00',
  50:     marginBottom: 8,
  51:   },
  52:   description: {
  53:     fontSize: 13,
  54:     fontFamily: 'Inter-Regular',
  55:     color: '#F57C00',
  56:     lineHeight: 18,
  57:   },
  58:   link: {
  59:     fontFamily: 'Inter-SemiBold',
  60:     textDecorationLine: 'underline',
  61:   },
  62: });
  63: 

==== AUDIT: C:\Users\MILLET IMMOBILIER\OneDrive\Bureau\project\components\ClientRatingInfo.tsx ====
   1: import React from 'react';
   2: import { View, Text, StyleSheet, TouchableOpacity } from 'react-native';
   3: import { Shield, Info } from 'lucide-react-native';
   4: import { router } from 'expo-router';
   5: 
   6: export default function ClientRatingInfo() {
   7:   const handlePress = () => {
   8:     // Naviguer vers une page d'information sur le système de notation
   9:     router.push('/rating-info');
  10:   };
  11: 
  12:   return (
  13:     <TouchableOpacity style={styles.container} onPress={handlePress}>
  14:       <Shield size={20} color="#4CAF50" />
  15:       <View style={styles.content}>
  16:         <Text style={styles.title}>Système de notation confidentiel</Text>
  17:         <Text style={styles.description}>
  18:           En tant que Fourmiz, vous pouvez évaluer vos clients après chaque mission. Ces notes sont visibles uniquement par les Fourmiz et aident à améliorer la qualité de notre communauté.{' '}
  19:           <Text style={styles.link}>En savoir plus</Text>
  20:         </Text>
  21:       </View>
  22:     </TouchableOpacity>
  23:   );
  24: }
  25: 
  26: const styles = StyleSheet.create({
  27:   container: {
  28:     backgroundColor: '#E8F5E8',
  29:     borderRadius: 12,
  30:     padding: 16,
  31:     flexDirection: 'row',
  32:     alignItems: 'flex-start',
  33:     borderLeftWidth: 4,
  34:     borderLeftColor: '#4CAF50',
  35:     shadowColor: '#000',
  36:     shadowOffset: { width: 0, height: 2 },
  37:     shadowOpacity: 0.1,
  38:     shadowRadius: 4,
  39:     elevation: 3,
  40:     marginBottom: 12,
  41:   },
  42:   content: {
  43:     flex: 1,
  44:     marginLeft: 12,
  45:   },
  46:   title: {
  47:     fontSize: 16,
  48:     fontFamily: 'Inter-Bold',
  49:     color: '#4CAF50',
  50:     marginBottom: 8,
  51:   },
  52:   description: {
  53:     fontSize: 13,
  54:     fontFamily: 'Inter-Regular',
  55:     color: '#4CAF50',
  56:     lineHeight: 18,
  57:   },
  58:   link: {
  59:     fontFamily: 'Inter-SemiBold',
  60:     textDecorationLine: 'underline',
  61:   },
  62: });
  63: 

==== AUDIT: C:\Users\MILLET IMMOBILIER\OneDrive\Bureau\project\components\FourmizBadgesBubble.tsx ====
   1: import { View, Text, StyleSheet } from 'react-native';
   2: 
   3: export default function FourmizBadgesBubble() {
   4:   return (
   5:     <View style={styles.container}>
   6:       <Text style={styles.text}>Badges Fourmiz</Text>
   7:     </View>
   8:   );
   9: }
  10: 
  11: const styles = StyleSheet.create({
  12:   container: { alignItems: 'center', padding: 10, backgroundColor: '#f0f0f0' },
  13:   text: { fontSize: 16, color: '#000' },
  14: });

==== AUDIT: C:\Users\MILLET IMMOBILIER\OneDrive\Bureau\project\components\FourmizCriteriaBubble.tsx ====
   1: import React from 'react';
   2: import { View, Text, StyleSheet, TouchableOpacity } from 'react-native';
   3: import { Filter } from 'lucide-react-native';
   4: import { router } from 'expo-router';
   5: 
   6: export default function FourmizCriteriaBubble() {
   7:   const handlePress = () => {
   8:     router.push('/fourmiz-criteria');
   9:   };
  10: 
  11:   return (
  12:     <TouchableOpacity style={styles.container} onPress={handlePress}>
  13:       <Filter size={20} color="#2196F3" />
  14:       <View style={styles.content}>
  15:         <Text style={styles.title}>Mes critères de mission</Text>
  16:         <Text style={styles.description}>
  17:           Définissez vos préférences de services, disponibilités, rayon d'action et tarifs pour recevoir uniquement les demandes qui vous correspondent.{' '}
  18:           <Text style={styles.link}>Personnaliser mes critères</Text>
  19:         </Text>
  20:       </View>
  21:     </TouchableOpacity>
  22:   );
  23: }
  24: 
  25: const styles = StyleSheet.create({
  26:   container: {
  27:     backgroundColor: '#E3F2FD',
  28:     borderRadius: 12,
  29:     padding: 16,
  30:     flexDirection: 'row',
  31:     alignItems: 'flex-start',
  32:     borderLeftWidth: 4,
  33:     borderLeftColor: '#2196F3',
  34:     shadowColor: '#000',
  35:     shadowOffset: { width: 0, height: 2 },
  36:     shadowOpacity: 0.1,
  37:     shadowRadius: 4,
  38:     elevation: 3,
  39:     marginBottom: 12,
  40:   },
  41:   content: {
  42:     flex: 1,
  43:     marginLeft: 12,
  44:   },
  45:   title: {
  46:     fontSize: 16,
  47:     fontFamily: 'Inter-Bold',
  48:     color: '#1976D2',
  49:     marginBottom: 8,
  50:   },
  51:   description: {
  52:     fontSize: 13,
  53:     fontFamily: 'Inter-Regular',
  54:     color: '#1976D2',
  55:     lineHeight: 18,
  56:   },
  57:   link: {
  58:     fontFamily: 'Inter-SemiBold',
  59:     textDecorationLine: 'underline',
  60:   },
  61: });
  62: 

==== AUDIT: C:\Users\MILLET IMMOBILIER\OneDrive\Bureau\project\components\MessageInput.tsx ====
   1: import React, { useState } from 'react';
   2: import { View, TextInput, StyleSheet, TouchableOpacity, Alert } from 'react-native';
   3: import { Send } from 'lucide-react-native';
   4: import { supabase } from '../lib/supabase';
   5: 
   6: export default function MessageInput({ receiverId }: { receiverId: string }) {
   7:   const [text, setText] = useState('');
   8: 
   9:   const sendMessage = async () => {
  10:     if (!text.trim()) return;
  11: 
  12:     const {
  13:       user
  14:     } = data; 
  15: 
  16:     const { error } = await supabase.from('messages').insert({
  17:       sender_id: user.id,
  18:       receiver_id: receiverId,
  19:       content: text,
  20:     });
  21: 
  22:     if (error) {
  23:       console.error('Erreur lors de l\'envoi du message:', error);
  24:       Alert.alert('Erreur', 'Impossible d\'envoyer le message. Veuillez réessayer.');
  25:       return;
  26:     }
  27: 
  28:     setText('');
  29:   };
  30: 
  31:   return (
  32:     <View style={styles.container}>
  33:       <TextInput
  34:         value={text}
  35:         onChangeText={setText}
  36:         placeholder="Écrire un message..."
  37:         style={styles.input}
  38:       />
  39:       <TouchableOpacity 
  40:         onPress={sendMessage} 
  41:         style={[styles.sendButton, { opacity: text.trim() ? 1 : 0.5 }]} 
  42:         disabled={!text.trim()}
  43:       >
  44:         <Send size={20} color="#fff" />
  45:       </TouchableOpacity>
  46:     </View>
  47:   );
  48: }
  49: 
  50: const styles = StyleSheet.create({
  51:   container: {
  52:     flexDirection: 'row',
  53:     padding: 12,
  54:     borderTopWidth: 1,
  55:     borderTopColor: '#ddd',
  56:     backgroundColor: '#fff',
  57:   },
  58:   input: {
  59:     flex: 1,
  60:     backgroundColor: '#F5F5F5',
  61:     paddingHorizontal: 12,
  62:     paddingVertical: 8,
  63:     borderRadius: 24,
  64:   },
  65:   sendButton: {
  66:     backgroundColor: '#FF4444',
  67:     padding: 10,
  68:     marginLeft: 8,
  69:     borderRadius: 24,
  70:     justifyContent: 'center',
  71:     alignItems: 'center',
  72:   },
  73: });
  74: 

==== AUDIT: C:\Users\MILLET IMMOBILIER\OneDrive\Bureau\project\components\NotificationBell.tsx ====
   1: // components/NotificationBell.tsx
   2: import React, { useEffect, useState } from 'react';
   3: import { View, TouchableOpacity, StyleSheet, Text, Vibration } from 'react-native';
   4: import { Bell } from 'lucide-react-native';
   5: import { useRouter, useFocusEffect } from 'expo-router';
   6: import { supabase } from '../lib/supabase';
   7: import { getUnreadCount } from '@/lib/notifications';
   8: import Animated, { useSharedValue, useAnimatedStyle, withSequence, withSpring } from 'react-native-reanimated';
   9: 
  10: export default function NotificationBell() {
  11:   const [unread, setUnread] = useState(0);
  12:   const router = useRouter();
  13:   const scale = useSharedValue(1);
  14: 
  15:   const fetchUnread = async () => {
  16:     const { data: { user } } = await supabase.auth.getUser();
  17:     if (!user) return;
  18:     const count = await getUnreadCount(user.id);
  19: 
  20:     if (count > unread) {
  21:       // 📳 vibration et animation si nouvelle notif
  22:       Vibration.vibrate(100);
  23:       scale.value = withSequence(withSpring(1.3), withSpring(1));
  24:     }
  25: 
  26:     setUnread(count);
  27:   };
  28: 
  29:   useEffect(() => {
  30:     const interval = setInterval(fetchUnread, 10000);
  31: 
  32:     const channel = supabase
  33:       .channel('notifications-realtime')
  34:       .on(
  35:         'postgres_changes',
  36:         {
  37:           event: 'INSERT',
  38:           schema: 'public',
  39:           table: 'notifications',
  40:         },
  41:         () => {
  42:           fetchUnread();
  43:         }
  44:       )
  45:       .subscribe();
  46: 
  47:     fetchUnread();
  48: 
  49:     return () => {
  50:       clearInterval(interval);
  51:       supabase.removeChannel(channel);
  52:     };
  53:   }, []);
  54: 
  55:   useFocusEffect(
  56:     React.useCallback(() => {
  57:       fetchUnread();
  58:     }, [])
  59:   );
  60: 
  61:   const animatedStyle = useAnimatedStyle(() => ({
  62:     transform: [{ scale: scale.value }],
  63:   }));
  64: 
  65:   return (
  66:     <TouchableOpacity style={styles.container} onPress={() => router.push('/notifications')}>
  67:       <Animated.View style={animatedStyle}>
  68:         <Bell size={26} color="#333" />
  69:         {unread > 0 && (
  70:           <View style={styles.badge}>
  71:             <Text style={styles.badgeText}>{unread}</Text>
  72:           </View>
  73:         )}
  74:       </Animated.View>
  75:     </TouchableOpacity>
  76:   );
  77: }
  78: 
  79: const styles = StyleSheet.create({
  80:   container: {
  81:     padding: 8,
  82:   },
  83:   badge: {
  84:     position: 'absolute',
  85:     top: -4,
  86:     right: -4,
  87:     backgroundColor: 'red',
  88:     borderRadius: 10,
  89:     paddingHorizontal: 6,
  90:     minWidth: 20,
  91:     height: 20,
  92:     justifyContent: 'center',
  93:     alignItems: 'center',
  94:     zIndex: 1,
  95:   },
  96:   badgeText: {
  97:     color: '#fff',
  98:     fontSize: 12,
  99:     fontWeight: 'bold',
 100:   },
 101: });
 102: 

==== AUDIT: C:\Users\MILLET IMMOBILIER\OneDrive\Bureau\project\components\RealTimeMap.tsx ====
   1: import React, { useEffect, useState } from 'react';
   2: import { View, StyleSheet, Image, Text } from 'react-native';
   3: import MapView, { Marker, Callout } from 'react-native-maps';
   4: import { supabase } from '@/lib/supabase';
   5: 
   6: export default function RealTimeMap() {
   7:   const [fourmizList, setFourmizList] = useState([]);
   8: 
   9:   useEffect(() => {
  10:     fetchFourmiz();
  11: 
  12:     const channel = supabase
  13:       .channel('public:available_fourmiz_with_profile')
  14:       .on(
  15:         'postgres_changes',
  16:         { event: '*', schema: 'public', table: 'locations' },
  17:         () => fetchFourmiz()
  18:       )
  19:       .subscribe();
  20: 
  21:     return () => {
  22:       supabase.removeChannel(channel);
  23:     };
  24:   }, []);
  25: 
  26:   const fetchFourmiz = async () => {
  27:     const { data, error } = await supabase
  28:       .from('available_fourmiz_with_profile')
  29:       .select('*');
  30: 
  31:     if (!error && data) {
  32:       setFourmizList(data);
  33:     } else {
  34:       console.error('Erreur chargement fourmiz :', error?.message);
  35:     }
  36:   };
  37: 
  38:   return (
  39:     <View style={styles.container}>
  40:       <MapView
  41:         style={styles.map}
  42:         initialRegion={{
  43:           latitude: 48.8566,
  44:           longitude: 2.3522,
  45:           latitudeDelta: 0.1,
  46:           longitudeDelta: 0.1,
  47:         }}
  48:       >
  49:         {fourmizList.map((f, index) => (
  50:           <Marker
  51:             key={index}
  52:             coordinate={{
  53:               latitude: f.latitude,
  54:               longitude: f.longitude,
  55:             }}
  56:           >
  57:             <Image
  58:               source={{ uri: f.avatar_url || 'https://via.placeholder.com/40' }}
  59:               style={[
  60:                 styles.avatar,
  61:                 { borderColor: f.is_online ? '#4CAF50' : '#ccc' },
  62:               ]}
  63:             />
  64:             <Callout>
  65:               <Text style={styles.name}>{f.firstname}</Text>
  66:               <Text>{f.is_online ? '🟢 En ligne' : '⚪ Hors ligne'}</Text>
  67:             </Callout>
  68:           </Marker>
  69:         ))}
  70:       </MapView>
  71:     </View>
  72:   );
  73: }
  74: 
  75: const styles = StyleSheet.create({
  76:   container: {
  77:     height: 300,
  78:     borderRadius: 12,
  79:     overflow: 'hidden',
  80:     marginVertical: 20,
  81:   },
  82:   map: {
  83:     flex: 1,
  84:   },
  85:   avatar: {
  86:     width: 40,
  87:     height: 40,
  88:     borderRadius: 20,
  89:     borderWidth: 2,
  90:   },
  91:   name: {
  92:     fontWeight: '600',
  93:     fontSize: 14,
  94:     marginBottom: 4,
  95:   },
  96: });
  97: 

==== AUDIT: C:\Users\MILLET IMMOBILIER\OneDrive\Bureau\project\components\RecommendedServices.tsx ====
   1: import React, { useEffect, useState } from 'react';
   2: import { View, Text, StyleSheet, FlatList, TouchableOpacity } from 'react-native';
   3: import { supabase } from '../lib/supabase';
   4: import { useRouter } from 'expo-router';
   5: 
   6: export default function RecommendedServices() {
   7:   const [services, setServices] = useState([]);
   8:   const router = useRouter();
   9: 
  10:   useEffect(() => {
  11:     supabase
  12:       .from('services')
  13:       .select('*')
  14:       .eq('isRecommended', true)
  15:       .then(({ data }) => setServices(data || []));
  16:   }, []);
  17: 
  18:   return (
  19:     <View style={styles.container}>
  20:       <Text style={styles.title}>Services recommandés</Text>
  21:       <FlatList
  22:         data={services}
  23:         keyExtractor={(item) => item.id.toString()}
  24:         horizontal
  25:         renderItem={({ item }) => (
  26:           <TouchableOpacity
  27:             style={styles.card}
  28:             onPress={() => router.push(`/services/${item.id}`)}
  29:           >
  30:             <Text style={styles.cardTitle}>{item.title}</Text>
  31:             <Text numberOfLines={2} style={styles.cardDesc}>{item.description}</Text>
  32:           </TouchableOpacity>
  33:         )}
  34:       />
  35:     </View>
  36:   );
  37: }
  38: 
  39: const styles = StyleSheet.create({
  40:   container: { marginTop: 20 },
  41:   title: { fontSize: 16, fontWeight: 'bold', marginBottom: 10 },
  42:   card: {
  43:     width: 200,
  44:     padding: 12,
  45:     backgroundColor: '#f2f2f2',
  46:     marginRight: 12,
  47:     borderRadius: 10,
  48:   },
  49:   cardTitle: { fontWeight: 'bold', fontSize: 14 },
  50:   cardDesc: { fontSize: 12, color: '#666', marginTop: 4 },
  51: });
  52: 

==== AUDIT: C:\Users\MILLET IMMOBILIER\OneDrive\Bureau\project\components\ReferralBubble.tsx ====
   1: import React, { useEffect, useState } from 'react';
   2: import { View, Text, StyleSheet, TouchableOpacity } from 'react-native';
   3: import { Users, Wallet } from 'lucide-react-native';
   4: import { router, useLocalSearchParams } from 'expo-router';
   5: import { supabase } from '../lib/supabase';
   6: 
   7: export default function ReferralBubble() {
   8:   const { mode } = useLocalSearchParams();
   9:   const isFourmizMode = mode === 'fourmiz';
  10:   const [bonus, setBonus] = useState('3');
  11:   const [commission, setCommission] = useState('2.5');
  12: 
  13:   useEffect(() => {
  14:     const loadSettings = async () => {
  15:       const { data } = await supabase
  16:         .from('app_settings')
  17:         .select('*')
  18:         .in('key', ['referral_bonus', 'referral_commission']);
  19: 
  20:       const bonusSetting = data.find((s) => s.key === 'referral_bonus');
  21:       const commissionSetting = data.find((s) => s.key === 'referral_commission');
  22: 
  23:       setBonus(bonusSetting?.value || '3');
  24:       setCommission(commissionSetting?.value || '2.5');
  25:     };
  26: 
  27:     loadSettings();
  28:   }, []);
  29: 
  30:   const handlePress = () => {
  31:     router.push('/referral');
  32:   };
  33: 
  34:   return (
  35:     <TouchableOpacity style={styles.container} onPress={handlePress}>
  36:       <View style={styles.iconContainer}>
  37:         <Wallet size={20} color="#FF4444" style={styles.walletIcon} />
  38:         <Users size={20} color="#FF4444" />
  39:       </View>
  40:       <View style={styles.content}>
  41:         <Text style={styles.title}>Fourmiz Friends</Text>
  42:         <Text style={styles.description}>
  43:           Parrainez vos amis et gagnez {bonus}€ à la première commande ou mission de votre filleul + {commission}% sur toutes leurs commissions à vie !{' '}
  44:           <Text style={styles.link}>Cliquez ici pour en savoir plus !</Text>
  45:           {'\n\n'}
  46:           Transformez votre réseau en revenus avec Fourmiz Friends !
  47:         </Text>
  48:       </View>
  49:     </TouchableOpacity>
  50:   );
  51: }
  52: 
  53: const styles = StyleSheet.create({
  54:   container: {
  55:     backgroundColor: '#FFF0F0',
  56:     borderRadius: 12,
  57:     padding: 16,
  58:     flexDirection: 'row',
  59:     alignItems: 'flex-start',
  60:     borderLeftWidth: 4,
  61:     borderLeftColor: '#FF4444',
  62:     shadowColor: '#000',
  63:     shadowOffset: { width: 0, height: 2 },
  64:     shadowOpacity: 0.1,
  65:     shadowRadius: 4,
  66:     elevation: 3,
  67:   },
  68:   iconContainer: {
  69:     flexDirection: 'row',
  70:     marginRight: 12,
  71:   },
  72:   walletIcon: {
  73:     marginRight: -8,
  74:     marginTop: -2,
  75:   },
  76:   content: {
  77:     flex: 1,
  78:   },
  79:   title: {
  80:     fontSize: 16,
  81:     fontFamily: 'Inter-Bold',
  82:     color: '#FF4444',
  83:     marginBottom: 8,
  84:   },
  85:   description: {
  86:     fontSize: 13,
  87:     fontFamily: 'Inter-Regular',
  88:     color: '#666',
  89:     lineHeight: 18,
  90:   },
  91:   link: {
  92:     color: '#FF4444',
  93:     fontFamily: 'Inter-SemiBold',
  94:     textDecorationLine: 'underline',
  95:   },
  96: });
  97: 

==== AUDIT: C:\Users\MILLET IMMOBILIER\OneDrive\Bureau\project\components\TaxAttestationBubble.tsx ====
   1: import React from 'react';
   2: import { View, Text, StyleSheet } from 'react-native';
   3: import { FileText } from 'lucide-react-native';
   4: 
   5: export default function TaxAttestationBubble() {
   6:   return (
   7:     <View style={styles.container}>
   8:       <FileText size={24} color="#4CAF50" />
   9:       <Text style={styles.text}>
  10:         Votre attestation fiscale est prête. Vous pouvez la télécharger ou la consulter.
  11:       </Text>
  12:     </View>
  13:   );
  14: }
  15: 
  16: const styles = StyleSheet.create({
  17:   container: {
  18:     flexDirection: 'row',
  19:     alignItems: 'center',
  20:     backgroundColor: '#E8F5E8',
  21:     padding: 12,
  22:     borderRadius: 12,
  23:     marginVertical: 8,
  24:   },
  25:   text: {
  26:     marginLeft: 12,
  27:     fontSize: 14,
  28:     color: '#333',
  29:     flexShrink: 1,
  30:   },
  31: });
  32: 

==== AUDIT: C:\Users\MILLET IMMOBILIER\OneDrive\Bureau\project\components\TaxDeclarationBubble.tsx ====
   1: import React from 'react';
   2: import { View, Text, StyleSheet, TouchableOpacity } from 'react-native';
   3: import { TriangleAlert as AlertTriangle } from 'lucide-react-native';
   4: import { router } from 'expo-router';
   5: 
   6: export default function TaxDeclarationBubble() {
   7:   const handlePress = () => {
   8:     router.push('/tax-declaration');
   9:   };
  10: 
  11:   return (
  12:     <TouchableOpacity style={styles.container} onPress={handlePress}>
  13:       <AlertTriangle size={20} color="#FF9800" />
  14:       <View style={styles.content}>
  15:         <Text style={styles.title}>Obligation de déclaration fiscale</Text>
  16:         <Text style={styles.description}>
  17:           Important : Au-delà de 3 000€ de revenus ET 20 transactions par an, vous devez déclarer vos gains. 
  18:           Fourmiz vous notifiera automatiquement si vous approchez de ces seuils.{' '}
  19:           <Text style={styles.link}>En savoir plus</Text>
  20:         </Text>
  21:       </View>
  22:     </TouchableOpacity>
  23:   );
  24: }
  25: 
  26: const styles = StyleSheet.create({
  27:   container: {
  28:     backgroundColor: '#FFF3E0',
  29:     borderRadius: 12,
  30:     padding: 16,
  31:     flexDirection: 'row',
  32:     alignItems: 'flex-start',
  33:     borderLeftWidth: 4,
  34:     borderLeftColor: '#FF9800',
  35:     shadowColor: '#000',
  36:     shadowOffset: { width: 0, height: 2 },
  37:     shadowOpacity: 0.1,
  38:     shadowRadius: 4,
  39:     elevation: 3,
  40:     marginBottom: 12,
  41:   },
  42:   content: {
  43:     flex: 1,
  44:     marginLeft: 12,
  45:   },
  46:   title: {
  47:     fontSize: 16,
  48:     fontFamily: 'Inter-Bold',
  49:     color: '#F57C00',
  50:     marginBottom: 8,
  51:   },
  52:   description: {
  53:     fontSize: 13,
  54:     fontFamily: 'Inter-Regular',
  55:     color: '#F57C00',
  56:     lineHeight: 18,
  57:   },
  58:   link: {
  59:     fontFamily: 'Inter-SemiBold',
  60:     textDecorationLine: 'underline',
  61:   },
  62: });
  63: 

==== AUDIT: C:\Users\MILLET IMMOBILIER\OneDrive\Bureau\project\components\UpdateLocationButton.tsx ====
   1: import React, { useState } from 'react';
   2: import { TouchableOpacity, Text, StyleSheet, ActivityIndicator, Alert } from 'react-native';
   3: import * as Location from 'expo-location';
   4: import { supabase } from '../lib/supabase';
   5: 
   6: export default function UpdateLocationButton() {
   7:   const [loading, setLoading] = useState(false);
   8: 
   9:   const updateLocation = async () => {
  10:     setLoading(true);
  11: 
  12:     try {
  13:       // Demander la permission
  14:       const { status } = await Location.requestForegroundPermissionsAsync();
  15:       if (status !== 'granted') {
  16:         Alert.alert('Permission refusée', 'La localisation est requise pour cette fonctionnalité.');
  17:         setLoading(false);
  18:         return;
  19:       }
  20: 
  21:       // Obtenir la localisation actuelle
  22:       const location = await Location.getCurrentPositionAsync({});
  23:       const { latitude, longitude } = location.coords;
  24: 
  25:       // Obtenir l'utilisateur connecté
  26:       const { data: { user } } = await supabase.auth.getUser();
  27:       if (!user) throw new Error("Utilisateur non connecté");
  28: 
  29:       // Mettre à jour ou insérer la localisation
  30:       const { error } = await supabase
  31:         .from('locations')
  32:         .upsert({
  33:           user_id: user.id,
  34:           latitude,
  35:           longitude,
  36:           available: true, // optionnel : indiquer disponibilité
  37:           updated_at: new Date().toISOString(),
  38:         }, { onConflict: ['user_id'] });
  39: 
  40:       if (error) throw error;
  41: 
  42:       Alert.alert('Position mise à jour ✅');
  43:     } catch (err) {
  44:       Alert.alert("Erreur", err.message || 'Une erreur est survenue');
  45:     } finally {
  46:       setLoading(false);
  47:     }
  48:   };
  49: 
  50:   return (
  51:     <TouchableOpacity style={styles.button} onPress={updateLocation} disabled={loading}>
  52:       {loading ? (
  53:         <ActivityIndicator color="#fff" />
  54:       ) : (
  55:         <Text style={styles.text}>📍 Mettre à jour ma position</Text>
  56:       )}
  57:     </TouchableOpacity>
  58:   );
  59: }
  60: 
  61: const styles = StyleSheet.create({
  62:   button: {
  63:     backgroundColor: '#FF3C38',
  64:     paddingVertical: 12,
  65:     paddingHorizontal: 20,
  66:     borderRadius: 10,
  67:     alignItems: 'center',
  68:     marginVertical: 12,
  69:   },
  70:   text: {
  71:     color: '#fff',
  72:     fontWeight: '600',
  73:     fontSize: 14,
  74:   },
  75: });
  76: 

==== AUDIT: C:\Users\MILLET IMMOBILIER\OneDrive\Bureau\project\components\UrgentMissions.tsx ====
   1: import React, { useEffect, useState } from 'react';
   2: import { View, Text, StyleSheet, FlatList, TouchableOpacity } from 'react-native';
   3: import { supabase } from '../lib/supabase';
   4: import { useRouter } from 'expo-router';
   5: 
   6: export default function UrgentMissions() {
   7:   const [missions, setMissions] = useState([]);
   8:   const router = useRouter();
   9: 
  10:   useEffect(() => {
  11:     supabase
  12:       .from('missions')
  13:       .select('*')
  14:       .eq('isUrgent', true)
  15:       .then(({ data }) => setMissions(data || []));
  16:   }, []);
  17: 
  18:   return (
  19:     <View style={styles.container}>
  20:       <Text style={styles.title}>Missions urgentes</Text>
  21:       <FlatList
  22:         data={missions}
  23:         horizontal
  24:         keyExtractor={(item) => item.id.toString()}
  25:         renderItem={({ item }) => (
  26:           <TouchableOpacity
  27:             style={styles.card}
  28:             onPress={() => router.push(`/orders/${item.id}`)}
  29:           >
  30:             <Text style={styles.cardTitle}>{item.title}</Text>
  31:             <Text numberOfLines={2} style={styles.cardDesc}>{item.description}</Text>
  32:           </TouchableOpacity>
  33:         )}
  34:       />
  35:     </View>
  36:   );
  37: }
  38: 
  39: const styles = StyleSheet.create({
  40:   container: { marginTop: 20 },
  41:   title: { fontSize: 16, fontWeight: 'bold', marginBottom: 10 },
  42:   card: {
  43:     width: 200,
  44:     padding: 12,
  45:     backgroundColor: '#ffebe8',
  46:     marginRight: 12,
  47:     borderRadius: 10,
  48:   },
  49:   cardTitle: { fontWeight: 'bold', fontSize: 14 },
  50:   cardDesc: { fontSize: 12, color: '#666', marginTop: 4 },
  51: });
  52: 

